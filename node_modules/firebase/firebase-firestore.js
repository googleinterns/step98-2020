!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(lp){"use strict";try{(function(){lp=lp&&Object.prototype.hasOwnProperty.call(lp,"default")?lp.default:lp;var t,p,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function d(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(e=p=p||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";function i(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}var o={debug:p.DEBUG,verbose:p.VERBOSE,info:p.INFO,warn:p.WARN,error:p.ERROR,silent:p.SILENT},u=p.INFO,a=((t={})[p.DEBUG]="log",t[p.VERBOSE]="log",t[p.INFO]="info",t[p.WARN]="warn",t[p.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in p))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!0,configurable:!0}),c.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?o[t]:t},Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.DEBUG],t)),this._logHandler.apply(this,s([this,p.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.VERBOSE],t)),this._logHandler.apply(this,s([this,p.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.INFO],t)),this._logHandler.apply(this,s([this,p.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.WARN],t)),this._logHandler.apply(this,s([this,p.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.ERROR],t)),this._logHandler.apply(this,s([this,p.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=i,this._userLogHandler=null}function g(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,l="FirebaseError",m=(n(w,f=Error),w);function w(t,e){var n=f.call(this,e)||this;return n.code=t,n.name=l,Object.setPrototypeOf(n,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,b.prototype.create),n}var b=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(T,function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new m(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var T=/\{\$([^}]+)}/g,I=(N.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},N.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},N.prototype.setServiceProps=function(t){return this.serviceProps=t,this},N);function N(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}function _(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var A,S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},R=R||{},x=S||self;function D(){}function P(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function k(t){var e=P(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var L="closure_uid_"+(1e9*Math.random()>>>0),V=0;function C(t,e,n){return t.call.apply(t.bind,arguments)}function U(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function j(t,e,n){return(j=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?C:U).apply(null,arguments)}function M(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var F=Date.now||function(){return+new Date};function q(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function B(){this.j,this.i}B.prototype.j=!1,B.prototype.da=function(){var t;!this.j&&(this.j=!0,this.C(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,L)&&t[L]||(t[L]=++V))},B.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function W(t){return Array.prototype.concat.apply([],arguments)}function K(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var Q,Y=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return-1!=t.indexOf(e)}function J(t,e){return t<e?-1:e<t?1:0}t:{var $=x.navigator;if($){var Z=$.userAgent;if(Z){Q=Z;break t}}Q=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e={};for(var n in t)e[n]=t[n];return e}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=D;var ot,st,ut=X(Q,"Opera"),at=X(Q,"Trident")||X(Q,"MSIE"),ht=X(Q,"Edge"),ct=ht||at,ft=X(Q,"Gecko")&&!(X(Q.toLowerCase(),"webkit")&&!X(Q,"Edge"))&&!(X(Q,"Trident")||X(Q,"MSIE"))&&!X(Q,"Edge"),lt=X(Q.toLowerCase(),"webkit")&&!X(Q,"Edge");function pt(){var t=x.document;return t?t.documentMode:void 0}t:{var dt="",yt=(st=Q,ft?/rv:([^\);]+)(\)|;)/.exec(st):ht?/Edge\/([\d\.]+)/.exec(st):at?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):ut?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(yt&&(dt=yt?yt[1]:""),at){var vt=pt();if(null!=vt&&vt>parseFloat(dt)){ot=String(vt);break t}}ot=dt}var gt={};function mt(u){return t=u,e=function(){for(var t=0,e=Y(String(ot)).split("."),n=Y(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=J(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||J(0==o[2].length,0==s[2].length)||J(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=gt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var wt=x.document&&at?pt()||(parseInt(ot,10)||void 0):void 0,bt=!at||9<=Number(wt),Et=at&&!mt("9"),Tt=function(){if(!x.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{x.addEventListener("test",D,e),x.removeEventListener("test",D,e)}catch(t){}return t}();function It(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Nt(t,e){if(It.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}It.prototype.b=function(){this.defaultPrevented=!0},q(Nt,It);var _t={2:"touch",3:"pen",4:"mouse"};Nt.prototype.b=function(){Nt.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Et)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var At="closure_listenable_"+(1e6*Math.random()|0),St=0;function Rt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++St,this.V=this.X=!1}function xt(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function Dt(t){this.src=t,this.a={},this.b=0}function Pt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=G(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(xt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function kt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}Dt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=kt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new Rt(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),Lt={};function Vt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Gt(r);return e&&e[At]?e.sa(n,r,O(i)?!!i.capture:!!i,o):Ct(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Vt(t,e[o],n,r,i);return null}return n=Gt(n),t&&t[At]?t.ra(e,n,O(r)?!!r.capture:!!r,i):Ct(t,e,n,!1,r,i)}function Ct(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!bt)return null;var u,a,h=qt(t);if(h||(t[Ot]=h=new Dt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=Ft,r=a=bt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(jt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ut(t){var e,n,r;"number"!=typeof t&&t&&!t.V&&((e=t.src)&&e[At]?Pt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(jt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=qt(e))?(Pt(n,t),0==n.b&&(n.src=null,e[Ot]=null)):xt(t)))}function jt(t){return t in Lt?Lt[t]:Lt[t]="on"+t}function Mt(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Ut(t),n.call(r,e)}function Ft(t,e){if(t.V)return!0;if(bt)return Mt(t,new Nt(e,this));if(!e)t:{e=["window","event"];for(var n=x,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Mt(t,e=new Nt(e,this))}function qt(t){return(t=t[Ot])instanceof Dt?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gt(e){return"function"==P(e)?e:(e[Bt]||(e[Bt]=function(t){return e.handleEvent(t)}),e[Bt])}function zt(){B.call(this),this.c=new Dt(this),(this.J=this).A=null}function Wt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.V&&a.capture==n&&(s=a.listener,u=a.aa||a.src,a.X&&Pt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}q(zt,B),zt.prototype[At]=!0,(A=zt.prototype).addEventListener=function(t,e,n,r){Vt(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Gt(r),e&&e[At]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=kt(s=e.a[n],r,i,o))&&(xt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&qt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=kt(n,r,i,o)),(r=-1<e?n[e]:null)&&Ut(r))}(this,t,e,n,r)},A.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new It(t,n):t instanceof It?t.target=t.target||n:(s=t,rt(t=new It(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Wt(o,r,!0,t)&&s;if(s=Wt(o=t.a=n,r,!0,t)&&s,s=Wt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Wt(o=t.a=e[i],r,!1,t)&&s;return s},A.C=function(){if(zt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)xt(n[r]);delete e.a[t],e.b--}}this.A=null},A.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},A.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Kt=x.JSON.stringify;function Ht(){this.b=this.a=null}var Qt,Yt=(Xt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Xt(function(){return new Jt},function(t){t.reset()},100));function Xt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Jt(){this.next=this.b=this.a=null}function $t(t,e){var n;Qt||(n=x.Promise.resolve(void 0),Qt=function(){n.then(ee)}),Zt||(Qt(),Zt=!0),te.add(t,e)}Ht.prototype.add=function(t,e){var n=Yt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Jt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Zt=!(Jt.prototype.reset=function(){this.next=this.b=this.a=null}),te=new Ht;function ee(){for(var t,e,n;n=e=void 0,n=null,(e=te).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){!function(t){x.setTimeout(function(){throw t},0)}(t)}var r=Yt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}Zt=!1}function ne(t,e){zt.call(this),this.b=t||1,this.a=e||x,this.f=j(this.Ua,this),this.g=F()}function re(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ie(t,e,n){if("function"==P(t))n&&(t=j(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=j(t.handleEvent,t)}return 2147483647<Number(e)?-1:x.setTimeout(t,e||0)}function oe(t,e,n){B.call(this),this.f=null!=n?j(t,n):t,this.c=e,this.b=j(this.Pa,this),this.a=[]}function se(t){t.T=ie(t.b,t.c),t.f.apply(null,t.a)}function ue(t){B.call(this),this.b=t,this.a={}}q(ne,zt),(A=ne.prototype).Z=!1,A.L=null,A.Ua=function(){var t;this.Z&&(0<(t=F()-this.g)&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(re(this),this.start())))},A.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=F())},A.C=function(){ne.M.C.call(this),re(this),delete this.a},q(oe,B),(A=oe.prototype).ba=!1,A.T=null,A.Ia=function(t){this.a=arguments,this.T?this.ba=!0:se(this)},A.C=function(){oe.M.C.call(this),this.T&&(x.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},A.Pa=function(){this.T=null,this.ba&&(this.ba=!1,se(this))},q(ue,B);var ae=[];function he(t,e,n,r){Array.isArray(n)||(n&&(ae[0]=n.toString()),n=ae);for(var i=0;i<n.length;i++){var o=Vt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ce(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ut(t)},t),t.a={}}function fe(){}ue.prototype.C=function(){ue.M.C.call(this),ce(this)},ue.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var le=null;function pe(){return le=le||new zt}function de(t){It.call(this,"serverreachability",t)}function ye(t){var e=pe();e.dispatchEvent(new de(e))}function ve(t){It.call(this,"statevent",t)}function ge(t){var e=pe();e.dispatchEvent(new ve(e))}function me(t){It.call(this,"timingevent",t)}function we(t,e){if("function"!=P(t))throw Error("Fn must not be null and must be a function");return x.setTimeout(function(){t()},e)}q(de,It),q(ve,It),q(me,It);var be={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},Ee={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Te(){}function Ie(t){var e;return(e=t.a)||(e=t.a={}),e}function Ne(){}Te.prototype.a=null;var _e,Ae={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function Se(){It.call(this,"d")}function Re(){It.call(this,"c")}function xe(){}function De(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new ue(this),this.N=Pe,t=ct?125:void 0,this.O=new ne(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}q(Se,It),q(Re,It),q(xe,Te),_e=new xe;var Pe=45e3,ke={},Oe={};function Le(t,e,n){t.B=1,t.f=en(Ye(e)),t.j=n,t.F=!0,Ve(t,null)}function Ve(t,e){t.s=F(),Ue(t),t.A=Ye(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),yn(n.b,"t",r),t.w=0,t.a=or(t.g,t.g.w?e:null),0<t.J&&(t.D=new oe(j(t.ya,t,t.a),t.J)),he(t.G,t.a,"readystatechange",t.Sa),e=t.m?et(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),ye(1)}function Ce(t,e,n){for(var r,i,o,s,u=!0;!t.l&&t.w<n.length;){var a=(i=n,s=o=void 0,o=(r=t).w,-1==(s=i.indexOf("\n",o))?Oe:(o=Number(i.substring(o,s)),isNaN(o)?ke:(s+=1)+o>i.length?Oe:(i=i.substr(s,o),r.w=s+o,i)));if(a==Oe){4==e&&(t.c=4,ge(14),u=!1);break}if(a==ke){t.c=4,ge(15),u=!1;break}Be(t,a)}4==e&&0==n.length&&(t.c=1,ge(16),u=!1),t.b=t.b&&u,u||(qe(t),Fe(t))}function Ue(t){t.P=F()+t.N,je(t,t.N)}function je(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=we(j(t.Qa,t),e)}function Me(t){t.h&&(x.clearTimeout(t.h),t.h=null)}function Fe(t){0==t.g.u||t.l||tr(t.g,t)}function qe(t){Me(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,re(t.O),ce(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function Be(t,e){try{var n,r,i,o,s,u,a,h,c,f,l=t.g;if(0!=l.u&&(l.a==t||Tn(l.b,t)))if(l.A=t.H,!t.o&&Tn(l.b,t)&&3==l.u){try{var p=l.ja.a.parse(e)}catch(t){p=null}if(Array.isArray(p)&&3==p.length){var d=p;if(0==d[0]){t:if(!l.i){if(l.a){if(!(l.a.s+3e3<t.s))break t;Zn(l),l.a.cancel(),l.a=null}$n(l),ge(18)}}else l.ia=d[1],0<l.ia-l.G&&d[2]<37500&&l.U&&0==l.m&&!l.l&&(l.l=we(j(l.Na,l),6e3));if(En(l.b)<=1&&l.O){try{l.O()}catch(t){}l.O=void 0}}else nr(l,11)}else if(!t.o&&l.a!=t||Zn(l),!H(e))for(e=p=l.ja.a.parse(e),p=0;p<e.length;p++){d=e[p],l.G=d[0],d=d[1],2==l.u?"c"==d[0]?(l.B=d[1],l.R=d[2],null!=(n=d[3])&&(l.oa=n),null!=(r=d[5])&&"number"==typeof r&&0<r&&(l.D=1.5*r),i=l,(o=t.a)&&(!(s=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=i.b).a&&(X(s,"spdy")||X(s,"quic")||X(s,"h2"))&&(u.f=u.g,u.a=new Set,u.b&&(In(u,u.b),u.b=null)),!i.s||(a=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(i.ha=a,tn(i.v,i.s,a))),l.u=3,l.c&&l.c.na(),h=t,(i=l).ea=ir(i,i.w?i.R:null,i.P),h.o?(Nn(i.b,h),c=h,(f=i.D)&&c.setTimeout(f),c.h&&(Me(c),Ue(c)),i.a=h):Jn(i),0<l.f.length&&Hn(l)):"stop"!=d[0]&&"close"!=d[0]||nr(l,7):3==l.u&&("stop"==d[0]||"close"==d[0]?"stop"==d[0]?nr(l,7):zn(l):"noop"!=d[0]&&l.c&&l.c.ma(d),l.m=0)}ye(4)}catch(t){}}function Ge(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(k(t)||"string"==typeof t)z(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(k(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(k(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function ze(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof ze)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function We(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ke(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)Ke(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ke(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(A=De.prototype).setTimeout=function(t){this.N=t},A.Sa=function(t){t=t.target;var e=this.D;e&&3==Fn(t)?e.Ia():this.ya(t)},A.ya=function(t){try{if(t==this.a)t:{var e=Fn(this.a),n=this.a.qa(),r=this.a.S();if(!(e<3||3==e&&!ct&&!this.a.Y())){this.l||4!=e||7==n||ye(8==n||r<=0?3:2),Me(this);var i=this.a.S();this.H=i;var o=this.a.Y();if(this.b=200==i){if(this.R&&!this.o){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.c=3,ge(12),qe(this),Fe(this);break t}this.o=!0,Be(this,a)}this.F?(Ce(this,e,o),ct&&this.b&&3==e&&(he(this.G,this.O,"tick",this.Ra),this.O.start())):Be(this,o),4==e&&qe(this),this.b&&!this.l&&(4==e?tr(this.g,this):(this.b=!1,Ue(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,ge(12)):(this.c=0,ge(13)),qe(this),Fe(this)}}}catch(t){}},A.Ra=function(){var t,e;this.a&&(t=Fn(this.a),e=this.a.Y(),this.w<e.length&&(Me(this),Ce(this,t,e),this.b&&4!=t&&Ue(this)))},A.cancel=function(){this.l=!0,qe(this)},A.Qa=function(){this.h=null;var t=F();0<=t-this.P?(2!=this.B&&(ye(3),ge(17)),qe(this),this.c=2,Fe(this)):je(this,this.P-t)},(A=ze.prototype).I=function(){We(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},A.K=function(){return We(this),this.a.concat()},A.get=function(t,e){return Ke(this.b,t)?this.b[t]:e},A.set=function(t,e){Ke(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},A.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var He=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Qe(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Qe?(this.a=void 0!==e?e:t.a,Xe(this,t.f),this.j=t.j,Je(this,t.c),$e(this,t.h),this.g=t.g,e=t.b,(n=new fn).c=e.c,e.a&&(n.a=new ze(e.a),n.b=e.b),Ze(this,n),this.i=t.i):t&&(n=String(t).match(He))?(this.a=!!e,Xe(this,n[1]||"",!0),this.j=nn(n[2]||""),Je(this,n[3]||"",!0),$e(this,n[4]),this.g=nn(n[5]||"",!0),Ze(this,n[6]||"",!0),this.i=nn(n[7]||"")):(this.a=!!e,this.b=new fn(null,this.a))}function Ye(t){return new Qe(t)}function Xe(t,e,n){t.f=n?nn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Je(t,e,n){t.c=n?nn(e,!0):e}function $e(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Ze(t,e,n){var r,i;e instanceof fn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(ln(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(pn(this,e),yn(this,n,t))},r)),r.f=i):(n||(e=rn(e,hn)),t.b=new fn(e,t.a))}function tn(t,e,n){t.b.set(e,n)}function en(t){return tn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^F()).toString(36)),t}function nn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function rn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,on),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function on(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Qe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(rn(e,sn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(rn(e,sn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(rn(n,"/"==n.charAt(0)?an:un,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",rn(n,cn)),t.join("")};var sn=/[#\/\?@]/g,un=/[#\?:]/g,an=/[#\?]/g,hn=/[#\?@]/g,cn=/#/g;function fn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function ln(n){n.a||(n.a=new ze,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function pn(t,e){ln(t),e=vn(t,e),Ke(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ke((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&We(t)))}function dn(t,e){return ln(t),e=vn(t,e),Ke(t.a.b,e)}function yn(t,e,n){pn(t,e),0<n.length&&(t.c=null,t.a.set(vn(t,e),K(n)),t.b+=n.length)}function vn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function gn(t,e){this.b=t,this.a=e}function mn(t){this.g=t||wn,t=x.PerformanceNavigationTiming?0<(t=x.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(x.ca&&x.ca.ua&&x.ca.ua()&&x.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(A=fn.prototype).add=function(t,e){ln(this),this.c=null,t=vn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},A.forEach=function(n,r){ln(this),this.a.forEach(function(t,e){z(t,function(t){n.call(r,t,e,this)},this)},this)},A.K=function(){ln(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},A.I=function(t){ln(this);var e=[];if("string"==typeof t)dn(this,t)&&(e=W(e,this.a.get(vn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},A.set=function(t,e){return ln(this),this.c=null,dn(this,t=vn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},A.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},A.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.I(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var wn=10;function bn(t){return t.b||t.a&&t.a.size>=t.f}function En(t){return t.b?1:t.a?t.a.size:0}function Tn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function In(t,e){t.a?t.a.add(e):t.b=e}function Nn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function _n(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return K(t.c);var r=t.c;try{for(var i=_(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.i)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function An(){}function Sn(){this.a=new An}function Rn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}mn.prototype.cancel=function(){var e,t;if(this.c=_n(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=_(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},An.prototype.stringify=function(t){return x.JSON.stringify(t,void 0)},An.prototype.parse=function(t){return x.JSON.parse(t,void 0)};var xn=x.JSON.parse;function Dn(t){zt.call(this),this.headers=new ze,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=Pn,this.B=this.F=!1}q(Dn,zt);var Pn="",kn=/^https?$/i,On=["POST","PUT"];function Ln(t){return"content-type"==t.toLowerCase()}function Vn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),jn(t)}function Cn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Un(t){if(t.b&&void 0!==R&&(!t.s[1]||4!=Fn(t)||2!=t.S()))if(t.l&&4==Fn(t))ie(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==Fn(t)){t.b=!1;try{var e,n,r,i,o=t.S();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.D).match(He)[1]||null)&&x.self&&x.self.location&&(i=(r=x.self.location.protocol).substr(0,r.length-1)),n=!kn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Fn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Cn(t)}}finally{jn(t)}}}function jn(t,e){if(t.a){Mn(t);var n=t.a,r=t.s[0]?D:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Mn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(x.clearTimeout(t.m),t.m=null)}function Fn(t){return t.a?t.a.readyState:0}function qn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",tt(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):tn(t,e,n))}function Bn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Gn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Bn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Bn("baseRetryDelayMs",5e3,t),this.Ga=Bn("retryDelaySeedMs",1e4,t),this.Da=Bn("forwardChannelMaxRetries",2,t),this.ga=Bn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new mn(t&&t.concurrentRequestLimit),this.ja=new Sn,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function zn(t){var e,n;Wn(t),3==t.u&&(e=t.H++,tn(n=Ye(t.v),"SID",t.B),tn(n,"RID",e),tn(n,"TYPE","terminate"),Yn(t,n),(e=new De(t,e,void 0)).B=2,e.f=en(Ye(n)),n=!1,x.navigator&&x.navigator.sendBeacon&&(n=x.navigator.sendBeacon(e.f.toString(),"")),!n&&x.Image&&((new Image).src=e.f,n=!0),n||(e.a=or(e.g,null),e.a.$(e.f)),e.s=F(),Ue(e)),rr(t)}function Wn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(x.clearTimeout(t.i),t.i=null),Zn(t),t.b.cancel(),t.g&&("number"==typeof t.g&&x.clearTimeout(t.g),t.g=null)}function Kn(t,e){t.f.push(new gn(t.Fa++,e)),3==t.u&&Hn(t)}function Hn(t){bn(t.b)||t.g||(t.g=!0,$t(t.xa,t),t.o=0)}function Qn(t,e){var n=e?e.W:t.H++,r=Ye(t.v);tn(r,"SID",t.B),tn(r,"RID",n),tn(r,"AID",t.G),Yn(t,r),t.h&&t.j&&qn(r,t.h,t.j),n=new De(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Xn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),In(t.b,n),Le(n,r,e)}function Yn(t,n){t.c&&Ge({},function(t,e){tn(n,e,t)})}function Xn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?j(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{!function(t,r,e){var i=e||"";try{Ge(t,function(t,e){var n=t;O(t)&&(n=Kt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function Jn(t){t.a||t.i||(t.J=1,$t(t.wa,t),t.m=0)}function $n(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=we(j(t.wa,t),er(t,t.m)),t.m++,1)}function Zn(t){null!=t.l&&(x.clearTimeout(t.l),t.l=null)}function tr(t,e){var n,r=null;if(t.a==e){Zn(t),t.a=null;var i=2}else{if(!Tn(t.b,e))return;r=e.i,Nn(t.b,e),i=1}if(t.A=e.H,0!=t.u)if(e.b){1==i?(r=e.j?e.j.length:0,e=F()-e.s,n=t.o,(i=pe()).dispatchEvent(new me(i)),Hn(t)):Jn(t)}else if(3==(n=e.c)||0==n&&0<t.A||!(1==i&&function(t,e){if(!(En(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=we(j(t.xa,t,e),er(t,t.o)),t.o++,1}}(t,e)||2==i&&$n(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:nr(t,5);break;case 4:nr(t,10);break;case 3:nr(t,6);break;default:nr(t,2)}}function er(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function nr(t,e){var n,r,i,o,s,u;2==e?(n=null,t.c&&(n=null),r=j(t.Ta,t),n||(n=new Qe("//www.google.com/images/cleardot.gif"),x.location&&"http"==x.location.protocol||Xe(n,"https"),en(n)),i=n.toString(),o=r,u=new fe,x.Image?((s=new Image).onload=M(Rn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=M(Rn,u,s,"TestLoadImage: error",!1,o),s.onabort=M(Rn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=M(Rn,u,s,"TestLoadImage: timeout",!1,o),x.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):ge(2),t.u=0,t.c&&t.c.la(e),rr(t),Wn(t)}function rr(t){t.u=0,t.A=-1,t.c&&(0==_n(t.b).length&&0==t.f.length||(t.b.c.length=0,K(t.f),t.f.length=0),t.c.ka())}function ir(t,e,n){var r,i,o,s,u,a,h,c=(r=n)instanceof Qe?Ye(r):new Qe(r,void 0);return""!=c.c?(e&&Je(c,e+"."+c.c),$e(c,c.h)):(i=x.location,o=i.protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,h=new Qe(null,void 0),o&&Xe(h,o),s&&Je(h,s),u&&$e(h,u),a&&(h.g=a),c=h),t.N&&tt(t.N,function(t,e){tn(c,e,t)}),e=t.s,n=t.ha,e&&n&&tn(c,e,n),tn(c,"VER",t.oa),Yn(t,c),c}function or(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Dn(t.Ea)).F=t.w,e}function sr(){}function ur(){if(at&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function ar(t,e){zt.call(this),this.a=new Gn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new fr(this)}function hr(t){Se.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function cr(){Re.call(this),this.status=1}function fr(t){this.a=t}(A=Dn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Ie(this.G):Ie(_e),this.a.onreadystatechange=j(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Vn(this,t)}t=n||"";var i,o=new ze(this.headers);r&&Ge(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Ln,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=x.FormData&&t instanceof x.FormData,0<=G(On,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Mn(this),0<this.o&&((this.B=(i=this.a,at&&mt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=j(this.ta,this)):this.m=ie(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Vn(this,t)}},A.ta=function(){void 0!==R&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},A.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),jn(this))},A.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),jn(this,!0)),Dn.M.C.call(this)},A.va=function(){this.j||(this.w||this.l||this.g?Un(this):this.Oa())},A.Oa=function(){Un(this)},A.S=function(){try{return 2<Fn(this)?this.a.status:-1}catch(t){return-1}},A.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},A.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),xn(e)}},A.qa=function(){return this.h},A.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(A=Gn.prototype).oa=8,A.u=1,A.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new De(this,t,void 0),r=this.j;if(this.F&&(r?rt(r=et(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Xn(this,n,e),tn(i=Ye(this.v),"RID",t),tn(i,"CVER",22),this.s&&tn(i,"X-HTTP-Session-Id",this.s),Yn(this,i),this.h&&r&&qn(i,this.h,r),In(this.b,n),this.fa?(tn(i,"$req",e),tn(i,"SID","null"),n.R=!0,Le(n,i,null)):Le(n,i,e),this.u=2}}else 3==this.u&&(t?Qn(this,t):0==this.f.length||bn(this.b)||Qn(this))},A.wa=function(){this.i=null,this.a=new De(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=Ye(this.ea);tn(t,"RID","rpc"),tn(t,"SID",this.B),tn(t,"CI",this.U?"0":"1"),tn(t,"AID",this.G),Yn(this,t),tn(t,"TYPE","xmlhttp"),this.h&&this.j&&qn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=en(Ye(t)),e.j=null,e.F=!0,Ve(e,n)},A.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,$n(this),ge(19))},A.Ta=function(t){ge(t?2:1)},(A=sr.prototype).na=function(){},A.ma=function(){},A.la=function(){},A.ka=function(){},A.Ha=function(){},ur.prototype.a=function(t,e){return new ar(t,e)},q(ar,zt),(A=ar.prototype).addEventListener=function(t,e,n,r){ar.M.addEventListener.call(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){ar.M.removeEventListener.call(this,t,e,n,r)},A.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ge(0),t.P=e,t.N=n||{},t.U=t.W,t.v=ir(t,null,t.P),Hn(t)},A.close=function(){zn(this.a)},A.La=function(t){var e;"string"==typeof t?((e={}).__data__=t,Kn(this.a,e)):this.g?((e={}).__data__=Kt(t),Kn(this.a,e)):Kn(this.a,t)},A.C=function(){this.a.c=null,delete this.f,zn(this.a),delete this.a,ar.M.C.call(this)},q(hr,Se),q(cr,Re),q(fr,sr),fr.prototype.na=function(){this.a.dispatchEvent("a")},fr.prototype.ma=function(t){this.a.dispatchEvent(new hr(t))},fr.prototype.la=function(t){this.a.dispatchEvent(new cr)},fr.prototype.ka=function(){this.a.dispatchEvent("b")},ur.prototype.createWebChannel=ur.prototype.a,ar.prototype.send=ar.prototype.La,ar.prototype.open=ar.prototype.Ka,be.NO_ERROR=0,be.TIMEOUT=8,be.HTTP_ERROR=6,Ee.COMPLETE="complete",(Ne.EventType=Ae).OPEN="a",Ae.CLOSE="b",Ae.ERROR="c",Ae.MESSAGE="d",zt.prototype.listen=zt.prototype.ra,Dn.prototype.listenOnce=Dn.prototype.sa,Dn.prototype.getLastError=Dn.prototype.Ma,Dn.prototype.getLastErrorCode=Dn.prototype.qa,Dn.prototype.getStatus=Dn.prototype.S,Dn.prototype.getResponseJson=Dn.prototype.Ja,Dn.prototype.getResponseText=Dn.prototype.Y,Dn.prototype.send=Dn.prototype.$;var lr={createWebChannelTransport:function(){return new ur},ErrorCode:be,EventType:Ee,WebChannel:Ne,XhrIo:Dn},pr=lr.createWebChannelTransport,dr=lr.ErrorCode,yr=lr.EventType,vr=lr.WebChannel,gr=lr.XhrIo,mr=lp.SDK_VERSION,wr=(br.prototype.t=function(){return null!=this.uid},br.prototype.s=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},br.prototype.isEqual=function(t){return t.uid===this.uid},br);function br(t){this.uid=t}wr.UNAUTHENTICATED=new wr(null),wr.i=new wr("google-credentials-uid"),wr.h=new wr("first-party-uid");function Er(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}var Tr,Ir,Nr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},_r=(n(Br,Ir=Error),Br),Ar=(qr.prototype.getToken=function(){return Promise.resolve(null)},qr.prototype._=function(){},qr.prototype.l=function(t){(this.u=t)(wr.UNAUTHENTICATED)},qr.prototype.T=function(){this.u=null},qr),Sr=(Fr.prototype.getToken=function(){var e=this,n=this.A,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.A!==n?(Ms("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Gs("string"==typeof t.accessToken),new Er(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},Fr.prototype._=function(){this.forceRefresh=!0},Fr.prototype.l=function(t){this.u=t,this.R&&t(this.currentUser)},Fr.prototype.T=function(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.u=null},Fr.prototype.m=function(){var t=this.auth&&this.auth.getUid();return Gs(null===t||"string"==typeof t),new wr(t)},Fr),Rr=(Object.defineProperty(Mr.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.P.auth.g([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Mr),xr=(jr.prototype.getToken=function(){return Promise.resolve(new Rr(this.P,this.V))},jr.prototype.l=function(t){t(wr.h)},jr.prototype.T=function(){},jr.prototype._=function(){},jr),Dr=(Ur.now=function(){return Ur.fromMillis(Date.now())},Ur.fromDate=function(t){return Ur.fromMillis(t.getTime())},Ur.fromMillis=function(t){var e=Math.floor(t/1e3);return new Ur(e,1e6*(t-1e3*e))},Ur.prototype.toDate=function(){return new Date(this.toMillis())},Ur.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},Ur.prototype.p=function(t){return this.seconds===t.seconds?Ks(this.nanoseconds,t.nanoseconds):Ks(this.seconds,t.seconds)},Ur.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},Ur.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},Ur.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},Ur),Pr=(Cr.v=function(t){return new Cr(t)},Cr.min=function(){return new Cr(new Dr(0,0))},Cr.prototype.S=function(t){return this.timestamp.p(t.timestamp)},Cr.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Cr.prototype.D=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Cr.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Cr.prototype.C=function(){return this.timestamp},Cr),kr=(Object.defineProperty(Vr.prototype,"length",{get:function(){return this.F},enumerable:!0,configurable:!0}),Vr.prototype.isEqual=function(t){return 0===Vr.N(this,t)},Vr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof Vr?t.forEach(function(t){e.push(t)}):e.push(t),this.k(e)},Vr.prototype.limit=function(){return this.offset+this.length},Vr.prototype.M=function(t){return t=void 0===t?1:t,this.k(this.segments,this.offset+t,this.length-t)},Vr.prototype.$=function(){return this.k(this.segments,this.offset,this.length-1)},Vr.prototype.O=function(){return this.segments[this.offset]},Vr.prototype.L=function(){return this.get(this.length-1)},Vr.prototype.get=function(t){return this.segments[this.offset+t]},Vr.prototype.B=function(){return 0===this.length},Vr.prototype.q=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Vr.prototype.U=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},Vr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},Vr.prototype.W=function(){return this.segments.slice(this.offset,this.limit())},Vr.N=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},Vr),Or=(n(Lr,Tr=kr),Lr.prototype.k=function(t,e,n){return new Lr(t,e,n)},Lr.prototype.j=function(){return this.W().join("/")},Lr.prototype.toString=function(){return this.j()},Lr.K=function(t){if(0<=t.indexOf("//"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Lr(t.split("/").filter(function(t){return 0<t.length}))},Lr);function Lr(){return null!==Tr&&Tr.apply(this,arguments)||this}function Vr(t,e,n){void 0===e?e=0:e>t.length&&Bs(),void 0===n?n=t.length-e:n>t.length-e&&Bs(),this.segments=t,this.offset=e,this.F=n}function Cr(t){this.timestamp=t}function Ur(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new _r(Nr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function jr(t,e){this.P=t,this.V=e}function Mr(t,e){this.P=t,this.V=e,this.type="FirstParty",this.user=wr.h}function Fr(t){var e=this;this.I=null,this.currentUser=wr.UNAUTHENTICATED,this.R=!1,this.A=0,this.u=null,this.forceRefresh=!1,this.I=function(){e.A++,e.currentUser=e.m(),e.R=!0,e.u&&e.u(e.currentUser)},this.A=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then(function(t){e.auth=t,e.I&&e.auth.addAuthTokenListener(e.I)},function(){}))}function qr(){this.u=null}function Br(t,e){var n=this;return(n=Ir.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Or.G=new Or([]);var Gr,zr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Wr=(n(Kr,Gr=kr),Kr.prototype.k=function(t,e,n){return new Kr(t,e,n)},Kr.H=function(t){return zr.test(t)},Kr.prototype.j=function(){return this.W().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Kr.H(t)||(t="`"+t+"`"),t}).join(".")},Kr.prototype.toString=function(){return this.j()},Kr.prototype.Y=function(){return 1===this.length&&"__name__"===this.get(0)},Kr.J=function(){return new Kr(["__name__"])},Kr.X=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new _r(Nr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new _r(Nr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new _r(Nr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Kr(e)},Kr);function Kr(){return null!==Gr&&Gr.apply(this,arguments)||this}Wr.G=new Wr([]);var Hr=(Qr.Z=function(t){return new Qr(Or.K(t).M(5))},Qr.prototype.tt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},Qr.prototype.isEqual=function(t){return null!==t&&0===Or.N(this.path,t.path)},Qr.prototype.toString=function(){return this.path.toString()},Qr.N=function(t,e){return Or.N(t.path,e.path)},Qr.et=function(t){return t.length%2==0},Qr.st=function(t){return new Qr(new Or(t.slice()))},Qr);function Qr(t){this.path=t}function Yr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Xr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Jr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Hr.EMPTY=new Hr(new Or([]));var $r=(Zr.fromBase64String=function(t){return new Zr(Vs.nt().atob(t))},Zr.fromUint8Array=function(t){return new Zr(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Zr.prototype.toBase64=function(){return Vs.nt().btoa(this.it)},Zr.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)},Zr.prototype.rt=function(){return 2*this.it.length},Zr.prototype.S=function(t){return Ks(this.it,t.it)},Zr.prototype.isEqual=function(t){return this.it===t.it},Zr);function Zr(t){this.it=t}function ti(t){return null==t}function ei(t){return-0===t&&1/t==-1/0}function ni(t){return"number"==typeof t&&Number.isInteger(t)&&!ei(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function ri(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ii(t){var e=li(t.mapValue.fields.__local_write_time__.timestampValue);return new Dr(e.seconds,e.nanos)}$r.ht=new $r("");var oi=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function si(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ri(t)?4:10:Bs()}function ui(r,i){var t,e,n,o=si(r);if(o!==si(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return ii(r).isEqual(ii(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=li(r.timestampValue),n=li(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,di(r.bytesValue).isEqual(di(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,pi((t=r).geoPointValue.latitude)===pi(e.geoPointValue.latitude)&&pi(t.geoPointValue.longitude)===pi(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return pi(t.integerValue)===pi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=pi(t.doubleValue),r=pi(e.doubleValue);return n===r?ei(n)===ei(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Hs(r.arrayValue.values||[],i.arrayValue.values||[],ui);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Yr(t)!==Yr(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!ui(t[n],e[n])))return!1;return!0}();default:return Bs()}}function ai(t,e){return void 0!==(t.values||[]).find(function(t){return ui(t,e)})}function hi(t,e){var n,r,i,o,s,u,a,h,c,f,l=si(t),p=si(e);if(l!==p)return Ks(l,p);switch(l){case 0:return 0;case 1:return Ks(t.booleanValue,e.booleanValue);case 2:return h=e,c=pi(t.integerValue||t.doubleValue),f=pi(h.integerValue||h.doubleValue),c<f?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return ci(t.timestampValue,e.timestampValue);case 4:return ci(ii(t),ii(e));case 5:return Ks(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=di(o),a=di(s),u.S(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Ks(n[i],r[i]);if(0!==o)return o}return Ks(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Ks(pi(n.latitude),pi(r.latitude)))?i:Ks(pi(n.longitude),pi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=hi(n[i],r[i]);if(o)return o}return Ks(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Ks(r[s],o[s]);if(0!==u)return u;var a=hi(n[r[s]],i[o[s]]);if(0!==a)return a}return Ks(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Bs()}}function ci(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ks(t,e);var n=li(t),r=li(e),i=Ks(n.seconds,r.seconds);return 0!==i?i:Ks(n.nanos,r.nanos)}function fi(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=li(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?di(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Hr.Z(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Bs();var t,e,n}(t)}function li(t){if(Gs(!!t),"string"!=typeof t)return{seconds:pi(t.seconds),nanos:pi(t.nanos)};var e,n=0,r=oi.exec(t);Gs(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function pi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function di(t){return"string"==typeof t?$r.fromBase64String(t):$r.fromUint8Array(t)}function yi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.j()}}function vi(t){return t&&"integerValue"in t}function gi(t){return!!t&&"arrayValue"in t}function mi(t){return t&&"nullValue"in t}function wi(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function bi(t){return t&&"mapValue"in t}var Ei=(Ti.prototype.ot=function(t,e){return n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},t&&(n.fields.__previous_value__=t),{mapValue:n};var n},Ti.prototype.at=function(t,e){return e},Ti.prototype.ut=function(t){return null},Ti.prototype.isEqual=function(t){return t instanceof Ti},Ti);function Ti(){}Ei.instance=new Ei;var Ii=(Ri.prototype.ot=function(t,e){return this.apply(t)},Ri.prototype.at=function(t,e){return this.apply(t)},Ri.prototype.apply=function(t){for(var n=xi(t),e=0,r=this.elements;e<r.length;e++)!function(e){n.some(function(t){return ui(t,e)})||n.push(e)}(r[e]);return{arrayValue:{values:n}}},Ri.prototype.ut=function(t){return null},Ri.prototype.isEqual=function(t){return t instanceof Ri&&Hs(this.elements,t.elements,ui)},Ri),Ni=(Si.prototype.ot=function(t,e){return this.apply(t)},Si.prototype.at=function(t,e){return this.apply(t)},Si.prototype.apply=function(t){for(var n=xi(t),e=0,r=this.elements;e<r.length;e++)!function(e){n=n.filter(function(t){return!ui(t,e)})}(r[e]);return{arrayValue:{values:n}}},Si.prototype.ut=function(t){return null},Si.prototype.isEqual=function(t){return t instanceof Si&&Hs(this.elements,t.elements,ui)},Si),_i=(Ai.prototype.ot=function(t,e){var n=this.ut(t),r=this.asNumber(n)+this.asNumber(this.ct);return vi(n)&&vi(this.ct)?this.serializer._t(r):this.serializer.lt(r)},Ai.prototype.at=function(t,e){return e},Ai.prototype.ut=function(t){return vi(e=t)||e&&"doubleValue"in e?t:{integerValue:0};var e},Ai.prototype.isEqual=function(t){return t instanceof Ai&&ui(this.ct,t.ct)},Ai.prototype.asNumber=function(t){return pi(t.integerValue||t.doubleValue)},Ai);function Ai(t,e){this.serializer=t,this.ct=e}function Si(t){this.elements=t}function Ri(t){this.elements=t}function xi(t){return gi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Di(t,e){this.version=t,this.transformResults=e}var Pi,ki,Oi,Li,Vi,Ci=(ro.prototype.dt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].q(t))return!0;return!1},ro.prototype.isEqual=function(t){return Hs(this.fields,t.fields,function(t,e){return t.isEqual(e)})},ro),Ui=(no.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},no),ji=(eo.ft=function(){return new eo},eo.exists=function(t){return new eo(void 0,t)},eo.updateTime=function(t){return new eo(t)},Object.defineProperty(eo.prototype,"Tt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),eo.prototype.Et=function(t){return void 0!==this.updateTime?t instanceof mo&&t.version.isEqual(this.updateTime):void 0===this.exists||this.exists===t instanceof mo},eo.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},eo),Mi=(to.prototype.It=function(t){},to.wt=function(t){return t instanceof mo?t.version:Pr.min()},to),Fi=(n(Zi,Vi=Mi),Zi.prototype.at=function(t,e){this.It(t);var n=e.version;return new mo(this.key,n,this.value,{hasCommittedMutations:!0})},Zi.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Mi.wt(t);return new mo(this.key,r,this.value,{At:!0})},Zi.prototype.Pt=function(t){return null},Zi.prototype.isEqual=function(t){return t instanceof Zi&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.Rt.isEqual(t.Rt)},Zi),qi=(n($i,Li=Mi),$i.prototype.at=function(t,e){if(this.It(t),!this.Rt.Et(t))return new bo(this.key,e.version);var n=this.gt(t);return new mo(this.key,e.version,n,{hasCommittedMutations:!0})},$i.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Mi.wt(t),i=this.gt(t);return new mo(this.key,r,i,{At:!0})},$i.prototype.Pt=function(t){return null},$i.prototype.isEqual=function(t){return t instanceof $i&&this.key.isEqual(t.key)&&this.Vt.isEqual(t.Vt)&&this.Rt.isEqual(t.Rt)},$i.prototype.gt=function(t){var e=t instanceof mo?t.data():Wi.empty();return this.pt(e)},$i.prototype.pt=function(t){var n=this,r=new Ki(t);return this.Vt.fields.forEach(function(t){var e;t.B()||(null!==(e=n.data.field(t))?r.set(t,e):r.delete(t))}),r.yt()},$i),Bi=(n(Ji,Oi=Mi),Ji.prototype.at=function(t,e){if(this.It(t),Gs(null!=e.transformResults),!this.Rt.Et(t))return new bo(this.key,e.version);var n=this.bt(t),r=this.vt(t,e.transformResults),i=e.version,o=this.St(n.data(),r);return new mo(this.key,i,o,{hasCommittedMutations:!0})},Ji.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=this.bt(t),i=this.Dt(n,t,e),o=this.St(r.data(),i);return new mo(this.key,r.version,o,{At:!0})},Ji.prototype.Pt=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof mo?t.field(i.field):void 0,s=i.transform.ut(o||null);null!=s&&(e=null==e?(new Ki).set(i.field,s):e.set(i.field,s))}return e?e.yt():null},Ji.prototype.isEqual=function(t){return t instanceof Ji&&this.key.isEqual(t.key)&&Hs(this.fieldTransforms,t.fieldTransforms,function(t,e){return t.isEqual(e)})&&this.Rt.isEqual(t.Rt)},Ji.prototype.bt=function(t){return t},Ji.prototype.vt=function(t,e){var n=[];Gs(this.fieldTransforms.length===e.length);for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof mo&&(s=t.field(i.field)),n.push(o.at(s,e[r]))}return n},Ji.prototype.Dt=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof mo&&(a=e.field(s.field)),null===a&&n instanceof mo&&(a=n.field(s.field)),r.push(u.ot(a,t))}return r},Ji.prototype.St=function(t,e){for(var n=new Ki(t),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.yt()},Ji),Gi=(n(Xi,ki=Mi),Xi.prototype.at=function(t,e){return this.It(t),new wo(this.key,e.version,{hasCommittedMutations:!0})},Xi.prototype.ot=function(t,e,n){return this.It(t),this.Rt.Et(t)?new wo(this.key,Pr.min()):t},Xi.prototype.Pt=function(t){return null},Xi.prototype.isEqual=function(t){return t instanceof Xi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Xi),zi=(n(Yi,Pi=Mi),Yi.prototype.at=function(t,e){Bs()},Yi.prototype.ot=function(t,e,n){Bs()},Yi.prototype.Pt=function(t){Bs()},Yi.prototype.isEqual=function(t){return t instanceof Yi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Yi),Wi=(Qi.empty=function(){return new Qi({mapValue:{}})},Qi.prototype.field=function(t){if(t.B())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!bi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.L()])||null},Qi.prototype.isEqual=function(t){return ui(this.proto,t.proto)},Qi),Ki=(Hi.prototype.set=function(t,e){return this.Nt(t,e),this},Hi.prototype.delete=function(t){return this.Nt(t,null),this},Hi.prototype.Nt=function(t,e){for(var n=this.Ft,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===si(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.L(),e)},Hi.prototype.yt=function(){var t=this.kt(Wr.G,this.Ft);return null!=t?new Wi(t):this.Ct},Hi.prototype.kt=function(r,t){var i=this,o=!1,e=this.Ct.field(r),s=bi(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.kt(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Hi);function Hi(t){void 0===t&&(t=Wi.empty()),this.Ct=t,this.Ft=new Map}function Qi(t){this.proto=t}function Yi(t,e){var n=this;return(n=Pi.call(this)||this).key=t,n.Rt=e,n.type=4,n}function Xi(t,e){var n=this;return(n=ki.call(this)||this).key=t,n.Rt=e,n.type=3,n}function Ji(t,e){var n=this;return(n=Oi.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Rt=ji.exists(!0),n}function $i(t,e,n,r){var i=this;return(i=Li.call(this)||this).key=t,i.data=e,i.Vt=n,i.Rt=r,i.type=1,i}function Zi(t,e,n){var r=this;return(r=Vi.call(this)||this).key=t,r.value=e,r.Rt=n,r.type=0,r}function to(){}function eo(t,e){this.updateTime=t,this.exists=e}function no(t,e){this.field=t,this.transform=e}function ro(t){(this.fields=t).sort(Wr.N)}function io(t,e){this.key=t,this.version=e}function oo(t){this.count=t}var so,uo,ao,ho,co,fo,lo,po,yo,vo,go,mo=(n(Wo,go=io),Wo.prototype.field=function(t){return this.Mt.field(t)},Wo.prototype.data=function(){return this.Mt},Wo.prototype.xt=function(){return this.Mt.proto},Wo.prototype.isEqual=function(t){return t instanceof Wo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.At===t.At&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Mt.isEqual(t.Mt)},Wo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Mt.toString()+", {hasLocalMutations: "+this.At+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Wo.prototype,"hasPendingWrites",{get:function(){return this.At||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Wo),wo=(n(zo,vo=io),zo.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(zo.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),zo.prototype.isEqual=function(t){return t instanceof zo&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},zo),bo=(n(Go,yo=io),Go.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Go.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Go.prototype.isEqual=function(t){return t instanceof Go&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Go),Eo=(Bo.prototype.canonicalId=function(){var t;return null===this.$t&&(t=this.path.j(),null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map(function(t){return t.canonicalId()}).join(","),t+="|ob:",t+=this.orderBy.map(function(t){return t.canonicalId()}).join(","),ti(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.$t=t),this.$t},Bo.prototype.toString=function(){var t=this.path.j();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ti(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Bo.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(var n=0;n<this.filters.length;n++)if(!this.filters[n].isEqual(t.filters[n]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Bo.prototype.Ot=function(){return Hr.et(this.path)&&null===this.collectionGroup&&0===this.filters.length},Bo),To=(qo.Wt=function(t){return new qo(t)},Object.defineProperty(qo.prototype,"orderBy",{get:function(){if(null===this.qt){this.qt=[];var t=this.jt(),e=this.Kt();if(null!==t&&null===e)t.Y()||this.qt.push(new Do(t)),this.qt.push(new Do(Wr.J(),"asc"));else{for(var n,r=!1,i=0,o=this.Lt;i<o.length;i++){var s=o[i];this.qt.push(s),s.field.Y()&&(r=!0)}r||(n=0<this.Lt.length?this.Lt[this.Lt.length-1].dir:"asc",this.qt.push(new Do(Wr.J(),n)))}}return this.qt},enumerable:!0,configurable:!0}),qo.prototype.Gt=function(t){var e=this.filters.concat([t]);return new qo(this.path,this.collectionGroup,this.Lt.slice(),e,this.limit,this.Bt,this.startAt,this.endAt)},qo.prototype.zt=function(t){var e=this.Lt.concat([t]);return new qo(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},qo.prototype.Ht=function(t){return new qo(this.path,this.collectionGroup,this.Lt.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},qo.prototype.Yt=function(t){return new qo(this.path,this.collectionGroup,this.Lt.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},qo.prototype.Jt=function(t){return new qo(this.path,this.collectionGroup,this.Lt.slice(),this.filters.slice(),this.limit,this.Bt,t,this.endAt)},qo.prototype.Xt=function(t){return new qo(this.path,this.collectionGroup,this.Lt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,t)},qo.prototype.Zt=function(t){return new qo(t,null,this.Lt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},qo.prototype.te=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.Lt.length||1===this.Lt.length&&this.Lt[0].field.Y())},qo.prototype.canonicalId=function(){return this.ee().canonicalId()+"|lt:"+this.Bt},qo.prototype.toString=function(){return"Query(target="+this.ee().toString()+"; limitType="+this.Bt+")"},qo.prototype.isEqual=function(t){return this.ee().isEqual(t.ee())&&this.Bt===t.Bt},qo.prototype.se=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.Y()}return 0},qo.prototype.matches=function(t){return this.ie(t)&&this.ne(t)&&this.re(t)&&this.he(t)},qo.prototype.oe=function(){return!ti(this.limit)&&"F"===this.Bt},qo.prototype.ae=function(){return!ti(this.limit)&&"L"===this.Bt},qo.prototype.Kt=function(){return 0<this.Lt.length?this.Lt[0].field:null},qo.prototype.jt=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof Io&&n.ue())return n.field}return null},qo.prototype.ce=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof Io&&0<=t.indexOf(r.op))return r.op}return null},qo.prototype.Ot=function(){return this.ee().Ot()},qo.prototype._e=function(){return null!==this.collectionGroup},qo.prototype.ee=function(){if(!this.Ut)if("F"===this.Bt)this.Ut=new Eo(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new Do(r.field,i))}var o=this.endAt?new xo(this.endAt.position,!this.endAt.before):null,s=this.startAt?new xo(this.startAt.position,!this.startAt.before):null;this.Ut=new Eo(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Ut},qo.prototype.ie=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.tt(this.collectionGroup)&&this.path.q(e):Hr.et(this.path)?this.path.isEqual(e):this.path.U(e)},qo.prototype.ne=function(t){for(var e=0,n=this.Lt;e<n.length;e++){var r=n[e];if(!r.field.Y()&&null===t.field(r.field))return!1}return!0},qo.prototype.re=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},qo.prototype.he=function(t){return!(this.startAt&&!this.startAt.le(this.orderBy,t)||this.endAt&&this.endAt.le(this.orderBy,t))},qo.prototype.Qt=function(t){},qo),Io=(n(Fo,po=function(){}),Fo.create=function(t,e,n){if(t.Y())return"in"===e?new _o(t,n):new No(t,e,n);if(mi(n)){if("=="!==e)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Fo(t,e,n)}if(wi(n)){if("=="!==e)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Fo(t,e,n)}return"array-contains"===e?new Ao(t,n):"in"===e?new So(t,n):"array-contains-any"===e?new Ro(t,n):new Fo(t,e,n)},Fo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&si(this.value)===si(e)&&this.de(hi(e,this.value))},Fo.prototype.de=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return Bs()}},Fo.prototype.ue=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},Fo.prototype.canonicalId=function(){return this.field.j()+this.op.toString()+fi(this.value)},Fo.prototype.isEqual=function(t){return t instanceof Fo&&this.op===t.op&&this.field.isEqual(t.field)&&ui(this.value,t.value)},Fo.prototype.toString=function(){return this.field.j()+" "+this.op+" "+fi(this.value)},Fo),No=(n(Mo,lo=Io),Mo.prototype.matches=function(t){var e=Hr.N(t.key,this.key);return this.de(e)},Mo),_o=(n(jo,fo=Io),jo.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},jo),Ao=(n(Uo,co=Io),Uo.prototype.matches=function(t){var e=t.field(this.field);return gi(e)&&ai(e.arrayValue,this.value)},Uo),So=(n(Co,ho=Io),Co.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ai(this.value.arrayValue,e)},Co),Ro=(n(Vo,ao=Io),Vo.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!gi(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return ai(e.value.arrayValue,t)})},Vo),xo=(Lo.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map(fi).join(",")},Lo.prototype.le=function(t,e){for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r],n=i.field.Y()?Hr.N(Hr.Z(o.referenceValue),e.key):hi(o,e.field(i.field));if("desc"===i.dir&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},Lo.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!ui(this.position[e],t.position[e]))return!1;return!0},Lo),Do=(Oo.prototype.compare=function(t,e){var n,r,i,o,s=this.fe?Hr.N(t.key,e.key):(n=this.field,r=e,i=t.field(n),o=r.field(n),null!==i&&null!==o?hi(i,o):Bs());switch(this.dir){case"asc":return s;case"desc":return-1*s;default:return Bs()}},Oo.prototype.canonicalId=function(){return this.field.j()+this.dir.toString()},Oo.prototype.toString=function(){return this.field.j()+" ("+this.dir+")"},Oo.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Oo),Po=(ko.prototype.Ie=function(t){return new ko(this.target,this.targetId,this.Te,t,this.Ee,this.lastLimboFreeSnapshotVersion,this.resumeToken)},ko.prototype.we=function(t,e){return new ko(this.target,this.targetId,this.Te,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},ko.prototype.Re=function(t){return new ko(this.target,this.targetId,this.Te,this.sequenceNumber,this.Ee,t,this.resumeToken)},ko);function ko(t,e,n,r,i,o,s){void 0===i&&(i=Pr.min()),void 0===o&&(o=Pr.min()),void 0===s&&(s=$r.ht),this.target=t,this.targetId=e,this.Te=n,this.sequenceNumber=r,this.Ee=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Oo(t,e){this.field=t,void 0===e&&(e="asc"),this.dir=e,this.fe=t.Y()}function Lo(t,e){this.position=t,this.before=e}function Vo(t,e){return ao.call(this,t,"array-contains-any",e)||this}function Co(t,e){return ho.call(this,t,"in",e)||this}function Uo(t,e){return co.call(this,t,"array-contains",e)||this}function jo(t,e){var n=this;return(n=fo.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return Hr.Z(t.referenceValue)}),n}function Mo(t,e,n){var r=this;return(r=lo.call(this,t,e,n)||this).key=Hr.Z(n.referenceValue),r}function Fo(t,e,n){var r=this;return(r=po.call(this)||this).field=t,r.op=e,r.value=n,r}function qo(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.Lt=n,this.filters=r,this.limit=i,this.Bt=o,this.startAt=s,this.endAt=u,this.qt=null,this.Ut=null,this.startAt&&this.Qt(this.startAt),this.endAt&&this.Qt(this.endAt)}function Bo(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.$t=null}function Go(){return null!==yo&&yo.apply(this,arguments)||this}function zo(t,e,n){var r=this;return(r=vo.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Wo(t,e,n,r){var i=this;return(i=go.call(this,t,e)||this).Mt=n,i.At=!!r.At,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Ko(t){switch(t){case Nr.OK:return Bs(),0;case Nr.CANCELLED:case Nr.UNKNOWN:case Nr.DEADLINE_EXCEEDED:case Nr.RESOURCE_EXHAUSTED:case Nr.INTERNAL:case Nr.UNAVAILABLE:case Nr.UNAUTHENTICATED:return;case Nr.INVALID_ARGUMENT:case Nr.NOT_FOUND:case Nr.ALREADY_EXISTS:case Nr.PERMISSION_DENIED:case Nr.FAILED_PRECONDITION:case Nr.ABORTED:case Nr.OUT_OF_RANGE:case Nr.UNIMPLEMENTED:case Nr.DATA_LOSS:return 1;default:return Bs(),0}}function Ho(t){if(void 0===t)return Fs("GRPC error has no .code"),Nr.UNKNOWN;switch(t){case so.OK:return Nr.OK;case so.CANCELLED:return Nr.CANCELLED;case so.UNKNOWN:return Nr.UNKNOWN;case so.DEADLINE_EXCEEDED:return Nr.DEADLINE_EXCEEDED;case so.RESOURCE_EXHAUSTED:return Nr.RESOURCE_EXHAUSTED;case so.INTERNAL:return Nr.INTERNAL;case so.UNAVAILABLE:return Nr.UNAVAILABLE;case so.UNAUTHENTICATED:return Nr.UNAUTHENTICATED;case so.INVALID_ARGUMENT:return Nr.INVALID_ARGUMENT;case so.NOT_FOUND:return Nr.NOT_FOUND;case so.ALREADY_EXISTS:return Nr.ALREADY_EXISTS;case so.PERMISSION_DENIED:return Nr.PERMISSION_DENIED;case so.FAILED_PRECONDITION:return Nr.FAILED_PRECONDITION;case so.ABORTED:return Nr.ABORTED;case so.OUT_OF_RANGE:return Nr.OUT_OF_RANGE;case so.UNIMPLEMENTED:return Nr.UNIMPLEMENTED;case so.DATA_LOSS:return Nr.DATA_LOSS;default:return Bs()}}(uo=so=so||{})[uo.OK=0]="OK",uo[uo.CANCELLED=1]="CANCELLED",uo[uo.UNKNOWN=2]="UNKNOWN",uo[uo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",uo[uo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",uo[uo.NOT_FOUND=5]="NOT_FOUND",uo[uo.ALREADY_EXISTS=6]="ALREADY_EXISTS",uo[uo.PERMISSION_DENIED=7]="PERMISSION_DENIED",uo[uo.UNAUTHENTICATED=16]="UNAUTHENTICATED",uo[uo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",uo[uo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",uo[uo.ABORTED=10]="ABORTED",uo[uo.OUT_OF_RANGE=11]="OUT_OF_RANGE",uo[uo.UNIMPLEMENTED=12]="UNIMPLEMENTED",uo[uo.INTERNAL=13]="INTERNAL",uo[uo.UNAVAILABLE=14]="UNAVAILABLE",uo[uo.DATA_LOSS=15]="DATA_LOSS";var Qo=(Zo.prototype.Ae=function(t,e){return new Zo(this.N,this.root.Ae(t,e,this.N).me(null,null,Xo.Pe,null,null))},Zo.prototype.remove=function(t){return new Zo(this.N,this.root.remove(t,this.N).me(null,null,Xo.Pe,null,null))},Zo.prototype.get=function(t){for(var e=this.root;!e.B();){var n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Zo.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.B();){var r=this.N(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Zo.prototype.B=function(){return this.root.B()},Object.defineProperty(Zo.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),Zo.prototype.Ve=function(){return this.root.Ve()},Zo.prototype.ge=function(){return this.root.ge()},Zo.prototype.pe=function(t){return this.root.pe(t)},Zo.prototype.forEach=function(n){this.pe(function(t,e){return n(t,e),!1})},Zo.prototype.toString=function(){var n=[];return this.pe(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Zo.prototype.ye=function(t){return this.root.ye(t)},Zo.prototype.be=function(){return new Yo(this.root,null,this.N,!1)},Zo.prototype.ve=function(t){return new Yo(this.root,t,this.N,!1)},Zo.prototype.Se=function(){return new Yo(this.root,null,this.N,!0)},Zo.prototype.De=function(t){return new Yo(this.root,t,this.N,!0)},Zo),Yo=($o.prototype.Ne=function(){var t=this.Fe.pop(),e={key:t.key,value:t.value};if(this.Ce)for(t=t.left;!t.B();)this.Fe.push(t),t=t.right;else for(t=t.right;!t.B();)this.Fe.push(t),t=t.left;return e},$o.prototype.ke=function(){return 0<this.Fe.length},$o.prototype.Me=function(){if(0===this.Fe.length)return null;var t=this.Fe[this.Fe.length-1];return{key:t.key,value:t.value}},$o),Xo=(Jo.prototype.me=function(t,e,n,r,i){return new Jo(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Jo.prototype.B=function(){return!1},Jo.prototype.pe=function(t){return this.left.pe(t)||t(this.key,this.value)||this.right.pe(t)},Jo.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},Jo.prototype.min=function(){return this.left.B()?this:this.left.min()},Jo.prototype.Ve=function(){return this.min().key},Jo.prototype.ge=function(){return this.right.B()?this.key:this.right.ge()},Jo.prototype.Ae=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.me(null,null,null,r.left.Ae(t,e,n),null):0===i?r.me(null,e,null,null,null):r.me(null,null,null,null,r.right.Ae(t,e,n))).xe()},Jo.prototype.$e=function(){if(this.left.B())return Jo.EMPTY;var t=this;return t.left.Oe()||t.left.left.Oe()||(t=t.Le()),(t=t.me(null,null,null,t.left.$e(),null)).xe()},Jo.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.B()||r.left.Oe()||r.left.left.Oe()||(r=r.Le()),r=r.me(null,null,null,r.left.remove(t,e),null);else{if(r.left.Oe()&&(r=r.Be()),r.right.B()||r.right.Oe()||r.right.left.Oe()||(r=r.qe()),0===e(t,r.key)){if(r.right.B())return Jo.EMPTY;n=r.right.min(),r=r.me(n.key,n.value,null,null,r.right.$e())}r=r.me(null,null,null,null,r.right.remove(t,e))}return r.xe()},Jo.prototype.Oe=function(){return this.color},Jo.prototype.xe=function(){var t=this;return t.right.Oe()&&!t.left.Oe()&&(t=t.Ue()),t.left.Oe()&&t.left.left.Oe()&&(t=t.Be()),t.left.Oe()&&t.right.Oe()&&(t=t.Qe()),t},Jo.prototype.Le=function(){var t=this.Qe();return t.right.left.Oe()&&(t=(t=(t=t.me(null,null,null,null,t.right.Be())).Ue()).Qe()),t},Jo.prototype.qe=function(){var t=this.Qe();return t.left.left.Oe()&&(t=(t=t.Be()).Qe()),t},Jo.prototype.Ue=function(){var t=this.me(null,null,Jo.RED,null,this.right.left);return this.right.me(null,null,this.color,t,null)},Jo.prototype.Be=function(){var t=this.me(null,null,Jo.RED,this.left.right,null);return this.left.me(null,null,this.color,null,t)},Jo.prototype.Qe=function(){var t=this.left.me(null,null,!this.left.color,null,null),e=this.right.me(null,null,!this.right.color,null,null);return this.me(null,null,!this.color,t,e)},Jo.prototype.We=function(){var t=this.je();return Math.pow(2,t)<=this.size+1},Jo.prototype.je=function(){if(this.Oe()&&this.left.Oe())throw Bs();if(this.right.Oe())throw Bs();var t=this.left.je();if(t!==this.right.je())throw Bs();return t+(this.Oe()?0:1)},Jo);function Jo(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Jo.RED,this.left=null!=r?r:Jo.EMPTY,this.right=null!=i?i:Jo.EMPTY,this.size=this.left.size+1+this.right.size}function $o(t,e,n,r){this.Ce=r,this.Fe=[];for(var i=1;!t.B();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Ce?t.left:t.right;else{if(0===i){this.Fe.push(t);break}this.Fe.push(t),t=this.Ce?t.right:t.left}}function Zo(t,e){this.N=t,this.root=e||Xo.EMPTY}function ts(){this.size=0}Xo.EMPTY=null,Xo.RED=!0,Xo.Pe=!1,Xo.EMPTY=(Object.defineProperty(ts.prototype,"key",{get:function(){throw Bs()},enumerable:!0,configurable:!0}),Object.defineProperty(ts.prototype,"value",{get:function(){throw Bs()},enumerable:!0,configurable:!0}),Object.defineProperty(ts.prototype,"color",{get:function(){throw Bs()},enumerable:!0,configurable:!0}),Object.defineProperty(ts.prototype,"left",{get:function(){throw Bs()},enumerable:!0,configurable:!0}),Object.defineProperty(ts.prototype,"right",{get:function(){throw Bs()},enumerable:!0,configurable:!0}),ts.prototype.me=function(t,e,n,r,i){return this},ts.prototype.Ae=function(t,e,n){return new Xo(t,e)},ts.prototype.remove=function(t,e){return this},ts.prototype.B=function(){return!0},ts.prototype.pe=function(t){return!1},ts.prototype.ye=function(t){return!1},ts.prototype.Ve=function(){return null},ts.prototype.ge=function(){return null},ts.prototype.Oe=function(){return!1},ts.prototype.We=function(){return!0},ts.prototype.je=function(){return 0},new ts);var es=(os.prototype.has=function(t){return null!==this.data.get(t)},os.prototype.first=function(){return this.data.Ve()},os.prototype.last=function(){return this.data.ge()},Object.defineProperty(os.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),os.prototype.indexOf=function(t){return this.data.indexOf(t)},os.prototype.forEach=function(n){this.data.pe(function(t,e){return n(t),!1})},os.prototype.Ke=function(t,e){for(var n=this.data.ve(t[0]);n.ke();){var r=n.Ne();if(0<=this.N(r.key,t[1]))return;e(r.key)}},os.prototype.Ge=function(t,e){for(var n=void 0!==e?this.data.ve(e):this.data.be();n.ke();)if(!t(n.Ne().key))return},os.prototype.ze=function(t){var e=this.data.ve(t);return e.ke()?e.Ne().key:null},os.prototype.be=function(){return new ns(this.data.be())},os.prototype.ve=function(t){return new ns(this.data.ve(t))},os.prototype.add=function(t){return this.me(this.data.remove(t).Ae(t,!0))},os.prototype.delete=function(t){return this.has(t)?this.me(this.data.remove(t)):this},os.prototype.B=function(){return this.data.B()},os.prototype.He=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},os.prototype.isEqual=function(t){if(!(t instanceof os))return!1;if(this.size!==t.size)return!1;for(var e=this.data.be(),n=t.data.be();e.ke();){var r=e.Ne().key,i=n.Ne().key;if(0!==this.N(r,i))return!1}return!0},os.prototype.W=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},os.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},os.prototype.me=function(t){var e=new os(this.N);return e.data=t,e},os),ns=(is.prototype.Ne=function(){return this.Ye.Ne().key},is.prototype.ke=function(){return this.Ye.ke()},is),rs=new Qo(Hr.N);function is(t){this.Ye=t}function os(t){this.N=t,this.data=new Qo(this.N)}var ss=new Qo(Hr.N);var us=new Qo(Hr.N),as=new es(Hr.N);function hs(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=as,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var cs=new es(Ks);function fs(t,e,n,r){this.ws=t,this.removedTargetIds=e,this.key=n,this.Rs=r}function ls(t,e){this.targetId=t,this.As=e}function ps(t,e,n,r){void 0===n&&(n=$r.ht),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var ds=(Ss.Ze=function(t){return new Ss(t.N)},Ss.prototype.has=function(t){return null!=this.Je.get(t)},Ss.prototype.get=function(t){return this.Je.get(t)},Ss.prototype.first=function(){return this.Xe.Ve()},Ss.prototype.last=function(){return this.Xe.ge()},Ss.prototype.B=function(){return this.Xe.B()},Ss.prototype.indexOf=function(t){var e=this.Je.get(t);return e?this.Xe.indexOf(e):-1},Object.defineProperty(Ss.prototype,"size",{get:function(){return this.Xe.size},enumerable:!0,configurable:!0}),Ss.prototype.forEach=function(n){this.Xe.pe(function(t,e){return n(t),!1})},Ss.prototype.add=function(t){var e=this.delete(t.key);return e.me(e.Je.Ae(t.key,t),e.Xe.Ae(t,null))},Ss.prototype.delete=function(t){var e=this.get(t);return e?this.me(this.Je.remove(t),this.Xe.remove(e)):this},Ss.prototype.isEqual=function(t){if(!(t instanceof Ss))return!1;if(this.size!==t.size)return!1;for(var e=this.Xe.be(),n=t.Xe.be();e.ke();){var r=e.Ne().key,i=n.Ne().key;if(!r.isEqual(i))return!1}return!0},Ss.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},Ss.prototype.me=function(t,e){var n=new Ss;return n.N=this.N,n.Je=t,n.Xe=e,n},Ss),ys=(As.prototype.track=function(t){var e=t.doc.key,n=this.ts.get(e);!n||0!==t.type&&3===n.type?this.ts=this.ts.Ae(e,t):3===t.type&&1!==n.type?this.ts=this.ts.Ae(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ts=this.ts.Ae(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ts=this.ts.Ae(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ts=this.ts.remove(e):1===t.type&&2===n.type?this.ts=this.ts.Ae(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ts=this.ts.Ae(e,{type:2,doc:t.doc}):Bs()},As.prototype.es=function(){var n=[];return this.ts.pe(function(t,e){n.push(e)}),n},As),vs=(_s.os=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new _s(t,e,ds.Ze(e),i,n,r,!0,!1)},Object.defineProperty(_s.prototype,"hasPendingWrites",{get:function(){return!this.ns.B()},enumerable:!0,configurable:!0}),_s.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.rs===t.rs&&this.ns.isEqual(t.ns)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ss.isEqual(t.ss)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},_s),gs=(Ns.ls=function(t,e){var n=new Map;return n.set(t,ms.ds(t,e)),new Ns(Pr.min(),n,cs,rs,hs())},Ns),ms=(Is.ds=function(t,e){return new Is($r.ht,e,hs(),hs(),hs())},Is),ws=(Object.defineProperty(Ts.prototype,"fs",{get:function(){return this.gs},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"resumeToken",{get:function(){return this.Vs},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"ys",{get:function(){return 0!==this.ms},enumerable:!0,configurable:!0}),Object.defineProperty(Ts.prototype,"bs",{get:function(){return this.ps},enumerable:!0,configurable:!0}),Ts.prototype.vs=function(t){0<t.rt()&&(this.ps=!0,this.Vs=t)},Ts.prototype.Ss=function(){var n=hs(),r=hs(),i=hs();return this.Ps.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Bs()}}),new ms(this.Vs,this.gs,n,r,i)},Ts.prototype.Ds=function(){this.ps=!1,this.Ps=xs()},Ts.prototype.Cs=function(t,e){this.ps=!0,this.Ps=this.Ps.Ae(t,e)},Ts.prototype.Fs=function(t){this.ps=!0,this.Ps=this.Ps.remove(t)},Ts.prototype.Ns=function(){this.ms+=1},Ts.prototype.ks=function(){--this.ms},Ts.prototype.Ms=function(){this.ps=!0,this.gs=!0},Ts),bs=(Es.prototype.qs=function(t){for(var e=0,n=t.ws;e<n.length;e++){var r=n[e];t.Rs instanceof mo?this.Us(r,t.Rs):t.Rs instanceof wo&&this.Qs(r,t.key,t.Rs)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Qs(s,t.key,t.Rs)}},Es.prototype.Ws=function(n){var r=this;this.js(n,function(t){var e=r.Ks(t);switch(n.state){case 0:r.Gs(t)&&e.vs(n.resumeToken);break;case 1:e.ks(),e.ys||e.Ds(),e.vs(n.resumeToken);break;case 2:e.ks(),e.ys||r.removeTarget(t);break;case 3:r.Gs(t)&&(e.Ms(),e.vs(n.resumeToken));break;case 4:r.Gs(t)&&(r.zs(t),e.vs(n.resumeToken));break;default:Bs()}})},Es.prototype.js=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.$s.forEach(function(t,e){r.Gs(e)&&n(e)})},Es.prototype.Hs=function(t){var e,n,r=t.targetId,i=t.As.count,o=this.Ys(r);o&&((e=o.target).Ot()?0===i?(n=new Hr(e.path),this.Qs(r,n,new wo(n,Pr.min()))):Gs(1===i):this.Js(r)!==i&&(this.zs(r),this.Bs=this.Bs.add(r)))},Es.prototype.Xs=function(i){var o=this,s=new Map;this.$s.forEach(function(t,e){var n,r=o.Ys(e);r&&(t.fs&&r.target.Ot()&&(n=new Hr(r.target.path),null!==o.Os.get(n)||o.Zs(e,n)||o.Qs(e,n,new wo(n,i))),t.bs&&(s.set(e,t.Ss()),t.Ds()))});var r=hs();this.Ls.forEach(function(t,e){var n=!0;e.Ge(function(t){var e=o.Ys(t);return!e||2===e.Te||(n=!1)}),n&&(r=r.add(t))});var t=new gs(i,s,this.Bs,this.Os,r);return this.Os=rs,this.Ls=Rs(),this.Bs=new es(Ks),t},Es.prototype.Us=function(t,e){var n;this.Gs(t)&&(n=this.Zs(t,e.key)?2:0,this.Ks(t).Cs(e.key,n),this.Os=this.Os.Ae(e.key,e),this.Ls=this.Ls.Ae(e.key,this.ti(e.key).add(t)))},Es.prototype.Qs=function(t,e,n){var r;this.Gs(t)&&(r=this.Ks(t),this.Zs(t,e)?r.Cs(e,1):r.Fs(e),this.Ls=this.Ls.Ae(e,this.ti(e).delete(t)),n&&(this.Os=this.Os.Ae(e,n)))},Es.prototype.removeTarget=function(t){this.$s.delete(t)},Es.prototype.Js=function(t){var e=this.Ks(t).Ss();return this.xs.ei(t).size+e.Ts.size-e.Is.size},Es.prototype.Ns=function(t){this.Ks(t).Ns()},Es.prototype.Ks=function(t){var e=this.$s.get(t);return e||(e=new ws,this.$s.set(t,e)),e},Es.prototype.ti=function(t){var e=this.Ls.get(t);return e||(e=new es(Ks),this.Ls=this.Ls.Ae(t,e)),e},Es.prototype.Gs=function(t){var e=null!==this.Ys(t);return e||Ms("WatchChangeAggregator","Detected inactive target",t),e},Es.prototype.Ys=function(t){var e=this.$s.get(t);return e&&e.ys?null:this.xs.si(t)},Es.prototype.zs=function(e){var n=this;this.$s.set(e,new ws),this.xs.ei(e).forEach(function(t){n.Qs(e,t,null)})},Es.prototype.Zs=function(t,e){return this.xs.ei(t).has(e)},Es);function Es(t){this.xs=t,this.$s=new Map,this.Os=rs,this.Ls=Rs(),this.Bs=new es(Ks)}function Ts(){this.ms=0,this.Ps=xs(),this.Vs=$r.ht,this.gs=!1,this.ps=!0}function Is(t,e,n,r,i){this.resumeToken=t,this.fs=e,this.Ts=n,this.Es=r,this.Is=i}function Ns(t,e,n,r,i){this.Ee=t,this.as=e,this.us=n,this.cs=r,this._s=i}function _s(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.ss=n,this.docChanges=r,this.ns=i,this.fromCache=o,this.rs=s,this.hs=u}function As(){this.ts=new Qo(Hr.N)}function Ss(n){this.N=n?function(t,e){return n(t,e)||Hr.N(t.key,e.key)}:function(t,e){return Hr.N(t.key,e.key)},this.Je=ss,this.Xe=new Qo(this.N)}function Rs(){return new Qo(Hr.N)}function xs(){return new Qo(Hr.N)}var Ds={asc:"ASCENDING",desc:"DESCENDING"},Ps={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ks=(Os.prototype.ni=function(t){var e=void 0===t.code?Nr.UNKNOWN:Ho(t.code);return new _r(e,t.message||"")},Os.prototype.ri=function(t){return this.options.hi||ti(t)?t:{value:t}},Os.prototype.oi=function(t){var e;return ti(e="object"==typeof t?t.value:t)?null:e},Os.prototype._t=function(t){return{integerValue:""+t}},Os.prototype.lt=function(t){if(this.options.hi){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ei(t)?"-0":t}},Os.prototype.ai=function(t){return ni(t)?this._t(t):this.lt(t)},Os.prototype.C=function(t){return this.options.hi?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Os.prototype.v=function(t){var e=li(t);return new Dr(e.seconds,e.nanos)},Os.prototype.ui=function(t){return this.options.hi?t.toBase64():t.toUint8Array()},Os.prototype.ci=function(t){return this.options.hi?(Gs(void 0===t||"string"==typeof t),$r.fromBase64String(t||"")):(Gs(void 0===t||t instanceof Uint8Array),$r.fromUint8Array(t||new Uint8Array))},Os.prototype.toVersion=function(t){return this.C(t.C())},Os.prototype.fromVersion=function(t){return Gs(!!t),Pr.v(this.v(t))},Os.prototype._i=function(t,e){return this.li(e||this.ii).child("documents").child(t).j()},Os.prototype.di=function(t){var e=Or.K(t);return Gs(Ls(e)),e},Os.prototype.fi=function(t){return this._i(t.path)},Os.prototype.Z=function(t){var e=this.di(t);return Gs(e.get(1)===this.ii.projectId),Gs(!e.get(3)&&!this.ii.database||e.get(3)===this.ii.database),new Hr(this.Ti(e))},Os.prototype.Ei=function(t){return this._i(t)},Os.prototype.Ii=function(t){var e=this.di(t);return 4===e.length?Or.G:this.Ti(e)},Object.defineProperty(Os.prototype,"wi",{get:function(){return new Or(["projects",this.ii.projectId,"databases",this.ii.database]).j()},enumerable:!0,configurable:!0}),Os.prototype.li=function(t){return new Or(["projects",t.projectId,"databases",t.database])},Os.prototype.Ti=function(t){return Gs(4<t.length&&"documents"===t.get(4)),t.M(5)},Os.prototype.Ri=function(t,e){return{name:this.fi(t),fields:e.proto.mapValue.fields}},Os.prototype.Ai=function(t){return{name:this.fi(t.key),fields:t.xt().mapValue.fields,updateTime:this.C(t.version.C())}},Os.prototype.mi=function(t,e){var n=this.Z(t.name),r=this.fromVersion(t.updateTime),i=new Wi({mapValue:{fields:t.fields}});return new mo(n,r,i,{hasCommittedMutations:!!e})},Os.prototype.Pi=function(t){Gs(!!t.found),t.found.name,t.found.updateTime;var e=this.Z(t.found.name),n=this.fromVersion(t.found.updateTime),r=new Wi({mapValue:{fields:t.found.fields}});return new mo(e,n,r,{})},Os.prototype.Vi=function(t){Gs(!!t.missing),Gs(!!t.readTime);var e=this.Z(t.missing),n=this.fromVersion(t.readTime);return new wo(e,n)},Os.prototype.gi=function(t){return"found"in t?this.Pi(t):"missing"in t?this.Vi(t):Bs()},Os.prototype.pi=function(t){if("targetChange"in t){t.targetChange;var e=this.yi(t.targetChange.targetChangeType||"NO_CHANGE"),n=t.targetChange.targetIds||[],r=this.ci(t.targetChange.resumeToken),i=t.targetChange.cause,o=i&&this.ni(i),s=new ps(e,n,r,o||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var a=this.Z(u.document.name),h=this.fromVersion(u.document.updateTime),c=new Wi({mapValue:{fields:u.document.fields}}),f=new mo(a,h,c,{}),l=u.targetIds||[],p=u.removedTargetIds||[];s=new fs(l,p,f.key,f)}else if("documentDelete"in t){t.documentDelete;var d=t.documentDelete;d.document;var y=this.Z(d.document),v=d.readTime?this.fromVersion(d.readTime):Pr.min(),g=new wo(y,v),m=d.removedTargetIds||[];s=new fs([],m,g.key,g)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=this.Z(w.document),E=w.removedTargetIds||[];s=new fs([],E,b,null)}else{if(!("filter"in t))return Bs();t.filter;var T=t.filter;T.targetId;var I=T.count||0,N=new oo(I),_=T.targetId;s=new ls(_,N)}return s},Os.prototype.yi=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Bs()},Os.prototype.bi=function(t){if(!("targetChange"in t))return Pr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Pr.min():this.fromVersion(e.readTime)},Os.prototype.vi=function(t){var e,n=this;if(t instanceof Fi)e={update:this.Ri(t.key,t.value)};else if(t instanceof Gi)e={delete:this.fi(t.key)};else if(t instanceof qi)e={update:this.Ri(t.key,t.data),updateMask:this.Si(t.Vt)};else if(t instanceof Bi)e={transform:{document:this.fi(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.Di(t)})}};else{if(!(t instanceof zi))return Bs();e={verify:this.fi(t.key)}}return t.Rt.Tt||(e.currentDocument=this.Ci(t.Rt)),e},Os.prototype.Fi=function(t){var e=this,n=t.currentDocument?this.Ni(t.currentDocument):ji.ft();if(t.update){t.update.name;var r=this.Z(t.update.name),i=new Wi({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.ki(t.updateMask);return new qi(r,i,o,n)}return new Fi(r,i,n)}if(t.delete){var s=this.Z(t.delete);return new Gi(s,n)}if(t.transform){var u=this.Z(t.transform.document),a=t.transform.fieldTransforms.map(function(t){return e.Mi(t)});return Gs(!0===n.exists),new Bi(u,a)}if(t.verify){var h=this.Z(t.verify);return new zi(h,n)}return Bs()},Os.prototype.Ci=function(t){return void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Bs()},Os.prototype.Ni=function(t){return void 0!==t.updateTime?ji.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?ji.exists(t.exists):ji.ft()},Os.prototype.xi=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(Pr.min())&&(n=this.fromVersion(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new Di(n,r)},Os.prototype.$i=function(t,e){var n=this;return t&&0<t.length?(Gs(void 0!==e),t.map(function(t){return n.xi(t,e)})):[]},Os.prototype.Di=function(t){var e=t.transform;if(e instanceof Ei)return{fieldPath:t.field.j(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ii)return{fieldPath:t.field.j(),appendMissingElements:{values:e.elements}};if(e instanceof Ni)return{fieldPath:t.field.j(),removeAllFromArray:{values:e.elements}};if(e instanceof _i)return{fieldPath:t.field.j(),increment:e.ct};throw Bs()},Os.prototype.Mi=function(t){var e,n,r=null;"setToServerValue"in t?(Gs("REQUEST_TIME"===t.setToServerValue),r=Ei.instance):"appendMissingElements"in t?(e=t.appendMissingElements.values||[],r=new Ii(e)):"removeAllFromArray"in t?(n=t.removeAllFromArray.values||[],r=new Ni(n)):"increment"in t?r=new _i(this,t.increment):Bs();var i=Wr.X(t.fieldPath);return new Ui(i,r)},Os.prototype.Oi=function(t){return{documents:[this.Ei(t.path)]}},Os.prototype.Li=function(t){Gs(1===t.documents.length);var e=t.documents[0];return To.Wt(this.Ii(e)).ee()},Os.prototype.Bi=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(e.parent=this.Ei(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=this.Ei(n.$()),e.structuredQuery.from=[{collectionId:n.L()}]);var r=this.qi(t.filters);r&&(e.structuredQuery.where=r);var i=this.Ui(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ri(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Qi(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Qi(t.endAt)),e},Os.prototype.Wi=function(t){var e,n=this.Ii(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Gs(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=this.ji(r.where));var u=[];r.orderBy&&(u=this.Ki(r.orderBy));var a=null;r.limit&&(a=this.oi(r.limit));var h=null;r.startAt&&(h=this.Gi(r.startAt));var c=null;return r.endAt&&(c=this.Gi(r.endAt)),new To(n,o,u,s,a,"F",h,c).ee()},Os.prototype.zi=function(t){var e=this.Hi(t.Te);return null==e?null:{"goog-listen-tags":e}},Os.prototype.Hi=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Bs()}},Os.prototype.ee=function(t){var e,n=t.target;return(e=n.Ot()?{documents:this.Oi(n)}:{query:this.Bi(n)}).targetId=t.targetId,0<t.resumeToken.rt()&&(e.resumeToken=this.ui(t.resumeToken)),e},Os.prototype.qi=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof Io?e.Yi(t):Bs()});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Os.prototype.ji=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Ji(t)]:void 0!==t.fieldFilter?[this.Xi(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.ji(t)}).reduce(function(t,e){return t.concat(e)}):Bs():[]},Os.prototype.Ui=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.Zi(t)})},Os.prototype.Ki=function(t){var e=this;return t.map(function(t){return e.tn(t)})},Os.prototype.Qi=function(t){return{before:t.before,values:t.position}},Os.prototype.Gi=function(t){var e=!!t.before,n=t.values||[];return new xo(n,e)},Os.prototype.en=function(t){return Ds[t]},Os.prototype.sn=function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}},Os.prototype.nn=function(t){return Ps[t]},Os.prototype.rn=function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Bs()}},Os.prototype.hn=function(t){return{fieldPath:t.j()}},Os.prototype.on=function(t){return Wr.X(t.fieldPath)},Os.prototype.Zi=function(t){return{field:this.hn(t.field),direction:this.en(t.dir)}},Os.prototype.tn=function(t){return new Do(this.on(t.field),this.sn(t.direction))},Os.prototype.Xi=function(t){return Io.create(this.on(t.fieldFilter.field),this.rn(t.fieldFilter.op),t.fieldFilter.value)},Os.prototype.Yi=function(t){if("=="===t.op){if(wi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NAN"}};if(mi(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.hn(t.field),op:this.nn(t.op),value:t.value}}},Os.prototype.Ji=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.on(t.unaryFilter.field);return Io.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=this.on(t.unaryFilter.field);return Io.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Bs()}},Os.prototype.Si=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.j())}),{fieldPaths:e}},Os.prototype.ki=function(t){var e=t.fieldPaths||[];return new Ci(e.map(function(t){return Wr.X(t)}))},Os);function Os(t,e){this.ii=t,this.options=e}function Ls(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var Vs=(Us.an=function(t){Us.platform&&Bs(),Us.platform=t},Us.nt=function(){return Us.platform||Bs(),Us.platform},Us),Cs=new h("@firebase/firestore");function Us(){}function js(){return Cs.logLevel}function Ms(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Cs.logLevel<=p.DEBUG&&(e=n.map(qs),Cs.debug.apply(Cs,d(["Firestore ("+mr+"): "+t],e)))}function Fs(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Cs.logLevel<=p.ERROR&&(e=n.map(qs),Cs.error.apply(Cs,d(["Firestore ("+mr+"): "+t],e)))}function qs(t){if("string"==typeof t)return t;var e=Vs.nt();try{return e.un(t)}catch(e){return t}}function Bs(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+mr+") INTERNAL ASSERTION FAILED: "+t;throw Fs(e),new Error(e)}function Gs(t){t||Bs()}var zs=(Ws.cn=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Vs.nt()._n(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Ws);function Ws(){}function Ks(t,e){return t<e?-1:e<t?1:0}function Hs(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Qs(t){return t+"\0"}function Ys(t,e,n,r,i){this.ii=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Xs=(Object.defineProperty(vu.prototype,"ln",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),vu.prototype.isEqual=function(t){return t instanceof vu&&t.projectId===this.projectId&&t.database===this.database},vu.prototype.S=function(t){return Ks(this.projectId,t.projectId)||Ks(this.database,t.database)},vu),Js=(yu.prototype.get=function(t){var e=this.dn(t),n=this.fn[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},yu.prototype.has=function(t){return void 0!==this.get(t)},yu.prototype.set=function(t,e){var n=this.dn(t),r=this.fn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.fn[n]=[[t,e]]},yu.prototype.delete=function(t){var e=this.dn(t),n=this.fn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.fn[e]:n.splice(r,1),!0;return!1},yu.prototype.forEach=function(u){Xr(this.fn,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},yu.prototype.B=function(){return Jr(this.fn)},yu),$s=(du.prototype.at=function(t,e,n){for(var r=n.En,i=0;i<this.mutations.length;i++){var o,s=this.mutations[i];s.key.isEqual(t)&&(o=r[i],e=s.at(e,o))}return e},du.prototype.ot=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=i.ot(e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=a.ot(e,o,this.Tn))}return e},du.prototype.In=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.ot(t.key,n.get(t.key));e&&(i=i.Ae(t.key,e))}),i},du.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},hs())},du.prototype.isEqual=function(t){return this.batchId===t.batchId&&Hs(this.mutations,t.mutations,function(t,e){return t.isEqual(e)})&&Hs(this.baseMutations,t.baseMutations,function(t,e){return t.isEqual(e)})},du),Zs=(pu.from=function(t,e,n){Gs(t.mutations.length===n.length);for(var r=us,i=t.mutations,o=0;o<i.length;o++)r=r.Ae(i[o].key,n[o].version);return new pu(t,e,n,r)},pu),tu=(lu.prototype.catch=function(t){return this.next(void 0,t)},lu.prototype.next=function(r,i){var o=this;return this.Vn&&Bs(),this.Vn=!0,this.Pn?this.error?this.gn(i,this.error):this.pn(r,this.result):new lu(function(e,n){o.An=function(t){o.pn(r,t).next(e,n)},o.mn=function(t){o.gn(i,t).next(e,n)}})},lu.prototype.yn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},lu.prototype.bn=function(t){try{var e=t();return e instanceof lu?e:lu.resolve(e)}catch(t){return lu.reject(t)}},lu.prototype.pn=function(t,e){return t?this.bn(function(){return t(e)}):lu.resolve(e)},lu.prototype.gn=function(t,e){return t?this.bn(function(){return t(e)}):lu.reject(e)},lu.resolve=function(n){return new lu(function(t,e){t(n)})},lu.reject=function(n){return new lu(function(t,e){e(n)})},lu.vn=function(t){return new lu(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},lu.Sn=function(t){for(var n=lu.resolve(!1),e=0,r=t;e<r.length;e++)!function(e){n=n.next(function(t){return t?lu.resolve(t):e()})}(r[e]);return n},lu.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.vn(i)},lu),eu=(Object.defineProperty(fu.prototype,"readTime",{get:function(){return this.Fn},set:function(t){this.Fn=t},enumerable:!0,configurable:!0}),fu.prototype.Nn=function(t,e){this.kn(),this.readTime=e,this.Dn.set(t.key,t)},fu.prototype.Mn=function(t,e){this.kn(),e&&(this.readTime=e),this.Dn.set(t,null)},fu.prototype.xn=function(t,e){this.kn();var n=this.Dn.get(e);return void 0!==n?tu.resolve(n):this.$n(t,e)},fu.prototype.getEntries=function(t,e){return this.On(t,e)},fu.prototype.apply=function(t){return this.kn(),this.Cn=!0,this.Ln(t)},fu.prototype.kn=function(){},fu),nu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ru=(cu.prototype.qn=function(t){this.Bn.push(t)},cu.prototype.Un=function(){this.Bn.forEach(function(t){return t()})},cu),iu=(hu.prototype.Kn=function(e,n){var r=this;return this.Wn.Gn(e,n).next(function(t){return r.zn(e,n,t)})},hu.prototype.zn=function(t,r,i){return this.Qn.xn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].ot(r,t);return t})},hu.prototype.Hn=function(t,e,i){var o=rs;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].ot(t,e);o=o.Ae(t,e)}),o},hu.prototype.Yn=function(e,t){var n=this;return this.Qn.getEntries(e,t).next(function(t){return n.Jn(e,t)})},hu.prototype.Jn=function(r,i){var o=this;return this.Wn.Xn(r,i).next(function(t){var e=o.Hn(r,i,t),n=rs;return e.forEach(function(t,e){e=e||new wo(t,Pr.min()),n=n.Ae(t,e)}),n})},hu.prototype.Zn=function(t,e,n){return e.Ot()?this.tr(t,e.path):e._e()?this.er(t,e,n):this.sr(t,e,n)},hu.prototype.tr=function(t,e){return this.Kn(t,new Hr(e)).next(function(t){var e=ss;return t instanceof mo&&(e=e.Ae(t.key,t)),e})},hu.prototype.er=function(n,r,i){var o=this,s=r.collectionGroup,u=ss;return this.jn.ir(n,s).next(function(t){return tu.forEach(t,function(t){var e=r.Zt(t.child(s));return o.sr(n,e,i).next(function(t){t.forEach(function(t,e){u=u.Ae(t,e)})})}).next(function(){return u})})},hu.prototype.sr=function(e,n,t){var c,f,r=this;return this.Qn.Zn(e,n,t).next(function(t){return c=t,r.Wn.nr(e,n)}).next(function(t){return f=t,r.rr(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=s.ot(a,a,r.Tn);c=h instanceof mo?c.Ae(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){n.matches(e)||(c=c.remove(t))}),c})},hu.prototype.rr=function(t,e,n){for(var r=hs(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof qi&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.Qn.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof mo&&(h=h.Ae(t,e))}),h})},hu),ou=(au.ar=function(t,e){for(var n=hs(),r=hs(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new au(t,e.fromCache,n,r)},au),su=(uu.prototype.cr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},uu.prototype.next=function(){var t=++this.previousValue;return this._r&&this._r(t),t},uu);function uu(t,e){var n=this;this.previousValue=t,e&&(e.ur=function(t){return n.cr(t)},this._r=function(t){return e.lr(t)})}function au(t,e,n,r){this.targetId=t,this.fromCache=e,this.hr=n,this.or=r}function hu(t,e,n){this.Qn=t,this.Wn=e,this.jn=n}function cu(){this.Bn=[]}function fu(){this.Dn=new Js(function(t){return t.toString()}),this.Cn=!1}function lu(t){var e=this;this.An=null,this.mn=null,this.result=void 0,this.error=void 0,this.Pn=!1,this.Vn=!1,t(function(t){e.Pn=!0,e.result=t,e.An&&e.An(t)},function(t){e.Pn=!0,e.error=t,e.mn&&e.mn(t)})}function pu(t,e,n,r){this.batch=t,this.wn=e,this.En=n,this.Rn=r}function du(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}function yu(t){this.dn=t,this.fn={}}function vu(t,e){this.projectId=t,this.database=e||"(default)"}su.dr=-1;function gu(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var mu=(wu.prototype.reset=function(){this.Ar=0},wu.prototype.Vr=function(){this.Ar=this.Rr},wu.prototype.gr=function(t){var e=this;this.cancel();var n=Math.floor(this.Ar+this.pr()),r=Math.max(0,Date.now()-this.Pr),i=Math.max(0,n-r);0<i&&Ms("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Ar+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.mr=this.Tr.yr(this.Er,i,function(){return e.Pr=Date.now(),t()}),this.Ar*=this.wr,this.Ar<this.Ir&&(this.Ar=this.Ir),this.Ar>this.Rr&&(this.Ar=this.Rr)},wu.prototype.br=function(){null!==this.mr&&(this.mr.vr(),this.mr=null)},wu.prototype.cancel=function(){null!==this.mr&&(this.mr.cancel(),this.mr=null)},wu.prototype.pr=function(){return(Math.random()-.5)*this.Ar},wu);function wu(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Tr=t,this.Er=e,this.Ir=n,this.wr=r,this.Rr=i,this.Ar=0,this.mr=null,this.Pr=Date.now(),this.reset()}function bu(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Eu(e)),e=function(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}(t.get(n),e);return Eu(e)}function Eu(t){return t+""}function Tu(t){var e=t.length;if(Gs(2<=e),2===e)return Gs(""===t.charAt(0)&&""===t.charAt(1)),Or.G;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Bs(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Bs()}o=s+2}return new Or(r)}var Iu=(Ru.prototype.Dr=function(t,e){return this.Sr.add(e),tu.resolve()},Ru.prototype.ir=function(t,e){return tu.resolve(this.Sr.getEntries(e))},Ru),Nu=(Su.prototype.add=function(t){var e=t.L(),n=t.$(),r=this.index[e]||new es(Or.N),i=!r.has(n);return this.index[e]=r.add(n),i},Su.prototype.has=function(t){var e=t.L(),n=t.$(),r=this.index[e];return r&&r.has(n)},Su.prototype.getEntries=function(t){return(this.index[t]||new es(Or.N)).W()},Su),_u=(Au.prototype.Dr=function(t,e){var n=this;if(this.Cr.has(e))return tu.resolve();var r=e.L(),i=e.$();t.qn(function(){n.Cr.add(e)});var o={collectionId:r,parent:bu(i)};return xu(t).put(o)},Au.prototype.ir=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Qs(i),""],!1,!0);return xu(t).Fr(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(Tu(r.parent))}return o})},Au);function Au(){this.Cr=new Nu}function Su(){this.index={}}function Ru(){this.Sr=new Nu}function xu(t){return Yu.Nr(t,Sa.store)}var Du,Pu=(ku.prototype.Nn=function(t,e,n){return Lu(t).put(Vu(e),n)},ku.prototype.Mn=function(t,e){var n=Lu(t),r=Vu(e);return n.delete(r)},ku.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.kr(e,t)})},ku.prototype.xn=function(t,e){var n=this;return Lu(t).get(Vu(e)).next(function(t){return n.Mr(t)})},ku.prototype.xr=function(t,e){var n=this;return Lu(t).get(Vu(e)).next(function(t){var e=n.Mr(t);return e?{$r:e,size:Cu(t)}:null})},ku.prototype.getEntries=function(t,e){var r=this,i=rs;return this.Or(t,e,function(t,e){var n=r.Mr(e);i=i.Ae(t,n)}).next(function(){return i})},ku.prototype.Lr=function(t,e){var r=this,i=rs,o=new Qo(Hr.N);return this.Or(t,e,function(t,e){var n=r.Mr(e);o=n?(i=i.Ae(t,n),o.Ae(t,Cu(e))):(i=i.Ae(t,null),o.Ae(t,0))}).next(function(){return{Br:i,qr:o}})},ku.prototype.Or=function(t,e,i){if(e.B())return tu.resolve();var n=IDBKeyRange.bound(e.first().path.W(),e.last().path.W()),o=e.be(),s=o.Ne();return Lu(t).Ur({range:n},function(t,e,n){for(var r=Hr.st(t);s&&Hr.N(s,r)<0;)i(s,null),s=o.Ne();s&&s.isEqual(r)&&(i(s,e),s=o.ke()?o.Ne():null),s?n.Qr(s.path.W()):n.done()}).next(function(){for(;s;)i(s,null),s=o.ke()?o.Ne():null})},ku.prototype.Zn=function(t,i,e){var n,r,o,s=this,u=ss,a=i.path.length+1,h={};return e.isEqual(Pr.min())?(n=i.path.W(),h.range=IDBKeyRange.lowerBound(n)):(r=i.path.W(),o=this.serializer.Wr(e),h.range=IDBKeyRange.lowerBound([r,o],!0),h.index=Ta.collectionReadTimeIndex),Lu(t).Ur(h,function(t,e,n){var r;t.length===a&&(r=s.serializer.jr(e),i.path.q(r.key.path)?r instanceof mo&&i.matches(r)&&(u=u.Ae(r.key,r)):n.done())}).next(function(){return u})},ku.prototype.Kr=function(t,e){var r=this,i=rs,o=this.serializer.Wr(e),n=Lu(t),s=IDBKeyRange.lowerBound(o,!0);return n.Ur({index:Ta.readTimeIndex,range:s},function(t,e){var n=r.serializer.jr(e);i=i.Ae(n.key,n),o=e.readTime}).next(function(){return{Gr:i,readTime:r.serializer.zr(o)}})},ku.prototype.Hr=function(t){var r=this,e=Lu(t),i=Pr.min();return e.Ur({index:Ta.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(i=r.serializer.zr(e.readTime)),n.done()}).next(function(){return i})},ku.prototype.Yr=function(t){return new ku.Jr(this,!!t&&t.Xr)},ku.prototype.Zr=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},ku.prototype.getMetadata=function(t){return Ou(t).get(Ia.key).next(function(t){return Gs(!!t),t})},ku.prototype.kr=function(t,e){return Ou(t).put(Ia.key,e)},ku.prototype.Mr=function(t){if(t){var e=this.serializer.jr(t);return e instanceof wo&&e.version.isEqual(Pr.min())?null:e}return null},ku);function ku(t,e){this.serializer=t,this.jn=e}function Ou(t){return Yu.Nr(t,Ia.store)}function Lu(t){return Yu.Nr(t,Ta.store)}function Vu(t){return t.path.W()}function Cu(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Bs();e=t.noDocument}return JSON.stringify(e).length}function Uu(t,e){var n=this;return(n=Du.call(this)||this).th=t,n.Xr=e,n.eh=new Js(function(t){return t.toString()}),n}Pu.Jr=(n(Uu,Du=eu),Uu.prototype.Ln=function(s){var u=this,a=[],h=0,c=new es(function(t,e){return Ks(t.j(),e.j())});return this.Dn.forEach(function(t,e){var n,r,i,o=u.eh.get(t);e?(n=u.th.serializer.sh(e,u.readTime),c=c.add(t.path.$()),r=Cu(n),h+=r-o,a.push(u.th.Nn(s,t,n))):(h-=o,u.Xr?(i=u.th.serializer.sh(new wo(t,Pr.min()),u.readTime),a.push(u.th.Nn(s,t,i))):a.push(u.th.Mn(s,t)))}),c.forEach(function(t){a.push(u.th.jn.Dr(s,t))}),a.push(this.th.updateMetadata(s,h)),tu.vn(a)},Uu.prototype.$n=function(t,e){var n=this;return this.th.xr(t,e).next(function(t){return null===t?(n.eh.set(e,0),null):(n.eh.set(e,t.size),t.$r)})},Uu.prototype.On=function(t,e){var n=this;return this.th.Lr(t,e).next(function(t){var e=t.Br;return t.qr.forEach(function(t,e){n.eh.set(t,e)}),e})},Uu);var ju=(qu.prototype.next=function(){return this.ih+=2,this.ih},qu.nh=function(){return new qu(0)},qu.rh=function(){return new qu(-1)},qu),Mu=(Fu.prototype.oh=function(n){var r=this;return this.ah(n).next(function(t){var e=new ju(t.highestTargetId);return t.highestTargetId=e.next(),r.uh(n,t).next(function(){return t.highestTargetId})})},Fu.prototype._h=function(t){return this.ah(t).next(function(t){return Pr.v(new Dr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Fu.prototype.lh=function(t){return this.ah(t).next(function(t){return t.highestListenSequenceNumber})},Fu.prototype.dh=function(e,n,r){var i=this;return this.ah(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.C()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.uh(e,t)})},Fu.prototype.fh=function(e,n){var r=this;return this.Th(e,n).next(function(){return r.ah(e).next(function(t){return t.targetCount+=1,r.Eh(n,t),r.uh(e,t)})})},Fu.prototype.Ih=function(t,e){return this.Th(t,e)},Fu.prototype.wh=function(e,t){var n=this;return this.Rh(e,t.targetId).next(function(){return Bu(e).delete(t.targetId)}).next(function(){return n.ah(e)}).next(function(t){return Gs(0<t.targetCount),--t.targetCount,n.uh(e,t)})},Fu.prototype.Ah=function(r,i,o){var s=this,u=0,a=[];return Bu(r).Ur(function(t,e){var n=s.serializer.mh(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.wh(r,n)))}).next(function(){return tu.vn(a)}).next(function(){return u})},Fu.prototype.js=function(t,r){var i=this;return Bu(t).Ur(function(t,e){var n=i.serializer.mh(e);r(n)})},Fu.prototype.ah=function(t){return Gu(t).get(Aa.key).next(function(t){return Gs(null!==t),t})},Fu.prototype.uh=function(t,e){return Gu(t).put(Aa.key,e)},Fu.prototype.Th=function(t,e){return Bu(t).put(this.serializer.Ph(e))},Fu.prototype.Eh=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Fu.prototype.Vh=function(t){return this.ah(t).next(function(t){return t.targetCount})},Fu.prototype.gh=function(t,i){var o=this,e=i.canonicalId(),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),s=null;return Bu(t).Ur({range:n,index:Na.queryTargetsIndexName},function(t,e,n){var r=o.serializer.mh(e);i.isEqual(r.target)&&(s=r,n.done())}).next(function(){return s})},Fu.prototype.ph=function(n,t,r){var i=this,o=[],s=zu(n);return t.forEach(function(t){var e=bu(t.path);o.push(s.put(new _a(r,e))),o.push(i.hh.yh(n,r,t))}),tu.vn(o)},Fu.prototype.bh=function(n,t,r){var i=this,o=zu(n);return tu.forEach(t,function(t){var e=bu(t.path);return tu.vn([o.delete([r,e]),i.hh.vh(n,r,t)])})},Fu.prototype.Rh=function(t,e){var n=zu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Fu.prototype.Sh=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=zu(t),o=hs();return r.Ur({range:n,Dh:!0},function(t,e,n){var r=Tu(t[1]),i=new Hr(r);o=o.add(i)}).next(function(){return o})},Fu.prototype.Ch=function(t,e){var n=bu(e.path),r=IDBKeyRange.bound([n],[Qs(n)],!1,!0),i=0;return zu(t).Ur({index:_a.documentTargetsIndex,Dh:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Fu.prototype.si=function(t,e){var n=this;return Bu(t).get(e).next(function(t){return t?n.serializer.mh(t):null})},Fu);function Fu(t,e){this.hh=t,this.serializer=e}function qu(t){this.ih=t}function Bu(t){return Yu.Nr(t,Na.store)}function Gu(t){return Yu.Nr(t,Aa.store)}function zu(t){return Yu.Nr(t,_a.store)}var Wu,Ku=($u.prototype.jr=function(t){if(t.document)return this.Fh.mi(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Hr.st(t.noDocument.path),n=this.Nh(t.noDocument.readTime);return new wo(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var r=Hr.st(t.unknownDocument.path),i=this.Nh(t.unknownDocument.version);return new bo(r,i)}return Bs()},$u.prototype.sh=function(t,e){var n=this.Wr(e),r=t.key.path.$().W();if(t instanceof mo){var i=this.Fh.Ai(t),o=t.hasCommittedMutations;return new Ta(null,null,i,o,n,r)}if(t instanceof wo){var s=t.key.path.W(),u=this.kh(t.version),a=t.hasCommittedMutations;return new Ta(null,new ba(s,u),null,a,n,r)}if(t instanceof bo){var h=t.key.path.W(),c=this.kh(t.version);return new Ta(new Ea(h,c),null,null,!0,n,r)}return Bs()},$u.prototype.Wr=function(t){var e=t.C();return[e.seconds,e.nanoseconds]},$u.prototype.zr=function(t){var e=new Dr(t[0],t[1]);return Pr.v(e)},$u.prototype.kh=function(t){var e=t.C();return new pa(e.seconds,e.nanoseconds)},$u.prototype.Nh=function(t){var e=new Dr(t.seconds,t.nanoseconds);return Pr.v(e)},$u.prototype.Mh=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.Fh.vi(t)}),i=e.mutations.map(function(t){return n.Fh.vi(t)});return new ga(t,e.batchId,e.Tn.toMillis(),r,i)},$u.prototype.xh=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.Fh.Fi(t)}),r=t.mutations.map(function(t){return e.Fh.Fi(t)}),i=Dr.fromMillis(t.localWriteTimeMs);return new $s(t.batchId,i,n,r)},$u.prototype.mh=function(t){var e=this.Nh(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?this.Nh(t.lastLimboFreeSnapshotVersion):Pr.min(),r=void 0!==t.query.documents?this.Fh.Li(t.query):this.Fh.Wi(t.query);return new Po(r,t.targetId,0,t.lastListenSequenceNumber,e,n,$r.fromBase64String(t.resumeToken))},$u.prototype.Ph=function(t){var e=this.kh(t.Ee),n=this.kh(t.lastLimboFreeSnapshotVersion),r=t.target.Ot()?this.Fh.Oi(t.target):this.Fh.Bi(t.target),i=t.resumeToken.toBase64();return new Na(t.targetId,t.target.canonicalId(),e,i,t.sequenceNumber,n,r)},$u),Hu="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Qu=(n(Ju,Wu=ru),Ju),Yu=(Xu.Nr=function(t,e){if(t instanceof Qu)return ka.Nr(t.$h,e);throw Bs()},Xu.prototype.start=function(){var e=this;return ka.Zh(this.Hh,fa,new la(this.serializer)).then(function(t){return e.to=t,e.eo()}).then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new _r(Nr.FAILED_PRECONDITION,Hu);return e.so(),e.io(),e.no(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Jh.lh(t)})}).then(function(t){e.qh=new su(t,e.Lh)}).then(function(){e.Uh=!0}).catch(function(t){return e.to&&e.to.close(),Promise.reject(t)})},Xu.prototype.ro=function(n){var t=this;return this.Gh=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.ho?[2,n(e)]:[2]})})},n(this.isPrimary)},Xu.prototype.oo=function(n){var t=this;this.to.ao(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},Xu.prototype.uo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Tr.co(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.ho?[4,this.eo()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},Xu.prototype.eo=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return ta(e).put(new xa(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n._o(e).next(function(t){t||(n.isPrimary=!1,n.Tr.lo(function(){return n.Gh(!1)}))})}).next(function(){return n.do(e)}).next(function(t){return n.isPrimary&&!t?n.fo(e).next(function(){return!1}):!!t&&n.To(e).next(function(){return!0})})}).catch(function(t){if(ja(t))return Ms("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Ms("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Tr.lo(function(){return n.Gh(t)}),n.isPrimary=t})},Xu.prototype._o=function(t){var e=this;return Zu(t).get(da.key).next(function(t){return tu.resolve(e.Eo(t))})},Xu.prototype.Io=function(t){return ta(t).delete(this.clientId)},Xu.prototype.wo=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Ro(this.Kh,18e5)?[3,2]:(this.Kh=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=Xu.Nr(t,xa.store);return r.Fr().next(function(t){var e=o.Ao(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return tu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Xh)for(n=0,r=e;n<r.length;n++)i=r[n],this.Xh.removeItem(this.mo(i.clientId));t.label=2;case 2:return[2]}})})},Xu.prototype.no=function(){var t=this;this.jh=this.Tr.yr("client_metadata_refresh",4e3,function(){return t.eo().then(function(){return t.wo()}).then(function(){return t.no()})})},Xu.prototype.Eo=function(t){return!!t&&t.ownerId===this.clientId},Xu.prototype.do=function(e){var i=this;return this.Bh?tu.resolve(!0):Zu(e).get(da.key).next(function(t){if(null!==t&&i.Ro(t.leaseTimestampMs,5e3)&&!i.Po(t.ownerId)){if(i.Eo(t)&&i.networkEnabled)return!0;if(!i.Eo(t)){if(!t.allowTabSynchronization)throw new _r(Nr.FAILED_PRECONDITION,Hu);return!1}}return!(!i.networkEnabled||!i.inForeground)||ta(e).Fr().next(function(t){return void 0===i.Ao(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Ms("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},Xu.prototype.Vo=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Uh=!1,this.po(),this.jh&&(this.jh.cancel(),this.jh=null),this.yo(),this.bo(),[4,this.runTransaction("shutdown","readwrite",function(t){return e.fo(t).next(function(){return e.Io(t)})}).catch(function(t){Ms("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)})];case 1:return t.sent(),this.to.close(),this.vo(),[2]}})})},Xu.prototype.Ao=function(t,e){var n=this;return t.filter(function(t){return n.Ro(t.updateTimeMs,e)&&!n.Po(t.clientId)})},Xu.prototype.So=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return ta(t).Fr().next(function(t){return e.Ao(t,18e5).map(function(t){return t.clientId})})})},Xu.clearPersistence=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return Xu.zh()?(e=n+Xu.Yh,[4,ka.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(Xu.prototype,"ho",{get:function(){return this.Uh},enumerable:!0,configurable:!0}),Xu.prototype.Do=function(t){return ia.Co(t,this.serializer,this.jn,this.hh)},Xu.prototype.Fo=function(){return this.Jh},Xu.prototype.No=function(){return this.Qn},Xu.prototype.ko=function(){return this.jn},Xu.prototype.runTransaction=function(e,n,r){var i=this;Ms("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.to.runTransaction(t,Pa,function(t){return o=new Qu(t,i.qh?i.qh.next():su.dr),"readwrite-primary"===n?i._o(o).next(function(t){return!!t||i.do(o)}).next(function(t){if(!t)throw Fs("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Tr.lo(function(){return i.Gh(!1)}),new _r(Nr.FAILED_PRECONDITION,nu);return r(o)}).next(function(t){return i.To(o).next(function(){return t})}):i.Mo(o).next(function(){return r(o)})}).then(function(t){return o.Un(),t})},Xu.prototype.Mo=function(t){var e=this;return Zu(t).get(da.key).next(function(t){if(null!==t&&e.Ro(t.leaseTimestampMs,5e3)&&!e.Po(t.ownerId)&&!e.Eo(t)&&!(e.Bh||e.allowTabSynchronization&&t.allowTabSynchronization))throw new _r(Nr.FAILED_PRECONDITION,Hu)})},Xu.prototype.To=function(t){var e=new da(this.clientId,this.allowTabSynchronization,Date.now());return Zu(t).put(da.key,e)},Xu.zh=function(){return ka.zh()},Xu.xo=function(t){var e=t.ii.projectId;return t.ii.ln||(e+="."+t.ii.database),"firestore/"+t.persistenceKey+"/"+e+"/"},Xu.prototype.fo=function(t){var e=this,n=Zu(t);return n.get(da.key).next(function(t){return e.Eo(t)?(Ms("IndexedDbPersistence","Releasing primary lease."),n.delete(da.key)):tu.resolve()})},Xu.prototype.Ro=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Fs("Detected an update time that is in the future: "+t+" > "+n),1))},Xu.prototype.so=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Wh=function(){t.Tr.co(function(){return t.inForeground="visible"===t.document.visibilityState,t.eo()})},this.document.addEventListener("visibilitychange",this.Wh),this.inForeground="visible"===this.document.visibilityState)},Xu.prototype.yo=function(){this.Wh&&(this.document.removeEventListener("visibilitychange",this.Wh),this.Wh=null)},Xu.prototype.io=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Qh=function(){e.po(),e.Tr.co(function(){return e.Vo()})},this.window.addEventListener("unload",this.Qh))},Xu.prototype.bo=function(){this.Qh&&(this.window.removeEventListener("unload",this.Qh),this.Qh=null)},Xu.prototype.Po=function(t){var e;try{var n=null!==(null===(e=this.Xh)||void 0===e?void 0:e.getItem(this.mo(t)));return Ms("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Fs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},Xu.prototype.po=function(){if(this.Xh)try{this.Xh.setItem(this.mo(this.clientId),String(Date.now()))}catch(t){Fs("Failed to set zombie client id.",t)}},Xu.prototype.vo=function(){if(this.Xh)try{this.Xh.removeItem(this.mo(this.clientId))}catch(t){}},Xu.prototype.mo=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},Xu);function Xu(t,e,n,r,i,o,s,u,a){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Tr=o,this.Lh=u,this.Bh=a,this.qh=null,this.Uh=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Qh=null,this.inForeground=!1,this.Wh=null,this.jh=null,this.Kh=Number.NEGATIVE_INFINITY,this.Gh=function(t){return Promise.resolve()},!Xu.zh())throw new _r(Nr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.hh=new ea(this,i),this.Hh=e+Xu.Yh,this.serializer=new Ku(s),this.document=r.document,this.Jh=new Mu(this.hh,this.serializer),this.jn=new _u,this.Qn=new Pu(this.serializer,this.jn),this.window=r.window,r.window&&r.window.localStorage?this.Xh=r.window.localStorage:(this.Xh=null,!1===a&&Fs("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Ju(t,e){var n=this;return(n=Wu.call(this)||this).$h=t,n.Oh=e,n}function $u(t){this.Fh=t}function Zu(t){return Yu.Nr(t,da.store)}function ta(t){return Yu.Nr(t,xa.store)}Yu.Yh="main";var ea=(na.prototype.Oo=function(t){var n=this.Lo(t);return this.db.Fo().Vh(t).next(function(e){return n.next(function(t){return e+t})})},na.prototype.Lo=function(t){var e=0;return this.Bo(t,function(t){e++}).next(function(){return e})},na.prototype.js=function(t,e){return this.db.Fo().js(t,e)},na.prototype.Bo=function(t,n){return this.qo(t,function(t,e){return n(e)})},na.prototype.yh=function(t,e,n){return ra(t,n)},na.prototype.vh=function(t,e,n){return ra(t,n)},na.prototype.Ah=function(t,e,n){return this.db.Fo().Ah(t,e,n)},na.prototype.Uo=ra,na.prototype.Qo=function(t,e){return r=e,i=!1,ca(n=t).Wo(function(t){return sa(n,t,r).next(function(t){return t&&(i=!0),tu.resolve(!t)})}).next(function(){return i});var n,r,i},na.prototype.jo=function(r,i){var o=this,s=this.db.No().Yr(),u=[],a=0;return this.qo(r,function(e,t){var n;t<=i&&(n=o.Qo(r,e).next(function(t){if(!t)return a++,s.xn(r,e).next(function(){return s.Mn(e),zu(r).delete([0,bu(e.path)])})}),u.push(n))}).next(function(){return tu.vn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},na.prototype.removeTarget=function(t,e){var n=e.Ie(t.Oh);return this.db.Fo().Ih(t,n)},na.prototype.Ko=ra,na.prototype.qo=function(t,o){var s,e=zu(t),u=su.dr;return e.Ur({index:_a.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==su.dr&&o(new Hr(Tu(s)),u),u=i,s=r):u=su.dr}).next(function(){u!==su.dr&&o(new Hr(Tu(s)),u)})},na.prototype.Go=function(t){return this.db.No().Zr(t)},na);function na(t,e){this.db=t,this.$o=new ih(this,e)}function ra(t,e){return zu(t).put((n=t.Oh,new _a(0,bu(e.path),n)));var n}var ia=(oa.Co=function(t,e,n,r){return Gs(""!==t.uid),new oa(t.t()?t.uid:"",e,n,r)},oa.prototype.Ho=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return aa(t).Ur({index:ga.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},oa.prototype.Yo=function(h,c,f,l){var p=this,d=ha(h),y=aa(h);return y.add({}).next(function(t){Gs("number"==typeof t);for(var e=new $s(t,c,f,l),n=p.serializer.Mh(p.userId,e),r=[],i=new es(function(t,e){return Ks(t.j(),e.j())}),o=0,s=l;o<s.length;o++){var u=s[o],a=ma.key(p.userId,u.key.path,t),i=i.add(u.key.path.$());r.push(y.put(n)),r.push(d.put(a,ma.PLACEHOLDER))}return i.forEach(function(t){r.push(p.jn.Dr(h,t))}),h.qn(function(){p.zo[t]=e.keys()}),tu.vn(r).next(function(){return e})})},oa.prototype.Jo=function(t,e){var n=this;return aa(t).get(e).next(function(t){return t?(Gs(t.userId===n.userId),n.serializer.xh(t)):null})},oa.prototype.Xo=function(t,n){var r=this;return this.zo[n]?tu.resolve(this.zo[n]):this.Jo(t,n).next(function(t){if(t){var e=t.keys();return r.zo[n]=e}return null})},oa.prototype.Zo=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return aa(t).Ur({index:ga.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Gs(e.batchId>=i),o=r.serializer.xh(e)),n.done()}).next(function(){return o})},oa.prototype.ta=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return aa(t).Ur({index:ga.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},oa.prototype.ea=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return aa(t).Fr(ga.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.xh(t)})})},oa.prototype.Gn=function(u,a){var h=this,t=ma.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return ha(u).Ur({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Tu(i);if(r===h.userId&&a.path.isEqual(s))return aa(u).get(o).next(function(t){if(!t)throw Bs();Gs(t.userId===h.userId),c.push(h.serializer.xh(t))});n.done()}).next(function(){return c})},oa.prototype.Xn=function(r,t){var a=this,h=new es(Ks),i=[];return t.forEach(function(u){var t=ma.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=ha(r).Ur({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Tu(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),tu.vn(i).next(function(){return a.sa(r,h)})},oa.prototype.nr=function(t,e){var u=this,a=e.path,h=a.length+1,n=ma.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new es(Ks);return ha(t).Ur({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=Tu(i);r===u.userId&&a.q(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.sa(t,c)})},oa.prototype.sa=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(aa(e).get(t).next(function(t){if(null===t)throw Bs();Gs(t.userId===n.userId),r.push(n.serializer.xh(t))}))}),tu.vn(i).next(function(){return r})},oa.prototype.ia=function(e,n){var r=this;return ua(e.$h,this.userId,n).next(function(t){return e.qn(function(){r.na(n.batchId)}),tu.forEach(t,function(t){return r.hh.Uo(e,t)})})},oa.prototype.na=function(t){delete this.zo[t]},oa.prototype.ra=function(n){var o=this;return this.Ho(n).next(function(t){if(!t)return tu.resolve();var e=IDBKeyRange.lowerBound(ma.prefixForUser(o.userId)),i=[];return ha(n).Ur({range:e},function(t,e,n){var r;t[0]===o.userId?(r=Tu(t[1]),i.push(r)):n.done()}).next(function(){Gs(0===i.length)})})},oa.prototype.Ch=function(t,e){return sa(t,this.userId,e)},oa.prototype.ha=function(t){var e=this;return ca(t).get(this.userId).next(function(t){return t||new va(e.userId,-1,"")})},oa);function oa(t,e,n,r){this.userId=t,this.serializer=e,this.jn=n,this.hh=r,this.zo={}}function sa(t,o,e){var n=ma.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return ha(t).Ur({range:r,Dh:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function ua(t,e,n){var r=t.store(ga.store),i=t.store(ma.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Ur({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Gs(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=ma.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return tu.vn(o).next(function(){return h})}function aa(t){return Yu.Nr(t,ga.store)}function ha(t){return Yu.Nr(t,ma.store)}function ca(t){return Yu.Nr(t,va.store)}var fa=10,la=(ya.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Gs(t<e&&0<=t&&e<=fa);var o,s=new Ma(r);t<1&&1<=e&&(n.createObjectStore(da.store),(o=n).createObjectStore(va.store,{keyPath:va.keyPath}),o.createObjectStore(ga.store,{keyPath:ga.keyPath,autoIncrement:!0}).createIndex(ga.userMutationsIndex,ga.userMutationsKeyPath,{unique:!0}),o.createObjectStore(ma.store),Ra(n),n.createObjectStore(Ta.store));var u,a=tu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(_a.store),u.deleteObjectStore(Na.store),u.deleteObjectStore(Aa.store),Ra(n)),a=a.next(function(){return t=s.store(Aa.store),e=new Aa(0,0,Pr.min().C(),0),t.put(Aa.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(ga.store).Fr().next(function(t){r.deleteObjectStore(ga.store),r.createObjectStore(ga.store,{keyPath:ga.keyPath,autoIncrement:!0}).createIndex(ga.userMutationsIndex,ga.userMutationsKeyPath,{unique:!0});var e=i.store(ga.store),n=t.map(function(t){return e.put(t)});return tu.vn(n)});var r,i})),a=a.next(function(){n.createObjectStore(xa.store,{keyPath:xa.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Ia.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Ta.store)).createIndex(Ta.readTimeIndex,Ta.readTimeIndexPath,{unique:!1}),t.createIndex(Ta.collectionReadTimeIndex,Ta.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},ya.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Ta.store).Ur(function(t,e){n+=Cu(e)}).next(function(){var t=new Ia(n);return e.store(Ia.store).put(Ia.key,t)})},ya.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(va.store),e=r.store(ga.store);return t.Fr().next(function(t){return tu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Fr(ga.userMutationsIndex,t).next(function(t){return tu.forEach(t,function(t){Gs(t.userId===n.userId);var e=i.serializer.xh(t);return ua(r,n.userId,e).next(function(){})})})})})},ya.prototype.ensureSequenceNumbers=function(t){var s=t.store(_a.store),e=t.store(Ta.store);return t.store(Aa.store).get(Aa.key).next(function(i){var o=[];return e.Ur(function(t,e){var n=new Or(t),r=[0,bu(n)];o.push(s.get(r).next(function(t){return t?tu.resolve():s.put(new _a(0,bu(n),i.highestListenSequenceNumber))}))}).next(function(){return tu.vn(o)})})},ya.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.L(),n=t.$();return r.put({collectionId:e,parent:bu(n)})}}t.createObjectStore(Sa.store,{keyPath:Sa.keyPath});var r=e.store(Sa.store),o=new Nu;return e.store(Ta.store).Ur({Dh:!0},function(t,e){var n=new Or(t);return i(n.$())}).next(function(){return e.store(ma.store).Ur({Dh:!0},function(t,e){t[0];var n=t[1],r=(t[2],Tu(n));return i(r.$())})})},ya.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(Na.store);return o.Ur(function(t,e){var n=i.serializer.mh(e),r=i.serializer.Ph(n);return o.put(r)})},ya),pa=function(t,e){this.seconds=t,this.nanoseconds=e},da=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function ya(t){this.serializer=t}da.store="owner",da.key="owner";var va=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};va.store="mutationQueues",va.keyPath="userId";var ga=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ga.store="mutations",ga.keyPath="batchId",ga.userMutationsIndex="userMutationsIndex",ga.userMutationsKeyPath=["userId","batchId"];var ma=(wa.prefixForUser=function(t){return[t]},wa.prefixForPath=function(t,e){return[t,bu(e)]},wa.key=function(t,e,n){return[t,bu(e),n]},wa);function wa(){}ma.store="documentMutations",ma.PLACEHOLDER=new ma;var ba=function(t,e){this.path=t,this.readTime=e},Ea=function(t,e){this.path=t,this.version=e},Ta=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Ta.store="remoteDocuments",Ta.readTimeIndex="readTimeIndex",Ta.readTimeIndexPath="readTime",Ta.collectionReadTimeIndex="collectionReadTimeIndex",Ta.collectionReadTimeIndexPath=["parentPath","readTime"];var Ia=function(t){this.byteSize=t};Ia.store="remoteDocumentGlobal",Ia.key="remoteDocumentGlobalKey";var Na=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Na.store="targets",Na.keyPath="targetId",Na.queryTargetsIndexName="queryTargetsIndex",Na.queryTargetsKeyPath=["canonicalId","targetId"];var _a=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};_a.store="targetDocuments",_a.keyPath=["targetId","path"],_a.documentTargetsIndex="documentTargetsIndex",_a.documentTargetsKeyPath=["path","targetId"];var Aa=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Aa.key="targetGlobalKey",Aa.store="targetGlobal";var Sa=function(t,e){this.collectionId=t,this.parent=e};function Ra(t){t.createObjectStore(_a.store,{keyPath:_a.keyPath}).createIndex(_a.documentTargetsIndex,_a.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Na.store,{keyPath:Na.keyPath}).createIndex(Na.queryTargetsIndexName,Na.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Aa.store)}Sa.store="collectionParents",Sa.keyPath=["collectionId","parent"];var xa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};xa.store="clientMetadata",xa.keyPath="clientId";var Da,Pa=d(d(d([va.store,ga.store,ma.store,Ta.store,Na.store,da.store,Aa.store,_a.store],[xa.store]),[Ia.store]),[Sa.store]),ka=(Ua.Zh=function(o,t,s){return Ms("SimpleDb","Opening database:",o),new tu(function(n,r){var i=indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new Ua(e))},i.onblocked=function(){r(new _r(Nr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new _r(Nr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Ms("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,fa).next(function(){Ms("SimpleDb","Database upgrade to version "+fa+" complete")})}}).yn()},Ua.delete=function(t){return Ms("SimpleDb","Removing database:",t),Ga(window.indexedDB.deleteDatabase(t)).yn()},Ua.zh=function(){if("undefined"==typeof indexedDB)return!1;if(Ua.aa())return!0;var t=g(),e=Ua.oa(t),n=0<e&&e<10,r=Ua.ua(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Ua.aa=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t.ca)},Ua.Nr=function(t,e){return t.store(e)},Ua.oa=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Ua.ua=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Ua.prototype.ao=function(e){this.db.onversionchange=function(t){return e(t)}},Ua.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=Ma.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),tu.reject(t)}).yn(),r={},n.catch(function(){}),[4,e._a];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Ms("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Ua.prototype.close=function(){this.db.close()},Ua),Oa=(Object.defineProperty(Ca.prototype,"Pn",{get:function(){return this.da},enumerable:!0,configurable:!0}),Object.defineProperty(Ca.prototype,"Ta",{get:function(){return this.fa},enumerable:!0,configurable:!0}),Object.defineProperty(Ca.prototype,"cursor",{set:function(t){this.la=t},enumerable:!0,configurable:!0}),Ca.prototype.done=function(){this.da=!0},Ca.prototype.Qr=function(t){this.fa=t},Ca.prototype.delete=function(){return Ga(this.la.delete())},Ca),La=(n(Va,Da=_r),Va);function Va(t){var e=this;return(e=Da.call(this,Nr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Ca(t){this.la=t,this.da=!1,this.fa=null}function Ua(t){this.db=t,12.2===Ua.oa(g())&&Fs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function ja(t){return"IndexedDbTransactionError"===t.name}var Ma=(Ba.open=function(t,e,n){return new Ba(t.transaction(n,e))},Object.defineProperty(Ba.prototype,"_a",{get:function(){return this.Ea.promise},enumerable:!0,configurable:!0}),Ba.prototype.abort=function(t){t&&this.Ea.reject(t),this.aborted||(Ms("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Ba.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Fa(e)},Ba),Fa=(qa.prototype.put=function(t,e){var n=void 0!==e?(Ms("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ms("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Ga(n)},qa.prototype.add=function(t){return Ms("SimpleDb","ADD",this.store.name,t,t),Ga(this.store.add(t))},qa.prototype.get=function(e){var n=this;return Ga(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Ms("SimpleDb","GET",n.store.name,e,t),t})},qa.prototype.delete=function(t){return Ms("SimpleDb","DELETE",this.store.name,t),Ga(this.store.delete(t))},qa.prototype.count=function(){return Ms("SimpleDb","COUNT",this.store.name),Ga(this.store.count())},qa.prototype.Fr=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Ia(n,function(t,e){r.push(e)}).next(function(){return r})},qa.prototype.wa=function(t,e){Ms("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Dh=!1;var r=this.cursor(n);return this.Ia(r,function(t,e,n){return n.delete()})},qa.prototype.Ur=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Ia(r,e)},qa.prototype.Wo=function(i){var t=this.cursor({});return new tu(function(n,r){t.onerror=function(t){var e=Wa(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},qa.prototype.Ia=function(t,s){var u=[];return new tu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new Oa(i),(n=s(i.primaryKey,i.value,e))instanceof tu&&(r=n.catch(function(t){return e.done(),tu.reject(t)}),u.push(r)),e.Pn?o():null===e.Ta?i.continue():i.continue(e.Ta)):o()}}).next(function(){return tu.vn(u)})},qa.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},qa.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Dh?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},qa);function qa(t){this.store=t}function Ba(t){var n=this;this.transaction=t,this.aborted=!1,this.Ea=new gu,this.transaction.oncomplete=function(){n.Ea.resolve()},this.transaction.onabort=function(){t.error?n.Ea.reject(new La(t.error)):n.Ea.resolve()},this.transaction.onerror=function(t){var e=Wa(t.target.error);n.Ea.reject(new La(e))}}function Ga(t){return new tu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Wa(t.target.error);r(e)}})}var za=!1;function Wa(t){var e=ka.oa(g());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new _r("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return za||(za=!0,setTimeout(function(){throw r},0)),r}}return t}var Ka=(Ya.Va=function(t,e,n,r,i){var o=new Ya(t,e,Date.now()+n,r,i);return o.start(n),o},Ya.prototype.start=function(t){var e=this;this.ga=setTimeout(function(){return e.pa()},t)},Ya.prototype.vr=function(){return this.pa()},Ya.prototype.cancel=function(t){null!==this.ga&&(this.clearTimeout(),this.Pa.reject(new _r(Nr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Ya.prototype.pa=function(){var e=this;this.Ra.co(function(){return null!==e.ga?(e.clearTimeout(),e.op().then(function(t){return e.Pa.resolve(t)})):Promise.resolve()})},Ya.prototype.clearTimeout=function(){null!==this.ga&&(this.ma(this),clearTimeout(this.ga),this.ga=null)},Ya),Ha=(Object.defineProperty(Qa.prototype,"Ma",{get:function(){return this.va},enumerable:!0,configurable:!0}),Qa.prototype.co=function(t){this.enqueue(t)},Qa.prototype.xa=function(t){this.$a(),this.Oa(t)},Qa.prototype.La=function(t){return this.$a(),this.Oa(t)},Qa.prototype.Ba=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.$a(),this.va?[3,2]:(this.va=!0,(e=Vs.nt().window)&&e.removeEventListener("visibilitychange",this.ka),[4,this.La(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Qa.prototype.enqueue=function(t){return this.$a(),this.va?new Promise(function(t){}):this.Oa(t)},Qa.prototype.lo=function(i){var t=this;this.$a(),this.va||(this.ba=this.ba.then(function(){var n=new gu,r=function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,i()];case 1:return t.sent(),n.resolve(),this.Na.reset(),[3,3];case 2:if(!ja(e=t.sent()))throw n.resolve(),e;return Ms("AsyncQueue","Operation failed with retryable error: "+e),this.Na.gr(r),[3,3];case 3:return[2]}})})};return t.co(r),n.promise}))},Qa.prototype.Oa=function(t){var r=this,e=this.ya.then(function(){return r.Ca=!0,t().catch(function(t){throw r.Da=t,r.Ca=!1,Fs("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.Ca=!1,t})});return this.ya=e},Qa.prototype.yr=function(t,e,n){var r=this;this.$a(),-1<this.Fa.indexOf(t)&&(e=0);var i=Ka.Va(this,t,e,n,function(t){return r.qa(t)});return this.Sa.push(i),i},Qa.prototype.$a=function(){this.Da&&Bs()},Qa.prototype.Ua=function(){},Qa.prototype.Qa=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.ya];case 1:t.sent(),t.label=2;case 2:if(e!==this.ya)return[3,0];t.label=3;case 3:return[2]}})})},Qa.prototype.Wa=function(t){for(var e=0,n=this.Sa;e<n.length;e++)if(n[e].Er===t)return!0;return!1},Qa.prototype.ja=function(r){var i=this;return this.Qa().then(function(){i.Sa.sort(function(t,e){return t.Aa-e.Aa});for(var t=0,e=i.Sa;t<e.length;t++){var n=e[t];if(n.vr(),"all"!==r&&n.Er===r)break}return i.Qa()})},Qa.prototype.Ka=function(t){this.Fa.push(t)},Qa.prototype.qa=function(t){var e=this.Sa.indexOf(t);this.Sa.splice(e,1)},Qa);function Qa(){var t=this;this.ya=Promise.resolve(),this.ba=Promise.resolve(),this.va=!1,this.Sa=[],this.Da=null,this.Ca=!1,this.Fa=[],this.Na=new mu(this,"async_queue_retry"),this.ka=function(){return t.Na.br()};var e=Vs.nt().window;e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.ka)}function Ya(t,e,n,r,i){this.Ra=t,this.Er=e,this.Aa=n,this.op=r,this.ma=i,this.Pa=new gu,this.then=this.Pa.promise.then.bind(this.Pa.promise),this.Pa.promise.catch(function(t){})}function Xa(t,e){if(Fs("AsyncQueue",e+": "+t),ja(t))return new _r(Nr.UNAVAILABLE,e+": "+t);throw t}function Ja(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Ks(n,i);return 0===s?Ks(r,o):s}var $a=(nh.prototype.Ha=function(){return++this.za},nh.prototype.Ya=function(t){var e,n=[t,this.Ha()];this.buffer.size<this.Ga?this.buffer=this.buffer.add(n):Ja(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(nh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),nh),Za={Ja:!1,Xa:0,Za:0,tu:0},th=(eh.nu=function(t){return new eh(t,eh.ru,eh.hu)},eh);function eh(t,e,n){this.eu=t,this.su=e,this.iu=n}function nh(t){this.Ga=t,this.buffer=new es(Ja),this.za=0}th.ou=-1,th.au=1048576,th.uu=41943040,th.ru=10,th.hu=1e3,th.cu=new th(th.uu,th.ru,th.hu),th.DISABLED=new th(th.ou,0,0);var rh=(ah.prototype.start=function(t){this.$o.du.eu!==th.ou&&this.fu(t)},ah.prototype.stop=function(){this.lu&&(this.lu.cancel(),this.lu=null)},Object.defineProperty(ah.prototype,"ho",{get:function(){return null!==this.lu},enumerable:!0,configurable:!0}),ah.prototype.fu=function(n){var t=this,e=this._u?3e5:6e4;Ms("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.lu=this.Ra.yr("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.lu=null,this._u=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Tu(this.$o)];case 2:return t.sent(),[3,7];case 3:return ja(e=t.sent())?(Ms("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,lh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.fu(n)];case 8:return t.sent(),[2]}})})})},ah),ih=(uh.prototype.Iu=function(t,e){return this.Eu.Oo(t).next(function(t){return Math.floor(e/100*t)})},uh.prototype.wu=function(t,e){var n=this;if(0===e)return tu.resolve(su.dr);var r=new $a(e);return this.Eu.js(t,function(t){return r.Ya(t.sequenceNumber)}).next(function(){return n.Eu.Bo(t,function(t){return r.Ya(t)})}).next(function(){return r.maxValue})},uh.prototype.Ah=function(t,e,n){return this.Eu.Ah(t,e,n)},uh.prototype.jo=function(t,e){return this.Eu.jo(t,e)},uh.prototype.Ru=function(e,n){var r=this;return this.du.eu===th.ou?(Ms("LruGarbageCollector","Garbage collection skipped; disabled"),tu.resolve(Za)):this.Go(e).next(function(t){return t<r.du.eu?(Ms("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.du.eu),Za):r.Au(e,n)})},uh.prototype.Go=function(t){return this.Eu.Go(t)},uh.prototype.Au=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.Iu(e,this.du.su).next(function(t){return i=t>c.du.iu?(Ms("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.du.iu+" from "+t),c.du.iu):t,s=Date.now(),c.wu(e,i)}).next(function(t){return r=t,u=Date.now(),c.Ah(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.jo(e,r)}).next(function(t){return h=Date.now(),js()<=p.DEBUG&&Ms("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),tu.resolve({Ja:!0,Xa:i,Za:o,tu:t})})},uh),oh=(sh.prototype.start=function(){return Promise.resolve()},sh.prototype.vu=function(i){return y(this,void 0,void 0,function(){var e,m,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.Wn,m=this.yu,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var g;return r.Wn.ea(v).next(function(t){return g=t,e=r.persistence.Do(i),m=new iu(r.pu,e,r.persistence.ko()),e.ea(v)}).next(function(t){for(var e=[],n=[],r=hs(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var h=a[u],r=r.add(h.key)}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Yn(v,r).next(function(t){return{Su:t,Du:e,Cu:n}})})})];case 1:return n=t.sent(),[2,(this.Wn=e,this.yu=m,this.mu.bu(this.yu),n)]}})})},sh.prototype.Fu=function(u){var a,h=this,c=Dr.now(),t=u.reduce(function(t,e){return t.add(e.key)},hs());return this.persistence.runTransaction("Locally write mutations","readwrite",function(s){return h.yu.Yn(s,t).next(function(t){a=t;for(var e=[],n=0,r=u;n<r.length;n++){var i=r[n],o=i.Pt(a.get(i.key));null!=o&&e.push(new qi(i.key,o,function u(t){var a=[];return Xr(t.fields||{},function(t,e){var n=new Wr([t]);if(bi(e)){var r=u(e.mapValue).fields;if(0===r.length)a.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];a.push(n.child(s))}}else a.push(n)}),new Ci(a)}(o.proto.mapValue),ji.exists(!0)))}return h.Wn.Yo(s,c,e,u)})}).then(function(t){var e=t.In(a);return{batchId:t.batchId,Dn:e}})},sh.prototype.Nu=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.pu.Yr({Xr:!0});return i.ku(t,r,n).next(function(){return n.apply(t)}).next(function(){return i.Wn.ra(t)}).next(function(){return i.yu.Yn(t,e)})})},sh.prototype.Mu=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.Wn.Jo(e,t).next(function(t){return Gs(null!==t),n=t.keys(),r.Wn.ia(e,t)}).next(function(){return r.Wn.ra(e)}).next(function(){return r.yu.Yn(e,n)})})},sh.prototype.ta=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.Wn.ta(t)})},sh.prototype._h=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Jh._h(t)})},sh.prototype.xu=function(a){var h=this,c=a.Ee,f=this.Pu;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.pu.Yr({Xr:!0});f=h.Pu;var s=[];a.as.forEach(function(t,e){var n,r,i=f.get(e);i&&(s.push(h.Jh.bh(o,t.Is,e).next(function(){return h.Jh.ph(o,t.Ts,e)})),0<(n=t.resumeToken).rt()&&(r=i.we(n,c).Ie(o.Oh),f=f.Ae(e,r),sh.$u(i,r,t)&&s.push(h.Jh.Ih(o,r))))});var t,u=rs,n=hs();return a.cs.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.cs.forEach(function(t,e){var n=r.get(t);e instanceof wo&&e.version.isEqual(Pr.min())?(i.Mn(t,c),u=u.Ae(t,e)):null==n||0<e.version.S(n.version)||0===e.version.S(n.version)&&n.hasPendingWrites?(i.Nn(e,c),u=u.Ae(t,e)):Ms("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a._s.has(t)&&s.push(h.persistence.hh.Ko(o,t))})})),c.isEqual(Pr.min())||(t=h.Jh._h(o).next(function(t){return h.Jh.dh(o,o.Oh,c)}),s.push(t)),tu.vn(s).next(function(){return i.apply(o)}).next(function(){return h.yu.Jn(o,u)})}).then(function(t){return h.Pu=f,t})},sh.$u=function(t,e,n){return Gs(0<e.resumeToken.rt()),0===t.resumeToken.rt()||e.Ee.D()-t.Ee.D()>=this.Ou||0<n.Ts.size+n.Es.size+n.Is.size},sh.prototype.Lu=function(c){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return tu.forEach(c,function(e){return tu.forEach(e.hr,function(t){return h.persistence.hh.yh(n,e.targetId,t)}).next(function(){return tu.forEach(e.or,function(t){return h.persistence.hh.vh(n,e.targetId,t)})})})})];case 1:return t.sent(),[3,3];case 2:if(!ja(e=t.sent()))throw e;return Ms("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=c;n<r.length;n++)i=r[n],o=i.targetId,i.fromCache||(s=this.Pu.get(o),u=s.Ee,a=s.Re(u),this.Pu=this.Pu.Ae(o,a));return[2]}})})},sh.prototype.Bu=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.Wn.Zo(t,e)})},sh.prototype.qu=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.yu.Kn(t,e)})},sh.prototype.Uu=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Jh.gh(e,r).next(function(t){return t?(n=t,tu.resolve(n)):i.Jh.oh(e).next(function(t){return n=new Po(r,t,0,e.Oh),i.Jh.fh(e,n).next(function(){return n})})})}).then(function(t){var e=i.Pu.get(t.targetId);return(null===e||0<t.Ee.S(e.Ee))&&(i.Pu=i.Pu.Ae(t.targetId,t),i.Vu.set(r,t.targetId)),t})},sh.prototype.gh=function(t,e){var n=this.Vu.get(e);return void 0!==n?tu.resolve(this.Pu.get(n)):this.Jh.gh(t,e)},sh.prototype.Qu=function(t,e){var n=this,r=this.Pu.get(t),i=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",i,function(t){return e?tu.resolve():n.persistence.hh.removeTarget(t,r)}).then(function(){n.Pu=n.Pu.remove(t),n.Vu.delete(r.target)})},sh.prototype.Wu=function(t,n){var r=this,i=Pr.min(),o=hs();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.gh(e,t.ee()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Jh.Sh(e,t.targetId).next(function(t){o=t})}).next(function(){return r.mu.Zn(e,t,n?i:Pr.min(),n?o:hs())}).next(function(t){return{documents:t,ju:o}})})},sh.prototype.ku=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=tu.resolve();return n.forEach(function(r){u=u.next(function(){return o.xn(t,r)}).next(function(t){var e=t,n=i.Rn.get(r);Gs(null!==n),(!e||e.version.S(n)<0)&&(e=s.at(r,e,i))&&o.Nn(e,i.wn)})}),u.next(function(){return e.Wn.ia(t,s)})},sh.prototype.Tu=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.Ru(t,n.Pu)})},sh);function sh(t,e,n){this.persistence=t,this.mu=e,this.Pu=new Qo(Ks),this.Vu=new Js(function(t){return t.canonicalId()}),this.gu=Pr.min(),this.Wn=t.Do(n),this.pu=t.No(),this.Jh=t.Fo(),this.yu=new iu(this.pu,this.Wn,this.persistence.ko()),this.mu.bu(this.yu)}function uh(t,e){this.Eu=t,this.du=e}function ah(t,e){this.$o=t,this.Ra=e,this._u=!1,this.lu=null}oh.Ou=3e8;var hh,ch=(n(fh,hh=oh),fh.prototype.start=function(){return this.Ku()},fh.prototype.Gu=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.Wn.Xo(e,t).next(function(t){return t?n.yu.Yn(e,t):tu.resolve(null)})})},fh.prototype.zu=function(t){this.Wn.na(t)},fh.prototype.uo=function(t){this.persistence.uo(t)},fh.prototype.So=function(){return this.persistence.So()},fh.prototype.Hu=function(e){var n=this,t=this.Pu.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.Jh.si(t,e).next(function(t){return t?t.target:null})})},fh.prototype.Kr=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.pu.Kr(t,r.gu)}).then(function(t){var e=t.Gr,n=t.readTime;return r.gu=n,e})},fh.prototype.Ku=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.pu.Hr(t)})];case 1:return e.gu=t.sent(),[2]}})})},fh);function fh(t,e,n){var r=this;return(r=hh.call(this,t,e,n)||this).persistence=t,r.Wn=t.Do(n),r.pu=t.No(),r.Jh=t.Fo(),r}function lh(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Nr.FAILED_PRECONDITION||e.message!==nu)throw e;return Ms("LocalStore","Unexpectedly lost primary lease"),[2]})})}var ph=(vh.prototype.B=function(){return this.Yu.B()},vh.prototype.yh=function(t,e){var n=new dh(t,e);this.Yu=this.Yu.add(n),this.Xu=this.Xu.add(n)},vh.prototype.tc=function(t,e){var n=this;t.forEach(function(t){return n.yh(t,e)})},vh.prototype.vh=function(t,e){this.ec(new dh(t,e))},vh.prototype.sc=function(t,e){var n=this;t.forEach(function(t){return n.vh(t,e)})},vh.prototype.ic=function(t){var e=this,n=Hr.EMPTY,r=new dh(n,t),i=new dh(n,t+1),o=[];return this.Xu.Ke([r,i],function(t){e.ec(t),o.push(t.key)}),o},vh.prototype.nc=function(){var e=this;this.Yu.forEach(function(t){return e.ec(t)})},vh.prototype.ec=function(t){this.Yu=this.Yu.delete(t),this.Xu=this.Xu.delete(t)},vh.prototype.rc=function(t){var e=Hr.EMPTY,n=new dh(e,t),r=new dh(e,t+1),i=hs();return this.Xu.Ke([n,r],function(t){i=i.add(t.key)}),i},vh.prototype.Ch=function(t){var e=new dh(t,0),n=this.Yu.ze(e);return null!==n&&t.isEqual(n.key)},vh),dh=(yh.Ju=function(t,e){return Hr.N(t.key,e.key)||Ks(t.hc,e.hc)},yh.Zu=function(t,e){return Ks(t.hc,e.hc)||Hr.N(t.key,e.key)},yh);function yh(t,e){this.key=t,this.hc=e}function vh(){this.Yu=new es(dh.Ju),this.Xu=new es(dh.Zu)}function gh(t,e){if(0!==e.length)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Vh(e.length,"argument")+".")}function mh(t,e,n){if(e.length!==n)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires "+Vh(n,"argument")+", but was called with "+Vh(e.length,"argument")+".")}function wh(t,e,n){if(e.length<n)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Vh(n,"argument")+", but was called with "+Vh(e.length,"argument")+".")}function bh(t,e,n,r){if(e.length<n||e.length>r)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Vh(e.length,"argument")+".")}function Eh(t,e,n,r){Sh(t,e,Lh(n)+" argument",r)}function Th(t,e,n,r){void 0!==r&&Eh(t,e,n,r)}function Ih(t,e,n,r){Sh(t,e,n+" option",r)}function Nh(t,e,n,r){void 0!==r&&Ih(t,e,n,r)}function _h(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(xh(s))}var u=xh(n);throw new _r(Nr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function Ah(t,e,n,r){if(!e.some(function(t){return t===r}))throw new _r(Nr.INVALID_ARGUMENT,"Invalid value "+xh(r)+" provided to function "+t+"() for its "+Lh(n)+" argument. Acceptable values: "+e.join(", "));return r}function Sh(t,e,n,r){if(!("object"===e?Rh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=xh(r);throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Rh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function xh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Bs();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Dh(t,e,n){if(void 0===n)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Lh(e)+" argument, but it was undefined.")}function Ph(n,t,r){Xr(t,function(t,e){if(r.indexOf(t)<0)throw new _r(Nr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function kh(t,e,n,r){var i=xh(r);return new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Lh(n)+" argument to be a "+e+", but it was: "+i)}function Oh(t,e,n){if(n<=0)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Lh(e)+" argument to be a positive number, but it was: "+n+".")}function Lh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Vh(t,e){return t+" "+e+(1===t?"":"s")}function Ch(){if("undefined"==typeof Uint8Array)throw new _r(Nr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Uh(){if(!Vs.nt().oc)throw new _r(Nr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}function jh(t){!function(){if(!(t instanceof Array)||t.length<1)throw new _r(Nr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(Eh("FieldPath","string",e,t[e]),0===t[e].length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.uc=new Wr(t)}var Mh,Fh=(Gh.fromBase64String=function(t){mh("Blob.fromBase64String",arguments,1),Eh("Blob.fromBase64String","string",1,t),Uh();try{return new Gh($r.fromBase64String(t))}catch(t){throw new _r(Nr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Gh.fromUint8Array=function(t){if(mh("Blob.fromUint8Array",arguments,1),Ch(),!(t instanceof Uint8Array))throw kh("Blob.fromUint8Array","Uint8Array",1,t);return new Gh($r.fromUint8Array(t))},Gh.prototype.toBase64=function(){return mh("Blob.toBase64",arguments,0),Uh(),this.ac.toBase64()},Gh.prototype.toUint8Array=function(){return mh("Blob.toUint8Array",arguments,0),Ch(),this.ac.toUint8Array()},Gh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Gh.prototype.isEqual=function(t){return this.ac.isEqual(t.ac)},Gh),qh=(n(Bh,Mh=jh),Bh.documentId=function(){return Bh.cc},Bh.prototype.isEqual=function(t){if(!(t instanceof Bh))throw kh("isEqual","FieldPath",1,t);return this.uc.isEqual(t.uc)},Bh);function Bh(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Mh.call(this,t)||this}function Gh(t){Uh(),this.ac=t}qh.cc=new qh(Wr.J().j());var zh,Wh,Kh,Hh,Qh,Yh,Xh,Jh=new RegExp("[~\\*/\\[\\]]"),$h=function(){this._c=this},Zh=(n(bc,Xh=$h),bc.prototype.dc=function(t){if(2!==t.fc)throw 1===t.fc?t.Tc(this.lc+"() can only appear at the top level of your update data"):t.Tc(this.lc+"() cannot be used with set() unless you pass {merge:true}");return t.Vt.push(t.path),null},bc.prototype.isEqual=function(t){return t instanceof bc},bc),tc=(n(wc,Yh=$h),wc.prototype.dc=function(t){return new Ui(t.path,Ei.instance)},wc.prototype.isEqual=function(t){return t instanceof wc},wc),ec=(n(mc,Qh=$h),mc.prototype.dc=function(t){var e=new Tc({fc:3,methodName:this.lc,Ic:!0},t.ii,t.serializer,t.ignoreUndefinedProperties),n=this.Ec.map(function(t){return Ac(t,e)}),r=new Ii(n);return new Ui(t.path,r)},mc.prototype.isEqual=function(t){return this===t},mc),nc=(n(gc,Hh=$h),gc.prototype.dc=function(t){var e=new Tc({fc:3,methodName:this.lc,Ic:!0},t.ii,t.serializer,t.ignoreUndefinedProperties),n=this.Ec.map(function(t){return Ac(t,e)}),r=new Ni(n);return new Ui(t.path,r)},gc.prototype.isEqual=function(t){return this===t},gc),rc=(n(vc,Kh=$h),vc.prototype.dc=function(t){var e=new Tc({fc:3,methodName:this.lc},t.ii,t.serializer,t.ignoreUndefinedProperties),n=Ac(this.wc,e),r=new _i(t.serializer,n);return new Ui(t.path,r)},vc.prototype.isEqual=function(t){return this===t},vc),ic=(n(yc,Wh=$h),yc.delete=function(){return gh("FieldValue.delete",arguments),new oc(new Zh("FieldValue.delete"))},yc.serverTimestamp=function(){return gh("FieldValue.serverTimestamp",arguments),new oc(new tc("FieldValue.serverTimestamp"))},yc.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wh("FieldValue.arrayUnion",arguments,1),new oc(new ec("FieldValue.arrayUnion",t))},yc.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return wh("FieldValue.arrayRemove",arguments,1),new oc(new nc("FieldValue.arrayRemove",t))},yc.increment=function(t){return Eh("FieldValue.increment","number",1,t),mh("FieldValue.increment",arguments,1),new oc(new rc("FieldValue.increment",t))},yc),oc=(n(dc,zh=ic),dc.prototype.dc=function(t){return this._c.dc(t)},dc.prototype.isEqual=function(t){return t instanceof dc&&this._c.isEqual(t._c)},dc),sc=(Object.defineProperty(pc.prototype,"latitude",{get:function(){return this.Rc},enumerable:!0,configurable:!0}),Object.defineProperty(pc.prototype,"longitude",{get:function(){return this.Ac},enumerable:!0,configurable:!0}),pc.prototype.isEqual=function(t){return this.Rc===t.Rc&&this.Ac===t.Ac},pc.prototype.p=function(t){return Ks(this.Rc,t.Rc)||Ks(this.Ac,t.Ac)},pc),uc=/^__.*__$/,ac=function(t,e,n){this.mc=t,this.Pc=e,this.Vc=n},hc=(lc.prototype.gc=function(t,e){var n=[];return null!==this.Vt?n.push(new qi(t,this.data,this.Vt,e)):n.push(new Fi(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},lc),cc=(fc.prototype.gc=function(t,e){var n=[new qi(t,this.data,this.Vt,e)];return 0<this.fieldTransforms.length&&n.push(new Bi(t,this.fieldTransforms)),n},fc);function fc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function lc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function pc(t,e){if(mh("GeoPoint",arguments,2),Eh("GeoPoint","number",1,t),Eh("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new _r(Nr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new _r(Nr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Rc=t,this.Ac=e}function dc(t){var e=this;return(e=zh.call(this)||this)._c=t,e.lc=t.lc,e}function yc(){return null!==Wh&&Wh.apply(this,arguments)||this}function vc(t,e){var n=this;return(n=Kh.call(this)||this).lc=t,n.wc=e,n}function gc(t,e){var n=this;return(n=Hh.call(this)||this).lc=t,n.Ec=e,n}function mc(t,e){var n=this;return(n=Qh.call(this)||this).lc=t,n.Ec=e,n}function wc(t){var e=this;return(e=Yh.call(this)||this).lc=t,e}function bc(t){var e=this;return(e=Xh.call(this)||this).lc=t,e}function Ec(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Bs()}}var Tc=(Object.defineProperty(_c.prototype,"path",{get:function(){return this.settings.path},enumerable:!0,configurable:!0}),Object.defineProperty(_c.prototype,"fc",{get:function(){return this.settings.fc},enumerable:!0,configurable:!0}),_c.prototype.yc=function(t){return new _c(Object.assign(Object.assign({},this.settings),t),this.ii,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Vt)},_c.prototype.bc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.yc({path:n,Ic:!1});return r.vc(t),r},_c.prototype.Sc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.yc({path:n,Ic:!1});return r.pc(),r},_c.prototype.Dc=function(t){return this.yc({path:void 0,Ic:!0})},_c.prototype.Tc=function(t){var e=!this.path||this.path.B()?"":" (found in field "+this.path.toString()+")";return new _r(Nr.INVALID_ARGUMENT,"Function "+this.settings.methodName+"() called with invalid data. "+t+e)},_c.prototype.contains=function(e){return void 0!==this.Vt.find(function(t){return e.q(t)})||void 0!==this.fieldTransforms.find(function(t){return e.q(t.field)})},_c.prototype.pc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.vc(this.path.get(t))},_c.prototype.vc=function(t){if(0===t.length)throw this.Tc("Document fields must not be empty");if(Ec(this.fc)&&uc.test(t))throw this.Tc('Document fields cannot begin and end with "__"')},_c),Ic=(Nc.prototype.Fc=function(t,e,n){void 0===n&&(n={});var r=this.Nc(n.merge||n.mergeFields?2:0,t);xc("Data must be an object, but it was:",r,e);var i,o,s=Sc(e,r);if(n.merge)i=new Ci(r.Vt),o=r.fieldTransforms;else if(n.mergeFields){for(var u=[],a=0,h=n.mergeFields;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof jh)f=c.uc;else{if("string"!=typeof c)throw Bs();f=Pc(t,c)}if(!r.contains(f))throw new _r(Nr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");kc(u,f)||u.push(f)}i=new Ci(u),o=r.fieldTransforms.filter(function(t){return i.dt(t.field)})}else i=null,o=r.fieldTransforms;return new hc(new Wi(s),i,o)},Nc.prototype.kc=function(o,t){var s=this.Nc(1,o);xc("Data must be an object, but it was:",s,t);var u=[],a=new Ki;Xr(t,function(t,e){var n,r=Pc(o,t),i=s.Sc(r);e instanceof $h&&e._c instanceof Zh?u.push(r):null!=(n=Ac(e,i))&&(u.push(r),a.set(r,n))});var e=new Ci(u);return new cc(a.yt(),e,s.fieldTransforms)},Nc.prototype.Mc=function(t,e,n,r){var i=this.Nc(1,t),o=[Dc(t,e)],s=[n];if(r.length%2!=0)throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(Dc(t,r[u])),s.push(r[u+1]);for(var a,h,c,f,l=[],p=new Ki,d=o.length-1;0<=d;--d)kc(l,o[d])||(a=o[d],h=s[d],c=i.Sc(a),h instanceof $h&&h._c instanceof Zh?l.push(a):null!=(f=Ac(h,c))&&(l.push(a),p.set(a,f)));var y=new Ci(l);return new cc(p.yt(),y,i.fieldTransforms)},Nc.prototype.Nc=function(t,e){return new Tc({fc:t,methodName:e,path:Wr.G,Ic:!1},this.ii,this.serializer,this.ignoreUndefinedProperties)},Nc.prototype.xc=function(t,e,n){return void 0===n&&(n=!1),Ac(e,this.Nc(n?4:3,t))},Nc);function Nc(t,e,n){this.ii=t,this.ignoreUndefinedProperties=e,this.serializer=n||Vs.nt().Cc(t)}function _c(t,e,n,r,i,o){this.settings=t,this.ii=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.pc(),this.fieldTransforms=i||[],this.Vt=o||[]}function Ac(s,t){if(Rc(s))return xc("Unsupported field value:",t,s),Sc(s,t);if(s instanceof $h)return function(t,e){if(!Ec(e.fc))throw e.Tc(t.lc+"() can only be used with update() and set()");if(!e.path)throw e.Tc(t.lc+"() is not currently supported inside arrays");var n=t.dc(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Vt.push(t.path),s instanceof Array){if(t.settings.Ic&&4!==t.fc)throw t.Tc("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Ac(i[r],t.Dc(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return e.serializer.ai(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Dr.fromDate(t);return{timestampValue:e.serializer.C(n)}}if(t instanceof Dr){var r=new Dr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:e.serializer.C(r)}}if(t instanceof sc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Fh)return{bytesValue:e.serializer.ui(t)};if(t instanceof ac){var i=e.ii,o=t.mc;if(!o.isEqual(i))throw e.Tc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:e.serializer._i(t.Pc.path,t.mc)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Tc("Unsupported field value: "+xh(t))}(s,t)}function Sc(t,r){var i={};return Jr(t)?r.path&&0<r.path.length&&r.Vt.push(r.path):Xr(t,function(t,e){var n=Ac(e,r.bc(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Rc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Dr||t instanceof sc||t instanceof Fh||t instanceof ac||t instanceof $h)}function xc(t,e,n){if(!Rc(n)||!Rh(n)){var r=xh(n);throw"an object"===r?e.Tc(t+" a custom object"):e.Tc(t+" "+r)}}function Dc(t,e){if(e instanceof jh)return e.uc;if("string"==typeof e)return Pc(t,e);throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Pc(t,e){try{return function(e){if(0<=e.search(Jh))throw new _r(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(qh.bind.apply(qh,d([void 0],e.split("."))))}catch(t){throw new _r(Nr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).uc}catch(e){var n=e instanceof Error?e.message:e.toString();throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function kc(t,e){return t.some(function(t){return t.isEqual(e)})}var Oc,Lc,Vc,Cc=(Yc.prototype.Uc=function(){return 1===this.state||2===this.state||4===this.state},Yc.prototype.Qc=function(){return 2===this.state},Yc.prototype.start=function(){3!==this.state?this.auth():this.Wc()},Yc.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Uc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Yc.prototype.jc=function(){this.state=0,this.Na.reset()},Yc.prototype.Kc=function(){var t=this;this.Qc()&&null===this.qc&&(this.qc=this.Tr.yr(this.$c,6e4,function(){return t.Gc()}))},Yc.prototype.zc=function(t){this.Hc(),this.stream.send(t)},Yc.prototype.Gc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.Qc()?[2,this.close(0)]:[2]})})},Yc.prototype.Hc=function(){this.qc&&(this.qc.cancel(),this.qc=null)},Yc.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Hc(),this.Na.cancel(),this.Bc++,3!==e?this.Na.reset():n&&n.code===Nr.RESOURCE_EXHAUSTED?(Fs(n.toString()),Fs("Using maximum backoff delay to prevent overloading the backend."),this.Na.Vr()):n&&n.code===Nr.UNAUTHENTICATED&&this.Lc._(),null!==this.stream&&(this.Yc(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.Jc(n)];case 1:return t.sent(),[2]}})})},Yc.prototype.Yc=function(){},Yc.prototype.auth=function(){var n=this;this.state=1;var t=this.Xc(this.Bc),e=this.Bc;this.Lc.getToken().then(function(t){n.Bc===e&&n.Zc(t)},function(e){t(function(){var t=new _r(Nr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.t_(t)})})},Yc.prototype.Zc=function(t){var e=this,n=this.Xc(this.Bc);this.stream=this.e_(t),this.stream.s_(function(){n(function(){return e.state=2,e.listener.s_()})}),this.stream.Jc(function(t){n(function(){return e.t_(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},Yc.prototype.Wc=function(){var t=this;this.state=4,this.Na.gr(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},Yc.prototype.t_=function(t){return Ms("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},Yc.prototype.Xc=function(e){var n=this;return function(t){n.Tr.co(function(){return n.Bc===e?t():(Ms("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},Yc),Uc=(n(Qc,Vc=Cc),Qc.prototype.e_=function(t){return this.Oc.i_("Listen",t)},Qc.prototype.onMessage=function(t){this.Na.reset();var e=this.serializer.pi(t),n=this.serializer.bi(t);return this.listener.n_(e,n)},Qc.prototype.r_=function(t){var e={};e.database=this.serializer.wi,e.addTarget=this.serializer.ee(t);var n=this.serializer.zi(t);n&&(e.labels=n),this.zc(e)},Qc.prototype.h_=function(t){var e={};e.database=this.serializer.wi,e.removeTarget=t,this.zc(e)},Qc),jc=(n(Hc,Lc=Cc),Object.defineProperty(Hc.prototype,"a_",{get:function(){return this.o_},enumerable:!0,configurable:!0}),Hc.prototype.start=function(){this.o_=!1,this.lastStreamToken=$r.ht,Lc.prototype.start.call(this)},Hc.prototype.Yc=function(){this.o_&&this.u_([])},Hc.prototype.e_=function(t){return this.Oc.i_("Write",t)},Hc.prototype.onMessage=function(t){if(Gs(!!t.streamToken),this.lastStreamToken=this.serializer.ci(t.streamToken),this.o_){this.Na.reset();var e=this.serializer.$i(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.c_(n,e)}return Gs(!t.writeResults||0===t.writeResults.length),this.o_=!0,this.listener.__()},Hc.prototype.l_=function(){var t={};t.database=this.serializer.wi,this.zc(t)},Hc.prototype.u_=function(t){var e=this,n={streamToken:this.serializer.ui(this.lastStreamToken),writes:t.map(function(t){return e.serializer.vi(t)})};this.zc(n)},Hc),Mc=(n(Kc,Oc=function(){this.d_=void 0}),Kc.prototype.T_=function(){if(this.f_)throw new _r(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},Kc.prototype.E_=function(e,n){var r=this;return this.T_(),this.credentials.getToken().then(function(t){return r.Oc.E_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},Kc.prototype.I_=function(e,n){var r=this;return this.T_(),this.credentials.getToken().then(function(t){return r.Oc.I_(e,n,t)}).catch(function(t){throw t.code===Nr.UNAUTHENTICATED&&r.credentials._(),t})},Kc),Fc=(Wc.prototype.V_=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.g_(),0<this.mutations.length)throw new _r(Nr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var n,e,r,i,o;return v(this,function(t){switch(t.label){case 0:return e={database:(n=s).serializer.wi,documents:u.map(function(t){return n.serializer.fi(t)})},[4,n.I_("BatchGetDocuments",e)];case 1:return r=t.sent(),i=new Map,r.forEach(function(t){var e=n.serializer.gi(t);i.set(e.key.toString(),e)}),o=[],[2,(u.forEach(function(t){var e=i.get(t.toString());Gs(!!e),o.push(e)}),o)]}})})}(this.w_,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof wo||t instanceof mo?n.p_(t):Bs()}),e)]}})})},Wc.prototype.set=function(t,e){this.write(e.gc(t,this.Rt(t))),this.P_.add(t)},Wc.prototype.update=function(t,e){try{this.write(e.gc(t,this.y_(t)))}catch(t){this.m_=t}this.P_.add(t)},Wc.prototype.delete=function(t){this.write([new Gi(t,this.Rt(t))]),this.P_.add(t)},Wc.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:if(this.g_(),this.m_)throw this.m_;return e=this.R_,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=new Hr(Or.K(e));r.mutations.push(new zi(n,r.Rt(n)))}),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return n={database:(e=r).serializer.wi,writes:i.map(function(t){return e.serializer.vi(t)})},[4,e.E_("Commit",n)];case 1:return t.sent(),[2]}})})}(this.w_,this.mutations)];case 1:return t.sent(),this.A_=!0,[2]}})})},Wc.prototype.p_=function(t){var e;if(t instanceof mo)e=t.version;else{if(!(t instanceof wo))throw Bs();e=Pr.min()}var n=this.R_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new _r(Nr.ABORTED,"Document version changed between two reads.")}else this.R_.set(t.key.toString(),e)},Wc.prototype.Rt=function(t){var e=this.R_.get(t.toString());return!this.P_.has(t)&&e?ji.updateTime(e):ji.ft()},Wc.prototype.y_=function(t){var e=this.R_.get(t.toString());if(this.P_.has(t)||!e)return ji.exists(!0);if(e.isEqual(Pr.min()))throw new _r(Nr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ji.updateTime(e)},Wc.prototype.write=function(t){this.g_(),this.mutations=this.mutations.concat(t)},Wc.prototype.g_=function(){},Wc),qc=(zc.prototype.C_=function(){var t=this;0===this.v_&&(this.F_("Unknown"),this.S_=this.Ra.yr("online_state_timeout",1e4,function(){return t.S_=null,t.N_("Backend didn't respond within 10 seconds."),t.F_("Offline"),Promise.resolve()}))},zc.prototype.k_=function(t){"Online"===this.state?this.F_("Unknown"):(this.v_++,1<=this.v_&&(this.M_(),this.N_("Connection failed 1 times. Most recent error: "+t.toString()),this.F_("Offline")))},zc.prototype.set=function(t){this.M_(),this.v_=0,"Online"===t&&(this.D_=!1),this.F_(t)},zc.prototype.F_=function(t){t!==this.state&&(this.state=t,this.b_(t))},zc.prototype.N_=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.D_?(Fs(e),this.D_=!1):Ms("OnlineStateTracker",e)},zc.prototype.M_=function(){null!==this.S_&&(this.S_.cancel(),this.S_=null)},zc),Bc=(Gc.prototype.start=function(){return this.enableNetwork()},Gc.prototype.enableNetwork=function(){return this.networkEnabled=!0,this.el()},Gc.prototype.el=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.W_()?(this.sl()?this.il():this.K_.set("Unknown"),[4,this.nl()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Gc.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.rl()];case 1:return t.sent(),this.K_.set("Offline"),[2]}})})},Gc.prototype.rl=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.J_.stop()];case 1:return t.sent(),[4,this.G_.stop()];case 2:return t.sent(),0<this.O_.length&&(Ms("RemoteStore","Stopping write stream with "+this.O_.length+" pending writes"),this.O_=[]),this.hl(),[2]}})})},Gc.prototype.Vo=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Ms("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.rl()];case 1:return t.sent(),this.U_.Vo(),this.K_.set("Unknown"),[2]}})})},Gc.prototype.listen=function(t){this.L_.has(t.targetId)||(this.L_.set(t.targetId,t),this.sl()?this.il():this.G_.Qc()&&this.ol(t))},Gc.prototype.al=function(t){this.L_.delete(t),this.G_.Qc()&&this.ul(t),0===this.L_.size&&(this.G_.Qc()?this.G_.Kc():this.W_()&&this.K_.set("Unknown"))},Gc.prototype.si=function(t){return this.L_.get(t)||null},Gc.prototype.ei=function(t){return this.cl.ei(t)},Gc.prototype.ol=function(t){this.B_.Ns(t.targetId),this.G_.r_(t)},Gc.prototype.ul=function(t){this.B_.Ns(t),this.G_.h_(t)},Gc.prototype.il=function(){this.B_=new bs(this),this.G_.start(),this.K_.C_()},Gc.prototype.sl=function(){return this.W_()&&!this.G_.Uc()&&0<this.L_.size},Gc.prototype.W_=function(){return!this.q_&&this.isPrimary&&this.networkEnabled},Gc.prototype.hl=function(){this.B_=null},Gc.prototype.z_=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.L_.forEach(function(t,e){n.ol(t)}),[2]})})},Gc.prototype.H_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this.hl(),this.sl()?(this.K_.k_(e),this.il()):this.K_.set("Unknown"),[2]})})},Gc.prototype.Y_=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:if(this.K_.set("Online"),!(i instanceof ps&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this._l(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Ms("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.ll(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof fs?this.B_.qs(i):i instanceof ls?this.B_.Hs(i):this.B_.Ws(i),o.isEqual(Pr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.x_._h()];case 8:return n=t.sent(),0<=o.S(n)?[4,this.dl(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Ms("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.ll(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},Gc.prototype.ll=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!ja(n))throw n;return this.q_=!0,[4,this.rl()];case 1:return t.sent(),this.K_.set("Offline"),r=r||function(){return e.x_._h()},this.Ra.lo(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Ms("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return t.sent(),this.q_=!1,[4,this.el()];case 2:return t.sent(),[2]}})})}),[2]}})})},Gc.prototype.fl=function(e){var n=this;return e().catch(function(t){return n.ll(t,e)})},Gc.prototype.dl=function(r){var i=this,t=this.B_.Xs(r);return t.as.forEach(function(t,e){var n;0<t.resumeToken.rt()&&(n=i.L_.get(e))&&i.L_.set(e,n.we(t.resumeToken,r))}),t.us.forEach(function(t){var e,n=i.L_.get(t);n&&(i.L_.set(t,n.we($r.ht,n.Ee)),i.ul(t),e=new Po(n.target,t,1,n.sequenceNumber),i.ol(e))}),this.cl.xu(t)},Gc.prototype._l=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.L_.has(i)?[4,this.cl.Tl(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.L_.delete(i),this.B_.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},Gc.prototype.nl=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:e=0<this.O_.length?this.O_[this.O_.length-1].batchId:-1,t.label=1;case 1:if(!this.El())return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,this.x_.Bu(e)];case 3:return null===(n=t.sent())?(0===this.O_.length&&this.J_.Kc(),[3,7]):(e=n.batchId,this.Il(n),[3,6]);case 4:return r=t.sent(),[4,this.ll(r)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return this.wl()&&this.Rl(),[2]}})})},Gc.prototype.El=function(){return this.W_()&&this.O_.length<10},Gc.prototype.Al=function(){return this.O_.length},Gc.prototype.Il=function(t){this.O_.push(t),this.J_.Qc()&&this.J_.a_&&this.J_.u_(t.mutations)},Gc.prototype.wl=function(){return this.W_()&&!this.J_.Uc()&&0<this.O_.length},Gc.prototype.Rl=function(){this.J_.start()},Gc.prototype.X_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.J_.l_(),[2]})})},Gc.prototype.tl=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){for(e=0,n=this.O_;e<n.length;e++)r=n[e],this.J_.u_(r.mutations);return[2]})})},Gc.prototype.c_=function(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.O_.shift(),n=Zs.from(e,i,o),[4,this.fl(function(){return r.cl.ml(n)})];case 1:return t.sent(),[4,this.nl()];case 2:return t.sent(),[2]}})})},Gc.prototype.Z_=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e&&this.J_.a_?[4,this.Pl(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.wl()&&this.Rl(),[2]}})})},Gc.prototype.Pl=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return Ko(n=i.code)&&n!==Nr.ABORTED?(e=this.O_.shift(),this.J_.jc(),[4,this.fl(function(){return r.cl.Vl(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,this.nl()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Gc.prototype.gl=function(){return new Fc(this.w_)},Gc.prototype.j_=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.rl()];case 1:return t.sent(),this.K_.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},Gc.prototype.pl=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.W_()?(Ms("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.j_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Gc.prototype.yl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return(this.isPrimary=e)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:[4,this.rl()];case 3:t.sent(),this.K_.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Gc);function Gc(t,e,n,r,i){var o,s,u,a,h,c,f=this;this.x_=t,this.w_=e,this.Ra=n,this.O_=[],this.L_=new Map,this.B_=null,this.networkEnabled=!1,this.isPrimary=!1,this.q_=!1,this.U_=i,this.U_.Q_(function(t){n.co(function(){return y(f,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.W_()?(Ms("RemoteStore","Restarting streams for network reachability change."),[4,this.j_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.K_=new qc(n,r),this.G_=(a=this.w_,h=n,c={s_:this.z_.bind(this),Jc:this.H_.bind(this),n_:this.Y_.bind(this)},new Uc(h,a.Oc,a.credentials,a.serializer,c)),this.J_=(o=this.w_,s=n,u={s_:this.X_.bind(this),Jc:this.Z_.bind(this),__:this.tl.bind(this),c_:this.c_.bind(this)},new jc(s,o.Oc,o.credentials,o.serializer,u))}function zc(t,e){this.Ra=t,this.b_=e,this.state="Unknown",this.v_=0,this.S_=null,this.D_=!0}function Wc(t){this.w_=t,this.R_=new Map,this.mutations=[],this.A_=!1,this.m_=null,this.P_=new Set}function Kc(t,e,n){var r=this;return(r=Oc.call(this)||this).Oc=t,r.credentials=e,r.serializer=n,r.f_=!1,r}function Hc(t,e,n,r,i){var o=this;return(o=Lc.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.o_=!1,o.lastStreamToken=$r.ht,o}function Qc(t,e,n,r,i){var o=this;return(o=Vc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function Yc(t,e,n,r,i,o){this.Tr=t,this.$c=n,this.Oc=r,this.Lc=i,this.listener=o,this.state=0,this.Bc=0,this.qc=null,this.stream=null,this.Na=new mu(t,e)}function Xc(t,e){return"firestore_clients_"+t+"_"+e}function Jc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function $c(t,e){return"firestore_targets_"+t+"_"+e}function Zc(t){this.key=t}function tf(t){this.key=t}function ef(t,e,n){this.query=t,this.targetId=e,this.view=n}function nf(t){this.key=t,this.Qd=!1}function rf(){this.bf=void 0,this.vf=[]}var of,sf,uf=(jf.bl=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new _r(r.error.code,r.error.message)),i?new jf(t,e,r.state,o):(Fs("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},jf.prototype.vl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},jf),af=(Uf.bl=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new _r(n.error.code,n.error.message)),r?new Uf(t,n.state,i):(Fs("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Uf.prototype.vl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Uf),hf=(Cf.bl=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=cs,o=0;r&&o<n.activeTargetIds.length;++o)r=ni(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Cf(t,i):(Fs("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Cf),cf=(Vf.bl=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Vf(e.clientId,e.onlineState):(Fs("SharedClientState","Failed to parse online state: "+t),null)},Vf),ff=(Lf.prototype.Sl=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Lf.prototype.Dl=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Lf.prototype.vl=function(){var t={activeTargetIds:this.activeTargetIds.W(),updateTimeMs:Date.now()};return JSON.stringify(t)},Lf),lf=(Of.zh=function(t){return!(!t.window||null==t.window.localStorage)},Of.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.cl.So()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.Cl&&(o=this.getItem(Xc(this.persistenceKey,i)))&&(s=hf.bl(i,o))&&(this.kl=this.kl.Ae(s.clientId,s));for(this.Ul(),(u=this.storage.getItem(this.ql))&&(a=this.Ql(u))&&this.Wl(a),h=0,c=this.Ml;h<c.length;h++)f=c[h],this.Nl(f);return this.Ml=[],this.platform.window.addEventListener("unload",function(){return l.Vo()}),this.ho=!0,[2]}})})},Of.prototype.lr=function(t){this.setItem(this.$l,JSON.stringify(t))},Of.prototype.jl=function(){return this.Kl(this.kl)},Of.prototype.Gl=function(n){var r=!1;return this.kl.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Of.prototype.zl=function(t){this.Hl(t,"pending")},Of.prototype.Yl=function(t,e,n){this.Hl(t,e,n),this.Jl(t)},Of.prototype.Xl=function(t){var e,n,r="not-current";return this.Gl(t)&&(!(e=this.storage.getItem($c(this.persistenceKey,t)))||(n=af.bl(t,e))&&(r=n.state)),this.Zl.Sl(t),this.Ul(),r},Of.prototype.td=function(t){this.Zl.Dl(t),this.Ul()},Of.prototype.ed=function(t){return this.Zl.activeTargetIds.has(t)},Of.prototype.sd=function(t){this.removeItem($c(this.persistenceKey,t))},Of.prototype.nd=function(t,e,n){this.rd(t,e,n)},Of.prototype.vu=function(t,e,n){var r=this;e.forEach(function(t){r.Jl(t)}),this.currentUser=t,n.forEach(function(t){r.zl(t)})},Of.prototype.hd=function(t){this.od(t)},Of.prototype.Vo=function(){this.ho&&(this.platform.window.removeEventListener("storage",this.Fl),this.removeItem(this.xl),this.ho=!1)},Of.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ms("SharedClientState","READ",t,e),e},Of.prototype.setItem=function(t,e){Ms("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Of.prototype.removeItem=function(t){Ms("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Of.prototype.Nl=function(u){var t=this;if(u.storageArea===this.storage){if(Ms("SharedClientState","EVENT",u.key,u.newValue),u.key===this.xl)return void Fs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Tr.lo(function(){return y(t,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.ho){if(null!==u.key)if(this.Ol.test(u.key)){if(null==u.newValue)return e=this.ad(u.key),[2,this.ud(e,null)];if(n=this._d(u.key,u.newValue))return[2,this.ud(n.clientId,n)]}else if(this.Ll.test(u.key)){if(null!==u.newValue&&(r=this.ld(u.key,u.newValue)))return[2,this.dd(r)]}else if(this.Bl.test(u.key)){if(null!==u.newValue&&(i=this.fd(u.key,u.newValue)))return[2,this.Td(i)]}else if(u.key===this.ql){if(null!==u.newValue&&(o=this.Ql(u.newValue)))return[2,this.Wl(o)]}else u.key===this.$l&&(s=function(t){var e=su.dr;if(null!=t)try{var n=JSON.parse(t);Gs("number"==typeof n),e=n}catch(t){Fs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==su.dr&&this.ur(s)}else this.Ml.push(u);return[2]})})})}},Object.defineProperty(Of.prototype,"Zl",{get:function(){return this.kl.get(this.Cl)},enumerable:!0,configurable:!0}),Of.prototype.Ul=function(){this.setItem(this.xl,this.Zl.vl())},Of.prototype.Hl=function(t,e,n){var r=new uf(this.currentUser,t,e,n),i=Jc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.vl())},Of.prototype.Jl=function(t){var e=Jc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Of.prototype.od=function(t){var e={clientId:this.Cl,onlineState:t};this.storage.setItem(this.ql,JSON.stringify(e))},Of.prototype.rd=function(t,e,n){var r=$c(this.persistenceKey,t),i=new af(t,e,n);this.setItem(r,i.vl())},Of.prototype.ad=function(t){var e=this.Ol.exec(t);return e?e[1]:null},Of.prototype._d=function(t,e){var n=this.ad(t);return hf.bl(n,e)},Of.prototype.ld=function(t,e){var n=this.Ll.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return uf.bl(new wr(i),r,e)},Of.prototype.fd=function(t,e){var n=this.Bl.exec(t),r=Number(n[1]);return af.bl(r,e)},Of.prototype.Ql=function(t){return cf.bl(t)},Of.prototype.dd=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.cl.Ed(e.batchId,e.state,e.error)]:(Ms("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Of.prototype.Td=function(t){return this.cl.Id(t.targetId,t.state,t.error)},Of.prototype.ud=function(t,e){var n=this,r=e?this.kl.Ae(t,e):this.kl.remove(t),i=this.Kl(this.kl),o=this.Kl(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.cl.wd(s,u).then(function(){n.kl=r})},Of.prototype.Wl=function(t){this.kl.get(t.clientId)&&this.b_(t.onlineState)},Of.prototype.Kl=function(t){var n=cs;return t.forEach(function(t,e){n=n.He(e.activeTargetIds)}),n},Of),pf=(kf.prototype.zl=function(t){},kf.prototype.Yl=function(t,e,n){},kf.prototype.Xl=function(t){return this.Rd.Sl(t),this.Ad[t]||"not-current"},kf.prototype.nd=function(t,e,n){this.Ad[t]=e},kf.prototype.td=function(t){this.Rd.Dl(t)},kf.prototype.ed=function(t){return this.Rd.activeTargetIds.has(t)},kf.prototype.sd=function(t){delete this.Ad[t]},kf.prototype.jl=function(){return this.Rd.activeTargetIds},kf.prototype.Gl=function(t){return this.Rd.activeTargetIds.has(t)},kf.prototype.start=function(){return this.Rd=new ff,Promise.resolve()},kf.prototype.vu=function(t,e,n){},kf.prototype.hd=function(t){},kf.prototype.Vo=function(){},kf.prototype.lr=function(t){},kf),df=(Object.defineProperty(Pf.prototype,"pd",{get:function(){return this.md},enumerable:!0,configurable:!0}),Pf.prototype.yd=function(t,e){var u=this,a=e?e.bd:new ys,h=e?e.gd:this.gd,c=e?e.ns:this.ns,f=h,l=!1,p=this.query.oe()&&h.size===this.query.limit?h.last():null,d=this.query.ae()&&h.size===this.query.limit?h.first():null;if(t.pe(function(t,e){var n=h.get(t),r=(r=e instanceof mo?e:null)&&(u.query.matches(r)?r:null),i=!!n&&u.ns.has(n.key),o=!!r&&(r.At||u.ns.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.vd(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.query.se(r,p)||d&&u.query.se(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.oe()||this.query.ae())for(;f.size>this.query.limit;){var n=this.query.oe()?f.last():f.first(),f=f.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{gd:f,bd:a,Sd:l,ns:c}},Pf.prototype.vd=function(t,e){return t.At&&e.hasCommittedMutations&&!e.At},Pf.prototype.Ln=function(t,e,n){var o=this,r=this.gd;this.gd=t.gd,this.ns=t.ns;var i=t.bd.es();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.query.se(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Bs()}}var r,i}),this.Dd(n);var s=e?this.Cd():[],u=0===this.Vd.size&&this.fs?1:0,a=u!==this.Pd;return this.Pd=u,0!==i.length||a?{snapshot:new vs(this.query,t.gd,r,i,t.ns,0==u,a,!1),Fd:s}:{Fd:s}},Pf.prototype.Nd=function(t){return this.fs&&"Offline"===t?(this.fs=!1,this.Ln({gd:this.gd,bd:new ys,ns:this.ns,Sd:!1},!1)):{Fd:[]}},Pf.prototype.kd=function(t){return!this.md.has(t)&&!!this.gd.has(t)&&!this.gd.get(t).At},Pf.prototype.Dd=function(t){var e=this;t&&(t.Ts.forEach(function(t){return e.md=e.md.add(t)}),t.Es.forEach(function(t){}),t.Is.forEach(function(t){return e.md=e.md.delete(t)}),this.fs=t.fs)},Pf.prototype.Cd=function(){var e=this;if(!this.fs)return[];var n=this.Vd;this.Vd=hs(),this.gd.forEach(function(t){e.kd(t.key)&&(e.Vd=e.Vd.add(t.key))});var r=[];return n.forEach(function(t){e.Vd.has(t)||r.push(new tf(t))}),this.Vd.forEach(function(t){n.has(t)||r.push(new Zc(t))}),r},Pf.prototype.Md=function(t){this.md=t.ju,this.Vd=hs();var e=this.yd(t.documents);return this.Ln(e,!0)},Pf.prototype.xd=function(){return vs.os(this.query,this.gd,this.ns,0===this.Pd)},Pf),yf=(Df.prototype.Od=function(){this.Ld()},Df.prototype.Ld=function(){var t=this;this.Na.gr(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new Fc(this.w_),(n=this.Bd(e))&&n.then(function(t){r.Ra.co(function(){return e.commit().then(function(){r.Pa.resolve(t)}).catch(function(t){r.qd(t)})})}).catch(function(t){r.qd(t)}),[2]})})})},Df.prototype.Bd=function(t){try{var e=this.updateFunction(t);return!ti(e)&&e.catch&&e.then?e:(this.Pa.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Pa.reject(t),null}},Df.prototype.qd=function(t){var e=this;0<this.$d&&this.Ud(t)?(--this.$d,this.Ra.co(function(){return e.Ld(),Promise.resolve()})):this.Pa.reject(t)},Df.prototype.Ud=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ko(e)},Df),vf=(Object.defineProperty(xf.prototype,"if",{get:function(){return!0},enumerable:!0,configurable:!0}),xf.prototype.subscribe=function(t){this.Gd=t},xf.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.nf("listen()"),(r=this.zd.get(s))?(e=r.targetId,this.jd.Xl(e),n=r.view.xd(),[3,4]):[3,1];case 1:return[4,this.x_.Uu(s.ee())];case 2:return i=t.sent(),o=this.jd.Xl(i.targetId),e=i.targetId,[4,this.rf(s,e,"current"===o)];case 3:n=t.sent(),this.if&&this.Wd.listen(i),t.label=4;case 4:return[2,n]}})})},xf.prototype.rf=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.x_.Wu(u,!0)];case 1:return e=t.sent(),n=new df(u,e.ju),r=n.yd(e.documents),i=ms.ds(a,h&&"Offline"!==this.onlineState),o=n.Ln(r,this.if,i),this.hf(a,o.Fd),s=new ef(u,a,n),[2,(this.zd.set(u,s),this.Hd.has(a)?this.Hd.get(a).push(u):this.Hd.set(a,[u]),o.snapshot)]}})})},xf.prototype.al=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.nf("unlisten()"),e=this.zd.get(i),1<(n=this.Hd.get(e.targetId)).length?[2,(this.Hd.set(e.targetId,n.filter(function(t){return!t.isEqual(i)})),void this.zd.delete(i))]:this.if?(this.jd.td(e.targetId),this.jd.Gl(e.targetId)?[3,2]:[4,this.x_.Qu(e.targetId,!1).then(function(){r.jd.sd(e.targetId),r.Wd.al(e.targetId),r.af(e.targetId)}).catch(lh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.af(e.targetId),[4,this.x_.Qu(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},xf.prototype.write=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:this.nf("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this.x_.Fu(i)];case 2:return e=t.sent(),this.jd.zl(e.batchId),this.uf(e.batchId,o),[4,this.cf(e.Dn)];case 3:return t.sent(),[4,this.Wd.nl()];case 4:return t.sent(),[3,6];case 5:return n=t.sent(),r=Xa(n,"Failed to persist write"),o.reject(r),[3,6];case 6:return[2]}})})},xf.prototype.runTransaction=function(t,e,n){new yf(t,this.w_,e,n).Od()},xf.prototype.xu=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.nf("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.x_.xu(n)];case 2:return e=t.sent(),n.as.forEach(function(t,e){var n=r.Xd.get(e);n&&(Gs(t.Ts.size+t.Es.size+t.Is.size<=1),0<t.Ts.size?n.Qd=!0:0<t.Es.size?Gs(n.Qd):0<t.Is.size&&(Gs(n.Qd),n.Qd=!1))}),[4,this.cf(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,lh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},xf.prototype.Nd=function(r,t){this.nf("applyOnlineStateChange()");var i=[];this.zd.forEach(function(t,e){var n=e.view.Nd(r);n.snapshot&&i.push(n.snapshot)}),this.Gd._f(r),this.Gd.n_(i),this.onlineState=r},xf.prototype.Tl=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.nf("rejectListens()"),this.jd.nd(u,"rejected",a),e=this.Xd.get(u),(n=e&&e.key)?(r=(r=new Qo(Hr.N)).Ae(n,new wo(n,Pr.min())),i=hs().add(n),o=new gs(Pr.min(),new Map,new es(Ks),r,i),[4,this.xu(o)]):[3,2];case 1:return t.sent(),this.Jd=this.Jd.remove(n),this.Xd.delete(u),this.lf(),[3,4];case 2:return[4,this.x_.Qu(u,!1).then(function(){return s.af(u,a)}).catch(lh)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},xf.prototype.ml=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.nf("applySuccessfulWrite()"),e=r.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.x_.Nu(r)];case 2:return n=t.sent(),this.df(e,null),this.ff(e),this.jd.Yl(e,"acknowledged"),[4,this.cf(n)];case 3:return t.sent(),[3,6];case 4:return[4,lh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},xf.prototype.Vl=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.nf("rejectFailedWrite()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.x_.Mu(n)];case 2:return e=t.sent(),this.df(n,r),this.ff(n),this.jd.Yl(n,"rejected",r),[4,this.cf(e)];case 3:return t.sent(),[3,6];case 4:return[4,lh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},xf.prototype.Tf=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:this.Wd.W_()||Ms("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.x_.ta()];case 2:return-1===(e=t.sent())?[2,void o.resolve()]:((n=this.ef.get(e)||[]).push(o),this.ef.set(e,n),[3,4]);case 3:return r=t.sent(),i=Xa(r,"Initialization of waitForPendingWrites() operation failed"),o.reject(i),[3,4];case 4:return[2]}})})},xf.prototype.ff=function(t){(this.ef.get(t)||[]).forEach(function(t){t.resolve()}),this.ef.delete(t)},xf.prototype.Ef=function(e){this.ef.forEach(function(t){t.forEach(function(t){t.reject(new _r(Nr.CANCELLED,e))})}),this.ef.clear()},xf.prototype.uf=function(t,e){var n=this.tf[this.currentUser.s()];n=(n=n||new Qo(Ks)).Ae(t,e),this.tf[this.currentUser.s()]=n},xf.prototype.df=function(t,e){var n,r=this.tf[this.currentUser.s()];r&&((n=r.get(t))&&(e?n.reject(e):n.resolve(),r=r.remove(t)),this.tf[this.currentUser.s()]=r)},xf.prototype.af=function(t,e){var n=this;void 0===e&&(e=null),this.jd.td(t);for(var r=0,i=this.Hd.get(t);r<i.length;r++){var o=i[r];this.zd.delete(o),e&&this.Gd.If(o,e)}this.Hd.delete(t),this.if&&this.Zd.ic(t).forEach(function(t){n.Zd.Ch(t)||n.wf(t)})},xf.prototype.wf=function(t){var e=this.Jd.get(t);null!==e&&(this.Wd.al(e),this.Jd=this.Jd.remove(t),this.Xd.delete(e),this.lf())},xf.prototype.hf=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof Zc?(this.Zd.yh(i.key,t),this.Rf(i)):i instanceof tf?(Ms("SyncEngine","Document no longer in limbo: "+i.key),this.Zd.vh(i.key,t),this.Zd.Ch(i.key)||this.wf(i.key)):Bs()}},xf.prototype.Rf=function(t){var e=t.key;this.Jd.get(e)||(Ms("SyncEngine","New document in limbo: "+e),this.Yd.push(e),this.lf())},xf.prototype.lf=function(){for(;0<this.Yd.length&&this.Jd.size<this.Kd;){var t=this.Yd.shift(),e=this.sf.next();this.Xd.set(e,new nf(t)),this.Jd=this.Jd.Ae(t,e),this.Wd.listen(new Po(To.Wt(t.path).ee(),e,2,su.dr))}},xf.prototype.Af=function(){return this.Jd},xf.prototype.mf=function(){return this.Yd},xf.prototype.cf=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.zd.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.yd(r);return n.Sd?u.x_.Wu(i.query,!1).then(function(t){var e=t.documents;return i.view.yd(e,n)}):n}).then(function(t){var e,n=a&&a.as.get(i.targetId),r=i.view.Ln(t,u.if,n);u.hf(i.targetId,r.Fd),r.snapshot&&(u.if&&u.jd.nd(i.targetId,r.snapshot.fromCache?"not-current":"current"),o.push(r.snapshot),e=ou.ar(i.targetId,r.snapshot),s.push(e))}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Gd.n_(o),[4,this.x_.Lu(s)];case 2:return t.sent(),[2]}})})},xf.prototype.nf=function(t){},xf.prototype.pl=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.currentUser.isEqual(n)?[3,3]:[4,this.x_.vu(n)];case 1:return e=t.sent(),this.currentUser=n,this.Ef("'waitForPendingWrites' promise is rejected due to a user change."),this.jd.vu(n,e.Du,e.Cu),[4,this.cf(e.Su)];case 2:t.sent(),t.label=3;case 3:return[4,this.Wd.pl()];case 4:return t.sent(),[2]}})})},xf.prototype.enableNetwork=function(){return this.Wd.enableNetwork()},xf.prototype.disableNetwork=function(){return this.Wd.disableNetwork()},xf.prototype.ei=function(t){var e=this.Xd.get(t);if(e&&e.Qd)return hs().add(e.key);var n=hs(),r=this.Hd.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++)var s=o[i],u=this.zd.get(s),n=n.He(u.view.pd);return n},xf),gf=(n(Rf,of=vf),Object.defineProperty(Rf.prototype,"if",{get:function(){return!0===this.Pf},enumerable:!0,configurable:!0}),Rf.prototype.enableNetwork=function(){return this.x_.uo(!0),of.prototype.enableNetwork.call(this)},Rf.prototype.disableNetwork=function(){return this.x_.uo(!1),of.prototype.disableNetwork.call(this)},Rf.prototype.Vf=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.x_.Wu(r.query,!0)];case 1:return e=t.sent(),n=r.view.Md(e),[2,(this.Pf&&this.hf(r.targetId,n.Fd),n)]}})})},Rf.prototype.Nd=function(t,e){this.if&&0===e&&(of.prototype.Nd.call(this,t,e),this.jd.hd(t)),this.if||1!==e||of.prototype.Nd.call(this,t,e)},Rf.prototype.Ed=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.nf("applyBatchState()"),[4,this.x_.Gu(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.Wd.nl()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.df(n,i||null),this.x_.zu(n)):Bs(),t.label=4;case 4:return[4,this.cf(e)];case 5:return t.sent(),[3,7];case 6:Ms("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},Rf.prototype.yl=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.Pf?[3,3]:(e=this.jd.jl(),[4,this.gf(e.W(),!0)]);case 1:return n=t.sent(),this.Pf=!0,[4,this.Wd.yl(!0)];case 2:for(t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.Wd.listen(o);return[3,7];case 3:return!1!==h||!1===this.Pf?[3,7]:(s=[],u=Promise.resolve(),this.Hd.forEach(function(t,e){a.jd.ed(e)?s.push(e):u=u.then(function(){return a.af(e),a.x_.Qu(e,!0)}),a.Wd.al(e)}),[4,u]);case 4:return t.sent(),[4,this.gf(s,!1)];case 5:return t.sent(),this.pf(),this.Pf=!1,[4,this.Wd.yl(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Rf.prototype.pf=function(){var n=this;this.Xd.forEach(function(t,e){n.Wd.al(e)}),this.Zd.nc(),this.Xd=new Map,this.Jd=new Qo(Hr.N)},Rf.prototype.gf=function(d,t){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.Hd.get(o))&&0!==u.length?[4,this.x_.Uu(u[0].ee())]:[3,7]):[3,13];case 2:s=t.sent(),a=0,h=u,t.label=3;case 3:return a<h.length?(c=h[a],f=this.zd.get(c),[4,this.Vf(f)]):[3,6];case 4:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=5;case 5:return a++,[3,3];case 6:return[3,11];case 7:return[4,this.x_.Hu(o)];case 8:return p=t.sent(),[4,this.x_.Uu(p)];case 9:return s=t.sent(),[4,this.rf(this.yf(p),o,!1)];case 10:t.sent(),t.label=11;case 11:e.push(s),t.label=12;case 12:return r++,[3,1];case 13:return[2,(this.Gd.n_(n),e)]}})})},Rf.prototype.yf=function(t){return new To(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},Rf.prototype.So=function(){return this.x_.So()},Rf.prototype.Id=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.Pf?(Ms("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.Hd.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.x_.Kr()];case 3:return e=t.sent(),n=gs.ls(r,"current"===i),[4,this.cf(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.x_.Qu(r,!0)];case 6:return t.sent(),this.af(r,o),[3,8];case 7:Bs(),t.label=8;case 8:return[2]}})})},Rf.prototype.wd=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.Pf)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],this.Hd.has(r)?(Ms("SyncEngine","Adding an already active target "+r),[3,5]):[4,this.x_.Hu(r)]):[3,6];case 2:return i=t.sent(),[4,this.x_.Uu(i)];case 3:return o=t.sent(),[4,this.rf(this.yf(i),o.targetId,!1)];case 4:t.sent(),this.Wd.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.Hd.has(e)?[4,u.x_.Qu(e,!1).then(function(){f.Wd.al(e),f.af(e)}).catch(lh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Rf),mf=(Sf.prototype.listen=function(u){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.Sf.get(e))||(n=!0,r=new rf),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.cl.listen(e)];case 2:return i.bf=t.sent(),[3,4];case 3:return o=t.sent(),s=Xa(o,"Initialization of query '"+u.query+"' failed"),[2,void u.onError(s)];case 4:return this.Sf.set(e,r),r.vf.push(u),u.Nd(this.onlineState),r.bf&&u.Cf(r.bf)&&this.Ff(),[2]}})})},Sf.prototype.al=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.Sf.get(e))&&0<=(i=r.vf.indexOf(o))&&(r.vf.splice(i,1),n=0===r.vf.length),n?[2,(this.Sf.delete(e),this.cl.al(e))]:[2]})})},Sf.prototype.n_=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.Sf.get(o);if(s){for(var u=0,a=s.vf;u<a.length;u++)a[u].Cf(i)&&(e=!0);s.bf=i}}e&&this.Ff()},Sf.prototype.If=function(t,e){var n=this.Sf.get(t);if(n)for(var r=0,i=n.vf;r<i.length;r++)i[r].onError(e);this.Sf.delete(t)},Sf.prototype._f=function(i){this.onlineState=i;var o=!1;this.Sf.forEach(function(t,e){for(var n=0,r=e.vf;n<r.length;n++)r[n].Nd(i)&&(o=!0)}),o&&this.Ff()},Sf.prototype.Nf=function(t){this.Df.add(t),t.next()},Sf.prototype.kf=function(t){this.Df.delete(t)},Sf.prototype.Ff=function(){this.Df.forEach(function(t){t.next()})},Sf),wf=(Af.prototype.Cf=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new vs(t.query,t.docs,t.ss,e,t.ns,t.fromCache,t.rs,!0)}var o=!1;return this.xf?this.Of(t)&&(this.Mf.next(t),o=!0):this.Lf(t,this.onlineState)&&(this.Bf(t),o=!0),this.$f=t,o},Af.prototype.onError=function(t){this.Mf.error(t)},Af.prototype.Nd=function(t){this.onlineState=t;var e=!1;return this.$f&&!this.xf&&this.Lf(this.$f,t)&&(this.Bf(this.$f),e=!0),e},Af.prototype.Lf=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.qf&&n||t.docs.B()&&"Offline"!==e)},Af.prototype.Of=function(t){if(0<t.docChanges.length)return!0;var e=this.$f&&this.$f.hasPendingWrites!==t.hasPendingWrites;return!(!t.rs&&!e)&&!0===this.options.includeMetadataChanges},Af.prototype.Bf=function(t){t=vs.os(t.query,t.docs,t.ns,t.fromCache),this.xf=!0,this.Mf.next(t)},Af),bf=(_f.prototype.bu=function(t){this.Uf=t},_f.prototype.Zn=function(e,r,i,o){var s=this;return r.te()||i.isEqual(Pr.min())?this.Qf(e,r):this.Uf.Yn(e,o).next(function(t){var n=s.Wf(r,t);return(r.oe()||r.ae())&&s.Sd(r.Bt,n,o,i)?s.Qf(e,r):(js()<=p.DEBUG&&Ms("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),r.toString()),s.Uf.Zn(e,r,i).next(function(e){return n.forEach(function(t){e=e.Ae(t.key,t)}),e}))})},_f.prototype.Wf=function(n,t){var r=new es(function(t,e){return n.se(t,e)});return t.forEach(function(t,e){e instanceof mo&&n.matches(e)&&(r=r.add(e))}),r},_f.prototype.Sd=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.S(r))},_f.prototype.Qf=function(t,e){return js()<=p.DEBUG&&Ms("IndexFreeQueryEngine","Using full collection scan to execute query:",e.toString()),this.Uf.Zn(t,e,Pr.min())},_f),Ef=(Nf.prototype.Ho=function(t){return tu.resolve(0===this.Wn.length)},Nf.prototype.Yo=function(t,e,n,r){var i=this.jf;this.jf++,0<this.Wn.length&&this.Wn[this.Wn.length-1];var o=new $s(i,e,n,r);this.Wn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Kf=this.Kf.add(new dh(a.key,i)),this.jn.Dr(t,a.key.path.$())}return tu.resolve(o)},Nf.prototype.Jo=function(t,e){return tu.resolve(this.Gf(e))},Nf.prototype.Zo=function(t,e){var n=e+1,r=this.zf(n),i=r<0?0:r;return tu.resolve(this.Wn.length>i?this.Wn[i]:null)},Nf.prototype.ta=function(){return tu.resolve(0===this.Wn.length?-1:this.jf-1)},Nf.prototype.ea=function(t){return tu.resolve(this.Wn.slice())},Nf.prototype.Gn=function(t,e){var n=this,r=new dh(e,0),i=new dh(e,Number.POSITIVE_INFINITY),o=[];return this.Kf.Ke([r,i],function(t){var e=n.Gf(t.hc);o.push(e)}),tu.resolve(o)},Nf.prototype.Xn=function(t,e){var r=this,i=new es(Ks);return e.forEach(function(t){var e=new dh(t,0),n=new dh(t,Number.POSITIVE_INFINITY);r.Kf.Ke([e,n],function(t){i=i.add(t.hc)})}),tu.resolve(this.Hf(i))},Nf.prototype.nr=function(t,e){var n=e.path,r=n.length+1,i=n;Hr.et(i)||(i=i.child(""));var o=new dh(new Hr(i),0),s=new es(Ks);return this.Kf.Ge(function(t){var e=t.key.path;return!!n.q(e)&&(e.length===r&&(s=s.add(t.hc)),!0)},o),tu.resolve(this.Hf(s))},Nf.prototype.Hf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Gf(t);null!==e&&r.push(e)}),r},Nf.prototype.ia=function(n,r){var i=this;Gs(0===this.Yf(r.batchId,"removed")),this.Wn.shift();var o=this.Kf;return tu.forEach(r.mutations,function(t){var e=new dh(t.key,r.batchId);return o=o.delete(e),i.hh.Uo(n,t.key)}).next(function(){i.Kf=o})},Nf.prototype.na=function(t){},Nf.prototype.Ch=function(t,e){var n=new dh(e,0),r=this.Kf.ze(n);return tu.resolve(e.isEqual(r&&r.key))},Nf.prototype.ra=function(t){return this.Wn.length,tu.resolve()},Nf.prototype.Yf=function(t,e){return this.zf(t)},Nf.prototype.zf=function(t){return 0===this.Wn.length?0:t-this.Wn[0].batchId},Nf.prototype.Gf=function(t){var e=this.zf(t);return e<0||e>=this.Wn.length?null:this.Wn[e]},Nf),Tf=(If.prototype.Nn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Jf(e);return this.docs=this.docs.Ae(r,{$r:e,size:s,readTime:n}),this.size+=s-o,this.jn.Dr(t,r.path.$())},If.prototype.Mn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},If.prototype.xn=function(t,e){var n=this.docs.get(e);return tu.resolve(n?n.$r:null)},If.prototype.getEntries=function(t,e){var n=this,r=rs;return e.forEach(function(t){var e=n.docs.get(t);r=r.Ae(t,e?e.$r:null)}),tu.resolve(r)},If.prototype.Zn=function(t,e,n){for(var r=ss,i=new Hr(e.path.child("")),o=this.docs.ve(i);o.ke();){var s=o.Ne(),u=s.key,a=s.value,h=a.$r,c=a.readTime;if(!e.path.q(u.path))break;c.S(n)<=0||h instanceof mo&&e.matches(h)&&(r=r.Ae(h.key,h))}return tu.resolve(r)},If.prototype.Xf=function(t,e){return tu.forEach(this.docs,function(t){return e(t)})},If.prototype.Yr=function(t){return new If.Jr(this)},If.prototype.Zr=function(t){return tu.resolve(this.size)},If);function If(t,e){this.jn=t,this.Jf=e,this.docs=new Qo(Hr.N),this.size=0}function Nf(t,e){this.jn=t,this.hh=e,this.Wn=[],this.jf=1,this.Kf=new es(dh.Ju)}function _f(){}function Af(t,e,n){this.query=t,this.Mf=e,this.xf=!1,this.$f=null,this.onlineState="Unknown",this.options=n||{}}function Sf(t){this.cl=t,this.Sf=new Js(function(t){return t.canonicalId()}),this.onlineState="Unknown",this.Df=new Set,this.cl.subscribe(this)}function Rf(t,e,n,r,i,o){var s=this;return(s=of.call(this,t,e,n,r,i,o)||this).x_=t,s.Pf=void 0,s}function xf(t,e,n,r,i,o){this.x_=t,this.Wd=e,this.w_=n,this.jd=r,this.currentUser=i,this.Kd=o,this.Gd=null,this.zd=new Js(function(t){return t.canonicalId()}),this.Hd=new Map,this.Yd=[],this.Jd=new Qo(Hr.N),this.Xd=new Map,this.Zd=new ph,this.tf={},this.ef=new Map,this.sf=ju.rh(),this.onlineState="Unknown"}function Df(t,e,n,r){this.Ra=t,this.w_=e,this.updateFunction=n,this.Pa=r,this.$d=5,this.Na=new mu(this.Ra,"transaction_retry")}function Pf(t,e){this.query=t,this.md=e,this.Pd=null,this.fs=!1,this.Vd=hs(),this.ns=hs(),this.gd=new ds(t.se.bind(t))}function kf(){this.Rd=new ff,this.Ad={},this.cl=null,this.b_=null,this.ur=null}function Of(t,e,n,r,i){if(this.Tr=t,this.platform=e,this.persistenceKey=n,this.Cl=r,this.cl=null,this.b_=null,this.ur=null,this.Fl=this.Nl.bind(this),this.kl=new Qo(Ks),this.ho=!1,this.Ml=[],!Of.zh(this.platform))throw new _r(Nr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.xl=Xc(this.persistenceKey,this.Cl),this.$l="firestore_sequence_number_"+this.persistenceKey,this.kl=this.kl.Ae(this.Cl,new ff),this.Ol=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Ll=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Bl=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.ql="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.Fl)}function Lf(){this.activeTargetIds=cs}function Vf(t,e){this.clientId=t,this.onlineState=e}function Cf(t,e){this.clientId=t,this.activeTargetIds=e}function Uf(t,e,n){this.targetId=t,this.state=e,this.error=n}function jf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Mf(t){var e=this;return(e=sf.call(this)||this).th=t,e}Tf.Jr=(n(Mf,sf=eu),Mf.prototype.Ln=function(n){var r=this,i=[];return this.Dn.forEach(function(t,e){e?i.push(r.th.Nn(n,e,r.readTime)):r.th.Mn(t)}),tu.vn(i)},Mf.prototype.$n=function(t,e){return this.th.xn(t,e)},Mf.prototype.On=function(t,e){return this.th.getEntries(t,e)},Mf);var Ff,qf,Bf=(il.prototype.js=function(t,n){return this.Zf.forEach(function(t,e){return n(e)}),tu.resolve()},il.prototype._h=function(t){return tu.resolve(this.lastRemoteSnapshotVersion)},il.prototype.lh=function(t){return tu.resolve(this.tT)},il.prototype.oh=function(t){return this.highestTargetId=this.sT.next(),tu.resolve(this.highestTargetId)},il.prototype.dh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.tT&&(this.tT=e),tu.resolve()},il.prototype.Th=function(t){this.Zf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.sT=new ju(e),this.highestTargetId=e),t.sequenceNumber>this.tT&&(this.tT=t.sequenceNumber)},il.prototype.fh=function(t,e){return this.Th(e),this.targetCount+=1,tu.resolve()},il.prototype.Ih=function(t,e){return this.Th(e),tu.resolve()},il.prototype.wh=function(t,e){return this.Zf.delete(e.target),this.eT.ic(e.targetId),--this.targetCount,tu.resolve()},il.prototype.Ah=function(n,r,i){var o=this,s=0,u=[];return this.Zf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Zf.delete(t),u.push(o.Rh(n,e.targetId)),s++)}),tu.vn(u).next(function(){return s})},il.prototype.Vh=function(t){return tu.resolve(this.targetCount)},il.prototype.gh=function(t,e){var n=this.Zf.get(e)||null;return tu.resolve(n)},il.prototype.ph=function(t,e,n){return this.eT.tc(e,n),tu.resolve()},il.prototype.bh=function(e,t,n){this.eT.sc(t,n);var r=this.persistence.hh,i=[];return r&&t.forEach(function(t){i.push(r.Uo(e,t))}),tu.vn(i)},il.prototype.Rh=function(t,e){return this.eT.ic(e),tu.resolve()},il.prototype.Sh=function(t,e){var n=this.eT.rc(e);return tu.resolve(n)},il.prototype.Ch=function(t,e){return tu.resolve(this.eT.Ch(e))},il),Gf=(rl.prototype.start=function(){return Promise.resolve()},rl.prototype.Vo=function(){return this.Uh=!1,Promise.resolve()},Object.defineProperty(rl.prototype,"ho",{get:function(){return this.Uh},enumerable:!0,configurable:!0}),rl.prototype.oo=function(){},rl.prototype.ko=function(){return this.jn},rl.prototype.Do=function(t){var e=this.iT[t.s()];return e||(e=new Ef(this.jn,this.hh),this.iT[t.s()]=e),e},rl.prototype.Fo=function(){return this.Jh},rl.prototype.No=function(){return this.Qn},rl.prototype.runTransaction=function(t,e,n){var r=this;Ms("MemoryPersistence","Starting transaction:",t);var i=new zf(this.qh.next());return this.hh.rT(),n(i).next(function(t){return r.hh.hT(i).next(function(){return t})}).yn().then(function(t){return i.Un(),t})},rl.prototype.oT=function(e,n){return tu.Sn(Object.values(this.iT).map(function(t){return function(){return t.Ch(e,n)}}))},rl),zf=(n(nl,qf=ru),nl),Wf=(el.cT=function(t){return new el(t)},Object.defineProperty(el.prototype,"_T",{get:function(){if(this.uT)return this.uT;throw Bs()},enumerable:!0,configurable:!0}),el.prototype.yh=function(t,e,n){return this.aT.yh(n,e),this._T.delete(n),tu.resolve()},el.prototype.vh=function(t,e,n){return this.aT.vh(n,e),this._T.add(n),tu.resolve()},el.prototype.Uo=function(t,e){return this._T.add(e),tu.resolve()},el.prototype.removeTarget=function(t,e){var n=this;this.aT.ic(e.targetId).forEach(function(t){return n._T.add(t)});var r=this.persistence.Fo();return r.Sh(t,e.targetId).next(function(t){t.forEach(function(t){return n._T.add(t)})}).next(function(){return r.wh(t,e)})},el.prototype.rT=function(){this.uT=new Set},el.prototype.hT=function(t){var n=this,r=this.persistence.No().Yr();return tu.forEach(this._T,function(e){return n.lT(t,e).next(function(t){t||r.Mn(e)})}).next(function(){return n.uT=null,r.apply(t)})},el.prototype.Ko=function(t,e){var n=this;return this.lT(t,e).next(function(t){t?n._T.delete(e):n._T.add(e)})},el.prototype.nT=function(t){return 0},el.prototype.lT=function(t,e){var n=this;return tu.Sn([function(){return tu.resolve(n.aT.Ch(e))},function(){return n.persistence.Fo().Ch(t,e)},function(){return n.persistence.oT(t,e)}])},el),Kf="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Hf=(tl.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.jd=this.dT(n),this.persistence=this.fT(n),[4,this.persistence.start()];case 1:return t.sent(),this.TT=this.ET(n),this.x_=this.IT(n),this.Wd=this.wT(n),this.cl=this.RT(n),this.AT=this.mT(n),this.jd.b_=function(t){return e.cl.Nd(t,1)},this.Wd.cl=this.cl,[4,this.x_.start()];case 2:return t.sent(),[4,this.jd.start()];case 3:return t.sent(),[4,this.Wd.start()];case 4:return t.sent(),[4,this.Wd.yl(this.cl.if)];case 5:return t.sent(),[2]}})})},tl.prototype.mT=function(t){return new mf(this.cl)},tl.prototype.ET=function(t){return null},tl.prototype.IT=function(t){return new oh(this.persistence,new bf,t.PT)},tl.prototype.fT=function(t){if(t.gT.VT)throw new _r(Nr.FAILED_PRECONDITION,Kf);return new Gf(Wf.cT)},tl.prototype.wT=function(t){var e=this;return new Bc(this.x_,t.w_,t.Ra,function(t){return e.cl.Nd(t,0)},t.platform.pT())},tl.prototype.dT=function(t){return new pf},tl.prototype.RT=function(t){return new vf(this.x_,this.Wd,t.w_,this.jd,t.PT,t.Kd)},tl.prototype.clearPersistence=function(t){throw new _r(Nr.FAILED_PRECONDITION,Kf)},tl),Qf=(n(Zf,Ff=Hf),Zf.prototype.initialize=function(e){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return[4,Ff.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.ro(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.cl.yl(e)];case 1:return t.sent(),this.TT&&(e&&!this.TT.ho?this.TT.start(this.x_):e||this.TT.stop()),[2]}})})})];case 2:return t.sent(),[2]}})})},Zf.prototype.IT=function(t){return new ch(this.persistence,new bf,t.PT)},Zf.prototype.RT=function(t){var e=new gf(this.x_,this.Wd,t.w_,this.jd,t.PT,t.Kd);return this.jd instanceof lf&&(this.jd.cl=e),e},Zf.prototype.ET=function(t){var e=this.persistence.hh.$o;return new rh(e,t.Ra)},Zf.prototype.fT=function(t){var e=Yu.xo(t.yT),n=t.platform.Cc(t.yT.ii);return new Yu(t.gT.synchronizeTabs,e,t.clientId,t.platform,th.nu(t.gT.cacheSizeBytes),t.Ra,n,this.jd,t.gT.Bh)},Zf.prototype.dT=function(t){if(t.gT.VT&&t.gT.synchronizeTabs){if(!lf.zh(t.platform))throw new _r(Nr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var e=Yu.xo(t.yT);return new lf(t.Ra,t.platform,e,t.clientId,t.PT)}return new pf},Zf.prototype.clearPersistence=function(t){var e=Yu.xo(t);return Yu.clearPersistence(e)},Zf),Yf=($f.prototype.start=function(e,n){var r=this;this.T_();var i=new gu,o=new gu,s=!1;return this.credentials.l(function(t){return s?void r.Ra.lo(function(){return r.pl(t)}):(s=!0,Ms("FirestoreClient","Initializing. user=",t.uid),r.bT(e,n,t,o).then(i.resolve,i.reject))}),this.Ra.co(function(){return i.promise}),o.promise},$f.prototype.enableNetwork=function(){var t=this;return this.T_(),this.Ra.enqueue(function(){return t.cl.enableNetwork()})},$f.prototype.bT=function(u,a,h,c){return y(this,void 0,void 0,function(){var n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.platform.vT(this.yT)];case 1:return n=t.sent(),r=this.platform.Cc(this.yT.ii),e=this.credentials,i=new Mc(n,e,r),[4,u.initialize({Ra:this.Ra,yT:this.yT,platform:this.platform,w_:i,clientId:this.clientId,PT:h,Kd:100,gT:a})];case 2:return t.sent(),this.persistence=u.persistence,this.jd=u.jd,this.x_=u.x_,this.Wd=u.Wd,this.cl=u.cl,this.TT=u.TT,this.ST=u.AT,this.persistence.oo(function(){return y(s,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),c.resolve(),[3,4];case 3:if(o=t.sent(),c.reject(o),!this.DT(o))throw o;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),this.bT(new Hf,{VT:!1},h,c))];case 4:return[2]}var e})})},$f.prototype.DT=function(t){return"FirebaseError"===t.name?t.code===Nr.FAILED_PRECONDITION||t.code===Nr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},$f.prototype.T_=function(){if(this.Ra.Ma)throw new _r(Nr.FAILED_PRECONDITION,"The client has already been terminated.")},$f.prototype.pl=function(t){return this.Ra.Ua(),Ms("FirestoreClient","Credential Changed. Current user: "+t.uid),this.cl.pl(t)},$f.prototype.disableNetwork=function(){var t=this;return this.T_(),this.Ra.enqueue(function(){return t.cl.disableNetwork()})},$f.prototype.terminate=function(){var t=this;return this.Ra.Ba(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.TT&&this.TT.stop(),[4,this.Wd.Vo()];case 1:return t.sent(),[4,this.jd.Vo()];case 2:return t.sent(),[4,this.persistence.Vo()];case 3:return t.sent(),this.credentials.T(),[2]}})})})},$f.prototype.waitForPendingWrites=function(){var t=this;this.T_();var e=new gu;return this.Ra.co(function(){return t.cl.Tf(e)}),e.promise},$f.prototype.listen=function(t,e,n){var r=this;this.T_();var i=new wf(t,e,n);return this.Ra.co(function(){return r.ST.listen(i)}),i},$f.prototype.al=function(t){var e=this;this.CT||this.Ra.co(function(){return e.ST.al(t)})},$f.prototype.FT=function(o){return y(this,void 0,void 0,function(){var i,e=this;return v(this,function(t){switch(t.label){case 0:return this.T_(),i=new gu,[4,this.Ra.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.x_.qu(o)];case 1:return(e=t.sent())instanceof mo?i.resolve(e):e instanceof wo?i.resolve(null):i.reject(new _r(Nr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return n=t.sent(),r=Xa(n,"Failed to get document '"+o+" from cache"),i.reject(r),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),i.promise)]}})})},$f.prototype.NT=function(a){return y(this,void 0,void 0,function(){var u,e=this;return v(this,function(t){switch(t.label){case 0:return this.T_(),u=new gu,[4,this.Ra.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.x_.Wu(a,!0)];case 1:return e=t.sent(),n=new df(a,e.ju),r=n.yd(e.documents),i=n.Ln(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=Xa(o,"Failed to execute query '"+a+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})},$f.prototype.write=function(t){var e=this;this.T_();var n=new gu;return this.Ra.co(function(){return e.cl.write(t,n)}),n.promise},$f.prototype.ii=function(){return this.yT.ii},$f.prototype.Nf=function(t){var e=this;this.T_(),this.Ra.co(function(){return e.ST.Nf(t),Promise.resolve()})},$f.prototype.kf=function(t){var e=this;this.CT||this.Ra.co(function(){return e.ST.kf(t),Promise.resolve()})},Object.defineProperty($f.prototype,"CT",{get:function(){return this.Ra.Ma},enumerable:!0,configurable:!0}),$f.prototype.transaction=function(t){var e=this;this.T_();var n=new gu;return this.Ra.co(function(){return e.cl.runTransaction(e.Ra,t,n),Promise.resolve()}),n.promise},$f),Xf=(Jf.prototype.next=function(t){this.kT(this.observer.next,t)},Jf.prototype.error=function(t){this.kT(this.observer.error,t)},Jf.prototype.MT=function(){this.muted=!0},Jf.prototype.kT=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Jf);function Jf(t){this.observer=t,this.muted=!1}function $f(t,e,n,r){this.platform=t,this.yT=e,this.credentials=n,this.Ra=r,this.clientId=zs.cn()}function Zf(){return null!==Ff&&Ff.apply(this,arguments)||this}function tl(){}function el(t){this.persistence=t,this.aT=new ph,this.uT=null}function nl(t){var e=this;return(e=qf.call(this)||this).Oh=t,e}function rl(t){var e=this;this.iT={},this.qh=new su(0),this.Uh=!1,this.Uh=!0,this.hh=t(this),this.Jh=new Bf(this),this.jn=new Iu,this.Qn=new Tf(this.jn,function(t){return e.hh.nT(t)})}function il(t){this.persistence=t,this.Zf=new Js(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Pr.min(),this.highestTargetId=0,this.tT=0,this.eT=new ph,this.targetCount=0,this.sT=ju.nh()}function ol(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var sl,ul,al,hl,cl=(Vl.prototype.OT=function(t){switch(si(t)){case 0:return null;case 1:return t.booleanValue;case 2:return pi(t.integerValue||t.doubleValue);case 3:return this.LT(t.timestampValue);case 4:return this.BT(t);case 5:return t.stringValue;case 6:return new Fh(di(t.bytesValue));case 7:return this.qT(t.referenceValue);case 8:return this.UT(t.geoPointValue);case 9:return this.QT(t.arrayValue);case 10:return this.WT(t.mapValue);default:throw Bs()}},Vl.prototype.WT=function(t){var n=this,r={};return Xr(t.fields||{},function(t,e){r[t]=n.OT(e)}),r},Vl.prototype.UT=function(t){return new sc(pi(t.latitude),pi(t.longitude))},Vl.prototype.QT=function(t){var e=this;return(t.values||[]).map(function(t){return e.OT(t)})},Vl.prototype.BT=function(t){switch(this.xT){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return ri(n)?t(n):n}(t);return null==e?null:this.OT(e);case"estimate":return this.LT(ii(t));default:return null}},Vl.prototype.LT=function(t){var e=li(t),n=new Dr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Vl.prototype.qT=function(t){var e=Or.K(t);Gs(Ls(e));var n=new Xs(e.get(1),e.get(3)),r=new Hr(e.M(5));return n.isEqual(this.ii)||Fs("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.ii.projectId+"/"+this.ii.database+") instead."),this.$T(r)},Vl),fl=th.ou,ll=(Ll.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},Ll),pl=(Object.defineProperty(Ol.prototype,"tE",{get:function(){return this.eE||(this.eE=new Ic(this.mc,this.ZT.ignoreUndefinedProperties)),this.eE},enumerable:!0,configurable:!0}),Ol.prototype.settings=function(t){mh("Firestore.settings",arguments,1),Eh("Firestore.settings","object",1,t);var e=new ll(t);if(this.zT&&!this.ZT.isEqual(e))throw new _r(Nr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.ZT=e).credentials&&(this.JT=function(t){if(!t)return new Ar;switch(t.type){case"gapi":var e=t.sE;return Gs(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new xr(e,t.V||"0");case"provider":return t.sE;default:throw new _r(Nr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Ol.prototype.enableNetwork=function(){return this.GT(),this.zT.enableNetwork()},Ol.prototype.disableNetwork=function(){return this.GT(),this.zT.disableNetwork()},Ol.prototype.enablePersistence=function(t){var e,n;if(this.zT)throw new _r(Nr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Fs("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new _r(Nr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.iE(this.XT,{VT:!0,cacheSizeBytes:this.ZT.cacheSizeBytes,synchronizeTabs:r,Bh:i})},Ol.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var r,e=this;return v(this,function(t){if(void 0!==this.zT&&!this.zT.CT)throw new _r(Nr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return r=new gu,[2,(this.KT.xa(function(){return y(e,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.nE(),[4,this.XT.clearPersistence(e)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return n=t.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise)]})})},Ol.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Ol.prototype,"rE",{get:function(){return this.GT(),this.zT.CT},enumerable:!0,configurable:!0}),Ol.prototype.waitForPendingWrites=function(){return this.GT(),this.zT.waitForPendingWrites()},Ol.prototype.onSnapshotsInSync=function(t){if(this.GT(),ol(t))return this.hE(t);Eh("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.hE(e)},Ol.prototype.hE=function(t){var e=this,n=new Xf({next:function(){t.next&&t.next()},error:function(t){throw Bs()}});return this.zT.Nf(n),function(){n.MT(),e.zT.kf(n)}},Ol.prototype.GT=function(){return this.zT||this.iE(new Hf,{VT:!1}),this.zT},Ol.prototype.nE=function(){return new Ys(this.mc,this.YT,this.ZT.host,this.ZT.ssl,this.ZT.forceLongPolling)},Ol.prototype.iE=function(t,e){var n=this.nE();return this.zT=new Yf(Vs.nt(),n,this.JT,this.KT),this.zT.start(t,e)},Ol.HT=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new _r(Nr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new _r(Nr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Xs(n)},Object.defineProperty(Ol.prototype,"app",{get:function(){if(!this.jT)throw new _r(Nr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.jT},enumerable:!0,configurable:!0}),Ol.prototype.collection=function(t){return mh("Firestore.collection",arguments,1),Eh("Firestore.collection","non-empty string",1,t),this.GT(),new Tl(Or.K(t),this,null)},Ol.prototype.doc=function(t){return mh("Firestore.doc",arguments,1),Eh("Firestore.doc","non-empty string",1,t),this.GT(),vl.oE(Or.K(t),this,null)},Ol.prototype.collectionGroup=function(t){if(mh("Firestore.collectionGroup",arguments,1),Eh("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.GT(),new bl(new To(Or.G,t),this,null)},Ol.prototype.runTransaction=function(e){var n=this;return mh("Firestore.runTransaction",arguments,1),Eh("Firestore.runTransaction","function",1,e),this.GT().transaction(function(t){return e(new dl(n,t))})},Ol.prototype.batch=function(){return this.GT(),new yl(this)},Object.defineProperty(Ol,"logLevel",{get:function(){switch(js()){case p.DEBUG:return"debug";case p.ERROR:return"error";case p.SILENT:return"silent";case p.WARN:return"warn";case p.INFO:return"info";case p.VERBOSE:return"verbose";default:return"error"}},enumerable:!0,configurable:!0}),Ol.setLogLevel=function(t){mh("Firestore.setLogLevel",arguments,1),Ah("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Cs.setLogLevel(t)},Ol.prototype.aE=function(){return this.ZT.timestampsInSnapshots},Ol),dl=(kl.prototype.get=function(t){var n=this;mh("Transaction.get",arguments,1);var r=Ml("Transaction.get",t,this.uE);return this.cE.V_([r.Pc]).then(function(t){if(!t||1!==t.length)return Bs();var e=t[0];if(e instanceof wo)return new ml(n.uE,r.Pc,null,!1,!1,r.Vc);if(e instanceof mo)return new ml(n.uE,r.Pc,e,!1,!1,r.Vc);throw Bs()})},kl.prototype.set=function(t,e,n){bh("Transaction.set",arguments,2,3);var r=Ml("Transaction.set",t,this.uE);n=Cl("Transaction.set",n);var i=Fl(r.Vc,e,"Transaction.set"),o=i[0],s=i[1],u=this.uE.tE.Fc(s,o,n);return this.cE.set(r.Pc,u),this},kl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof qh?(wh("Transaction.update",arguments,3),r=Ml("Transaction.update",t,this.uE),this.uE.tE.Mc("Transaction.update",e,n,o)):(mh("Transaction.update",arguments,2),r=Ml("Transaction.update",t,this.uE),this.uE.tE.kc("Transaction.update",e)),this.cE.update(r.Pc,i),this},kl.prototype.delete=function(t){mh("Transaction.delete",arguments,1);var e=Ml("Transaction.delete",t,this.uE);return this.cE.delete(e.Pc),this},kl),yl=(Pl.prototype.set=function(t,e,n){bh("WriteBatch.set",arguments,2,3),this.dE();var r=Ml("WriteBatch.set",t,this.uE);n=Cl("WriteBatch.set",n);var i=Fl(r.Vc,e,"WriteBatch.set"),o=i[0],s=i[1],u=this.uE.tE.Fc(s,o,n);return this._E=this._E.concat(u.gc(r.Pc,ji.ft())),this},Pl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.dE(),i="string"==typeof e||e instanceof qh?(wh("WriteBatch.update",arguments,3),r=Ml("WriteBatch.update",t,this.uE),this.uE.tE.Mc("WriteBatch.update",e,n,o)):(mh("WriteBatch.update",arguments,2),r=Ml("WriteBatch.update",t,this.uE),this.uE.tE.kc("WriteBatch.update",e)),this._E=this._E.concat(i.gc(r.Pc,ji.exists(!0))),this},Pl.prototype.delete=function(t){mh("WriteBatch.delete",arguments,1),this.dE();var e=Ml("WriteBatch.delete",t,this.uE);return this._E=this._E.concat(new Gi(e.Pc,ji.ft())),this},Pl.prototype.commit=function(){return this.dE(),this.lE=!0,0<this._E.length?this.uE.GT().write(this._E):Promise.resolve()},Pl.prototype.dE=function(){if(this.lE)throw new _r(Nr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},Pl),vl=(n(Dl,hl=ac),Dl.oE=function(t,e,n){if(t.length%2!=0)throw new _r(Nr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.j()+" has "+t.length);return new Dl(new Hr(t),e,n)},Object.defineProperty(Dl.prototype,"id",{get:function(){return this.Pc.path.L()},enumerable:!0,configurable:!0}),Object.defineProperty(Dl.prototype,"parent",{get:function(){return new Tl(this.Pc.path.$(),this.firestore,this.Vc)},enumerable:!0,configurable:!0}),Object.defineProperty(Dl.prototype,"path",{get:function(){return this.Pc.path.j()},enumerable:!0,configurable:!0}),Dl.prototype.collection=function(t){if(mh("DocumentReference.collection",arguments,1),Eh("DocumentReference.collection","non-empty string",1,t),!t)throw new _r(Nr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Or.K(t);return new Tl(this.Pc.path.child(e),this.firestore,null)},Dl.prototype.isEqual=function(t){if(!(t instanceof Dl))throw kh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.Pc.isEqual(t.Pc)&&this.Vc===t.Vc},Dl.prototype.set=function(t,e){bh("DocumentReference.set",arguments,1,2),e=Cl("DocumentReference.set",e);var n=Fl(this.Vc,t,"DocumentReference.set"),r=n[0],i=n[1],o=this.firestore.tE.Fc(i,r,e);return this.zT.write(o.gc(this.Pc,ji.ft()))},Dl.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof qh?(wh("DocumentReference.update",arguments,2),this.firestore.tE.Mc("DocumentReference.update",t,e,r)):(mh("DocumentReference.update",arguments,1),this.firestore.tE.kc("DocumentReference.update",t)),this.zT.write(n.gc(this.Pc,ji.exists(!0)))},Dl.prototype.delete=function(){return mh("DocumentReference.delete",arguments,0),this.zT.write([new Gi(this.Pc,ji.ft())])},Dl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bh("DocumentReference.onSnapshot",arguments,1,4);var n={includeMetadataChanges:!1},r=0;"object"!=typeof t[r]||ol(t[r])||(Ph("DocumentReference.onSnapshot",n=t[r],["includeMetadataChanges"]),Nh("DocumentReference.onSnapshot","boolean","includeMetadataChanges",n.includeMetadataChanges),r++);var i={includeMetadataChanges:n.includeMetadataChanges},o=ol(t[r])?t[r]:(Eh("DocumentReference.onSnapshot","function",r,t[r]),Th("DocumentReference.onSnapshot","function",r+1,t[r+1]),Th("DocumentReference.onSnapshot","function",r+2,t[r+2]),{next:t[r],error:t[r+1],complete:t[r+2]});return this.fE(i,o)},Dl.prototype.fE=function(t,n){var r=this,e=function(t){console.error("Uncaught Error in onSnapshot:",t)};n.error&&(e=n.error.bind(n));var i=new Xf({next:function(t){var e;n.next&&(e=t.docs.get(r.Pc),n.next(new ml(r.firestore,r.Pc,e,t.fromCache,t.hasPendingWrites,r.Vc)))},error:e}),o=this.zT.listen(To.Wt(this.Pc.path),i,t);return function(){i.MT(),r.zT.al(o)}},Dl.prototype.get=function(n){var r=this;return bh("DocumentReference.get",arguments,0,1),jl("DocumentReference.get",n),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.GT().FT(r.Pc).then(function(t){e(new ml(r.firestore,r.Pc,t,!0,t instanceof mo&&t.At,r.Vc))},t):r.TE(e,t,n)})},Dl.prototype.TE=function(e,n,r){var i=this.fE({includeMetadataChanges:!0,qf:!0},{next:function(t){i(),!t.exists&&t.metadata.fromCache?n(new _r(Nr.UNAVAILABLE,"Failed to get document because the client is offline.")):t.exists&&t.metadata.fromCache&&r&&"server"===r.source?n(new _r(Nr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):e(t)},error:n})},Dl.prototype.withConverter=function(t){return new Dl(this.Pc,this.firestore,t)},Dl),gl=(xl.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},xl),ml=(Rl.prototype.data=function(t){var e=this;if(bh("DocumentSnapshot.data",arguments,0,1),t=Ul("DocumentSnapshot.data",t),this.EE){if(this.Vc){var n=new wl(this.uE,this.Pc,this.EE,this.IE,this.wE,null);return this.Vc.fromFirestore(n,t)}return new cl(this.uE.mc,this.uE.aE(),t.serverTimestamps||"none",function(t){return new vl(t,e.uE,null)}).OT(this.EE.xt())}},Rl.prototype.get=function(t,e){var n=this;if(bh("DocumentSnapshot.get",arguments,1,2),e=Ul("DocumentSnapshot.get",e),this.EE){var r=this.EE.data().field(Dc("DocumentSnapshot.get",t));if(null!==r)return new cl(this.uE.mc,this.uE.aE(),e.serverTimestamps||"none",function(t){return new vl(t,n.uE,n.Vc)}).OT(r)}},Object.defineProperty(Rl.prototype,"id",{get:function(){return this.Pc.path.L()},enumerable:!0,configurable:!0}),Object.defineProperty(Rl.prototype,"ref",{get:function(){return new vl(this.Pc,this.uE,this.Vc)},enumerable:!0,configurable:!0}),Object.defineProperty(Rl.prototype,"exists",{get:function(){return null!==this.EE},enumerable:!0,configurable:!0}),Object.defineProperty(Rl.prototype,"metadata",{get:function(){return new gl(this.wE,this.IE)},enumerable:!0,configurable:!0}),Rl.prototype.isEqual=function(t){if(!(t instanceof Rl))throw kh("isEqual","DocumentSnapshot",1,t);return this.uE===t.uE&&this.IE===t.IE&&this.Pc.isEqual(t.Pc)&&(null===this.EE?null===t.EE:this.EE.isEqual(t.EE))&&this.Vc===t.Vc},Rl),wl=(n(Sl,al=ml),Sl.prototype.data=function(t){return al.prototype.data.call(this,t)},Sl),bl=(Al.prototype.AE=function(t,e,n){var r;if(t.Y()){if("array-contains"===e||"array-contains-any"===e)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+e+"' queries on FieldPath.documentId().");if("in"===e){this.mE(n,e);for(var i=[],o=0,s=n;o<s.length;o++){var u=s[o];i.push(this.PE(u))}r={arrayValue:{values:i}}}else r=this.PE(n)}else"in"!==e&&"array-contains-any"!==e||this.mE(n,e),r=this.tE.xc("Query.where",n,"in"===e);var a=Io.create(t,e,r);return this.VE(a),a},Al.prototype.gE=function(t,e){if(null!==this.RE.startAt)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.RE.endAt)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var n=new Do(t,e);return this.pE(n),n},Al.prototype.yE=function(t,e,n){if(!e)throw new _r(Nr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");for(var r=[],i=0,o=this.RE.orderBy;i<o.length;i++){var s=o[i];if(s.field.Y())r.push(yi(this.mc,e.key));else{var u=e.field(s.field);if(ri(u))throw new _r(Nr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){var a=s.field.j();throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}r.push(u)}}return new xo(r,n)},Al.prototype.bE=function(t,e,n){var r=this.RE.Lt;if(e.length>r.length)throw new _r(Nr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.Y()){if("string"!=typeof s)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.RE._e()&&-1!==s.indexOf("/"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.RE.path.child(Or.K(s));if(!Hr.et(u))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Hr(u);i.push(yi(this.mc,a))}else{var h=this.tE.xc(t,s);i.push(h)}}return new xo(i,n)},Al.prototype.vE=function(t){if(t.ae()&&0===t.Lt.length)throw new _r(Nr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},Al.prototype.PE=function(t){if("string"==typeof t){if(""===t)throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.RE._e()&&-1!==t.indexOf("/"))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.RE.path.child(Or.K(t));if(!Hr.et(e))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return yi(this.mc,new Hr(e))}if(t instanceof ac)return yi(this.mc,t.Pc);throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+xh(t)+".")},Al.prototype.mE=function(t,e){if(!Array.isArray(t)||0===t.length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new _r(Nr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},Al.prototype.VE=function(t){if(t instanceof Io){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ue()){var o=this.RE.jt();if(null!==o&&!o.isEqual(t.field))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.RE.Kt();null!==s&&this.SE(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.RE.ce(n)),null===u&&r&&(u=this.RE.ce(e)),null!=u)throw u===t.op?new _r(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new _r(Nr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},Al.prototype.pE=function(t){var e;null!==this.RE.Kt()||null!==(e=this.RE.jt())&&this.SE(e,t.field)},Al.prototype.SE=function(t,e){if(!e.isEqual(t))throw new _r(Nr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},n(_l,ul=Al),_l.prototype.where=function(t,e,n){mh("Query.where",arguments,3),Dh("Query.where",3,n);var r=Ah("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e),i=Dc("Query.where",t),o=this.AE(i,r,n);return new _l(this.RE.Gt(o),this.firestore,this.Vc)},_l.prototype.orderBy=function(t,e){var n;if(bh("Query.orderBy",arguments,1,2),Th("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new _r(Nr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r=Dc("Query.orderBy",t),i=this.gE(r,n);return new _l(this.RE.zt(i),this.firestore,this.Vc)},_l.prototype.limit=function(t){return mh("Query.limit",arguments,1),Eh("Query.limit","number",1,t),Oh("Query.limit",1,t),new _l(this.RE.Ht(t),this.firestore,this.Vc)},_l.prototype.limitToLast=function(t){return mh("Query.limitToLast",arguments,1),Eh("Query.limitToLast","number",1,t),Oh("Query.limitToLast",1,t),new _l(this.RE.Yt(t),this.firestore,this.Vc)},_l.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wh("Query.startAt",arguments,1);var r=this.DE("Query.startAt",t,e,!0);return new _l(this.RE.Jt(r),this.firestore,this.Vc)},_l.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wh("Query.startAfter",arguments,1);var r=this.DE("Query.startAfter",t,e,!1);return new _l(this.RE.Jt(r),this.firestore,this.Vc)},_l.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wh("Query.endBefore",arguments,1);var r=this.DE("Query.endBefore",t,e,!0);return new _l(this.RE.Xt(r),this.firestore,this.Vc)},_l.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];wh("Query.endAt",arguments,1);var r=this.DE("Query.endAt",t,e,!1);return new _l(this.RE.Xt(r),this.firestore,this.Vc)},_l.prototype.isEqual=function(t){if(!(t instanceof _l))throw kh("isEqual","Query",1,t);return this.firestore===t.firestore&&this.RE.isEqual(t.RE)&&this.Vc===t.Vc},_l.prototype.withConverter=function(t){return new _l(this.RE,this.firestore,t)},_l.prototype.DE=function(t,e,n,r){if(Dh(t,1,e),e instanceof ml)return mh(t,d([e],n),1),this.yE(t,e.EE,r);var i=[e].concat(n);return this.bE(t,i,r)},_l.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];bh("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||ol(t[i])||(Ph("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Nh("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=ol(t[i])?t[i]:(Eh("Query.onSnapshot","function",i,t[i]),Th("Query.onSnapshot","function",i+1,t[i+1]),Th("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.vE(this.RE),this.fE(r,n)},_l.prototype.fE=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new Xf({next:function(t){e.next&&e.next(new El(n.firestore,n.RE,t,n.Vc))},error:r}),o=this.firestore.GT(),s=o.listen(this.RE,i,t);return function(){i.MT(),o.al(s)}},_l.prototype.get=function(n){var r=this;return bh("Query.get",arguments,0,1),jl("Query.get",n),this.vE(this.RE),new Promise(function(e,t){n&&"cache"===n.source?r.firestore.GT().NT(r.RE).then(function(t){e(new El(r.firestore,r.RE,t,r.Vc))},t):r.TE(e,t,n)})},_l.prototype.TE=function(e,n,r){var i=this.fE({includeMetadataChanges:!0,qf:!0},{next:function(t){i(),t.metadata.fromCache&&r&&"server"===r.source?n(new _r(Nr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):e(t)},error:n})},_l),El=(Object.defineProperty(Nl.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!0,configurable:!0}),Object.defineProperty(Nl.prototype,"empty",{get:function(){return this.FE.docs.B()},enumerable:!0,configurable:!0}),Object.defineProperty(Nl.prototype,"size",{get:function(){return this.FE.docs.size},enumerable:!0,configurable:!0}),Nl.prototype.forEach=function(e,n){var r=this;bh("QuerySnapshot.forEach",arguments,1,2),Eh("QuerySnapshot.forEach","function",1,e),this.FE.docs.forEach(function(t){e.call(n,r.ME(t))})},Object.defineProperty(Nl.prototype,"query",{get:function(){return new bl(this.CE,this.uE,this.Vc)},enumerable:!0,configurable:!0}),Nl.prototype.docChanges=function(t){t&&(Ph("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Nh("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.FE.hs)throw new _r(Nr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.NE&&this.kE===e||(this.NE=function(i,e,o,s){if(o.ss.B()){var n=0;return o.docChanges.map(function(t){var e=new wl(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s);return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var u=o.ss;return o.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=new wl(i,t.doc.key,t.doc,o.fromCache,o.ns.has(t.doc.key),s),n=-1,r=-1;return 0!==t.type&&(n=u.indexOf(t.doc.key),u=u.delete(t.doc.key)),1!==t.type&&(r=(u=u.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Bs()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.uE,e,this.FE,this.Vc),this.kE=e),this.NE},Nl.prototype.isEqual=function(t){if(!(t instanceof Nl))throw kh("isEqual","QuerySnapshot",1,t);return this.uE===t.uE&&this.CE.isEqual(t.CE)&&this.FE.isEqual(t.FE)&&this.Vc===t.Vc},Nl.prototype.ME=function(t){return new wl(this.uE,t.key,t,this.metadata.fromCache,this.FE.ns.has(t.key),this.Vc)},Nl),Tl=(n(Il,sl=bl),Object.defineProperty(Il.prototype,"id",{get:function(){return this.RE.path.L()},enumerable:!0,configurable:!0}),Object.defineProperty(Il.prototype,"parent",{get:function(){var t=this.RE.path.$();return t.B()?null:new vl(new Hr(t),this.firestore,null)},enumerable:!0,configurable:!0}),Object.defineProperty(Il.prototype,"path",{get:function(){return this.RE.path.j()},enumerable:!0,configurable:!0}),Il.prototype.doc=function(t){bh("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=zs.cn()),Eh("CollectionReference.doc","non-empty string",1,t);var e=Or.K(t);return vl.oE(this.RE.path.child(e),this.firestore,this.Vc)},Il.prototype.add=function(t){mh("CollectionReference.add",arguments,1),Eh("CollectionReference.add","object",1,this.Vc?this.Vc.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},Il.prototype.withConverter=function(t){return new Il(this.xE,this.firestore,t)},Il);function Il(t,e,n){var r=this;if(((r=sl.call(this,To.Wt(t),e,n)||this).xE=t).length%2!=1)throw new _r(Nr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.j()+" has "+t.length);return r}function Nl(t,e,n,r){this.uE=t,this.CE=e,this.FE=n,this.Vc=r,this.NE=null,this.kE=null,this.metadata=new gl(n.hasPendingWrites,n.fromCache)}function _l(t,e,n){var r=this;return(r=ul.call(this,e.mc,e.tE,t)||this).RE=t,r.firestore=e,r.Vc=n,r}function Al(t,e,n){this.mc=t,this.tE=e,this.RE=n}function Sl(){return null!==al&&al.apply(this,arguments)||this}function Rl(t,e,n,r,i,o){this.uE=t,this.Pc=e,this.EE=n,this.IE=r,this.wE=i,this.Vc=o}function xl(t,e){this.hasPendingWrites=t,this.fromCache=e}function Dl(t,e,n){var r=this;return(r=hl.call(this,e.mc,t,n)||this).Pc=t,r.firestore=e,r.Vc=n,r.zT=r.firestore.GT(),r}function Pl(t){this.uE=t,this._E=[],this.lE=!1}function kl(t,e){this.uE=t,this.cE=e}function Ol(t,e,n){var r=this;if(void 0===n&&(n=new Hf),this.jT=null,this.KT=new Ha,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.GT(),[4,this.zT.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.jT=i,this.mc=Ol.HT(i),this.YT=i.name,this.JT=new Sr(e)}else{var o=t;if(!o.projectId)throw new _r(Nr.INVALID_ARGUMENT,"Must provide projectId");this.mc=new Xs(o.projectId,o.database),this.YT="[DEFAULT]",this.JT=new Ar}this.XT=n,this.ZT=new ll({})}function Ll(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new _r(Nr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Ih("settings","non-empty string","host",t.host),this.host=t.host,Nh("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Ph("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),Nh("settings","object","credentials",t.credentials),this.credentials=t.credentials,Nh("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),Nh("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Fs("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Fs("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,Nh("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=th.uu;else{if(t.cacheSizeBytes!==fl&&t.cacheSizeBytes<th.au)throw new _r(Nr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+th.au);this.cacheSizeBytes=t.cacheSizeBytes}Nh("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function Vl(t,e,n,r){this.ii=t,this.timestampsInSnapshots=e,this.xT=n,this.$T=r}function Cl(t,e){if(void 0===e)return{merge:!1};if(Ph(t,e,["merge","mergeFields"]),Nh(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+xh(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new _r(Nr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+xh(n[i]))}(t,"mergeFields",n,function(t){return"string"==typeof t||t instanceof qh}),void 0!==e.mergeFields&&void 0!==e.merge)throw new _r(Nr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Ul(t,e){return void 0===e?{}:(Ph(t,e,["serverTimestamps"]),_h(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function jl(t,e){Th(t,"object",1,e),e&&(Ph(t,e,["source"]),_h(t,0,"source",e.source,["default","server","cache"]))}function Ml(t,e,n){if(e instanceof ac){if(e.firestore!==n)throw new _r(Nr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw kh(t,"DocumentReference",1,e)}function Fl(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}function ql(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new _r(Nr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}var Bl,Gl=ql(pl,"Use firebase.firestore() instead."),zl=ql(dl,"Use firebase.firestore().runTransaction() instead."),Wl=ql(yl,"Use firebase.firestore().batch() instead."),Kl=ql(vl,"Use firebase.firestore().doc() instead."),Hl=ql(ml),Ql=ql(wl),Yl=ql(bl),Xl=ql(El),Jl=ql(Tl,"Use firebase.firestore().collection() instead."),$l=ql(ic,"Use FieldValue.<field>() instead."),Zl=ql(Fh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),tp={Firestore:Gl,GeoPoint:sc,Timestamp:Dr,Blob:Zl,Transaction:zl,WriteBatch:Wl,DocumentReference:Kl,DocumentSnapshot:Hl,Query:Yl,QueryDocumentSnapshot:Ql,QuerySnapshot:Xl,CollectionReference:Jl,FieldPath:qh,FieldValue:$l,setLogLevel:pl.setLogLevel,CACHE_SIZE_UNLIMITED:fl},ep=(cp.prototype.Q_=function(t){},cp.prototype.Vo=function(){},cp),np=(hp.prototype.Q_=function(t){this.qE.push(t)},hp.prototype.Vo=function(){window.removeEventListener("online",this.$E),window.removeEventListener("offline",this.LE)},hp.prototype.UE=function(){window.addEventListener("online",this.$E),window.addEventListener("offline",this.LE)},hp.prototype.OE=function(){Ms("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.qE;t<e.length;t++)(0,e[t])(0)},hp.prototype.BE=function(){Ms("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.qE;t<e.length;t++)(0,e[t])(1)},hp.zh=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},hp),rp=(ap.prototype.s_=function(t){this.jE=t},ap.prototype.Jc=function(t){this.KE=t},ap.prototype.onMessage=function(t){this.GE=t},ap.prototype.close=function(){this.WE()},ap.prototype.send=function(t){this.QE(t)},ap.prototype.zE=function(){this.jE()},ap.prototype.HE=function(t){this.KE(t)},ap.prototype.YE=function(t){this.GE(t)},ap),ip={BatchGetDocuments:"batchGet",Commit:"commit"},op="gl-js/ fire/"+mr,sp=(up.prototype.XE=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=op},up.prototype.E_=function(a,r,i){var h=this,c=this.ZE(a);return new Promise(function(o,s){var u=new gr;u.listenOnce(yr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case dr.NO_ERROR:var t=u.getResponseJson();Ms("Connection","XHR received:",JSON.stringify(t)),o(t);break;case dr.TIMEOUT:Ms("Connection",'RPC "'+a+'" timed out'),s(new _r(Nr.DEADLINE_EXCEEDED,"Request time out"));break;case dr.HTTP_ERROR:var e,n,r=u.getStatus();Ms("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(Nr).indexOf(i)?i:Nr.UNKNOWN,s(new _r(n,e.message))):s(new _r(Nr.UNKNOWN,"Server responded with status "+u.getStatus())):(Ms("Connection",'RPC "'+a+'" failed'),s(new _r(Nr.UNAVAILABLE,"Connection failed.")));break;default:Bs()}}finally{Ms("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Ms("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.XE(n,i),u.send(c,"POST",e,n,15)})},up.prototype.I_=function(t,e,n){return this.E_(t,e,n)},up.prototype.i_=function(t,e){var n,r,i=[this.JE,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=pr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ii.projectId+"/databases/"+this.ii.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.XE(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=g().indexOf("Electron/")||0<=(r=g()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=g().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Ms("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new rp({QE:function(t){f?Ms("Connection","Not sending because WebChannel is closed:",t):(c||(Ms("Connection","Opening WebChannel transport."),h.open(),c=!0),Ms("Connection","WebChannel sending:",t),h.send(t))},WE:function(){return h.close()}});return a(vr.EventType.OPEN,function(){f||Ms("Connection","WebChannel transport opened.")}),a(vr.EventType.CLOSE,function(){f||(f=!0,Ms("Connection","WebChannel transport closed"),l.HE())}),a(vr.EventType.ERROR,function(t){f||(f=!0,function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Cs.logLevel<=p.WARN&&(e=n.map(qs),Cs.warn.apply(Cs,d(["Firestore ("+mr+"): Connection"],e)))}("Connection","WebChannel transport errored:",t),l.HE(new _r(Nr.UNAVAILABLE,"The operation could not be completed")))}),a(vr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Gs(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Ms("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=so[i];if(void 0!==t)return Ho(t)}(),s=r.message,void 0===o&&(o=Nr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.HE(new _r(o,s)),h.close()):(Ms("Connection","WebChannel received:",n),l.YE(n)))}),setTimeout(function(){l.zE()},0),l},up.prototype.ZE=function(t){var e=ip[t];return this.JE+"/v1/projects/"+this.ii.projectId+"/databases/"+this.ii.database+"/documents:"+e},up);function up(t){this.ii=t.ii;var e=t.ssl?"https":"http";this.JE=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function ap(t){this.QE=t.QE,this.WE=t.WE}function hp(){var t=this;this.$E=function(){return t.OE()},this.LE=function(){return t.BE()},this.qE=[],this.UE()}function cp(){}function fp(){this.oc="undefined"!=typeof atob}Vs.an((Object.defineProperty(fp.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(fp.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),fp.prototype.vT=function(t){return Promise.resolve(new sp(t))},fp.prototype.pT=function(){return new(np.zh()?np:ep)},fp.prototype.Cc=function(t){return new ks(t,{hi:!0})},fp.prototype.un=function(t){return JSON.stringify(t)},fp.prototype.atob=function(t){return atob(t)},fp.prototype.btoa=function(t){return btoa(t)},fp.prototype._n=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n},new fp)),(Bl=lp).INTERNAL.registerComponent(new I("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new pl(e,n,new Qf);var e,n},"PUBLIC").setServiceProps(Object.assign({},tp))),Bl.registerVersion("@firebase/firestore","1.15.4")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});
//# sourceMappingURL=firebase-firestore.js.map
